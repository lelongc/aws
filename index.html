<!DOCTYPE html>
<html lang="vi">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Duyá»‡t Repository</title>
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/@picocss/pico@2/css/pico.min.css"
    />
    <style>
      /* Má»™t vÃ i tÃ¹y chá»‰nh nhá» bá»• sung */
      body {
        padding: 20px;
      }
      ul {
        list-style: none;
        padding-left: 0; /* Pico Ä‘Ã£ cÃ³ style, bá» padding máº·c Ä‘á»‹nh */
      }
      li {
        margin-bottom: 8px;
        padding: 5px 0;
      }
      a {
        text-decoration: none; /* Pico xá»­ lÃ½ pháº§n nÃ y */
      }
      /* Giá»¯ láº¡i icon cho dá»… nhÃ¬n */
      .folder::before {
        content: "ğŸ“ ";
        margin-right: 5px;
      }
      .file::before {
        content: "ğŸ“„ ";
        margin-right: 5px;
      }
      #loading,
      #error {
        margin-top: 15px;
      }
      nav#breadcrumb {
        margin-bottom: 20px;
        font-size: 0.9em;
      }
      nav#breadcrumb a {
        font-weight: bold;
      }
      nav#breadcrumb span {
        margin: 0 5px;
      }
    </style>
  </head>
  <body>
    <main class="container">
      <hgroup>
        <h1>Duyá»‡t Repository</h1>
        <p>
          Xem ná»™i dung cá»§a repo
          <strong><span id="repo-name-display"></span></strong>
        </p>
      </hgroup>

      <nav id="breadcrumb"></nav>

      <div id="file-browser">
        <ul id="file-list"></ul>
      </div>

      <div id="loading" aria-busy="true" style="display: none">
        Äang táº£i, vui lÃ²ng Ä‘á»£i...
      </div>
      <div id="error" style="display: none; color: var(--pico-color-red)"></div>
    </main>
    <script>
      const username = "lelongc"; // <-- THAY TÃŠN USERNAME GITHUB Cá»¦A Báº N
      const repoName = "aws"; // <-- THAY TÃŠN REPOSITORY Cá»¦A Báº N
      const fileList = document.getElementById("file-list");
      const loadingIndicator = document.getElementById("loading");
      const errorDisplay = document.getElementById("error");
      const breadcrumbNav = document.getElementById("breadcrumb");
      const repoNameDisplay = document.getElementById("repo-name-display");

      // Hiá»ƒn thá»‹ tÃªn repo
      repoNameDisplay.textContent = `${username}/${repoName}`;

      function updateBreadcrumb(path) {
        breadcrumbNav.innerHTML = ""; // XÃ³a breadcrumb cÅ©
        const parts = path.split("/").filter((p) => p); // TÃ¡ch path thÃ nh cÃ¡c pháº§n, loáº¡i bá» rá»—ng

        // ThÃªm link gá»‘c
        const rootLink = document.createElement("a");
        rootLink.href = "#";
        rootLink.textContent = "Gá»‘c";
        rootLink.onclick = (e) => {
          e.preventDefault();
          fetchContents("");
        };
        breadcrumbNav.appendChild(rootLink);

        let currentPath = "";
        parts.forEach((part, index) => {
          const separator = document.createElement("span");
          separator.textContent = "/";
          breadcrumbNav.appendChild(separator);

          currentPath += (index > 0 ? "/" : "") + part;
          if (index === parts.length - 1) {
            // Pháº§n tá»­ cuá»‘i cÃ¹ng (thÆ° má»¥c hiá»‡n táº¡i) lÃ  text
            const currentFolder = document.createElement("span");
            currentFolder.textContent = part;
            breadcrumbNav.appendChild(currentFolder);
          } else {
            // CÃ¡c pháº§n tá»­ trÆ°á»›c lÃ  link
            const partLink = document.createElement("a");
            partLink.href = "#";
            partLink.textContent = part;
            // Capture currentPath táº¡i thá»i Ä‘iá»ƒm táº¡o link
            const pathForLink = currentPath;
            partLink.onclick = (e) => {
              e.preventDefault();
              fetchContents(pathForLink);
            };
            breadcrumbNav.appendChild(partLink);
          }
        });
      }

      async function fetchContents(path = "") {
        fileList.innerHTML = "";
        loadingIndicator.style.display = "block";
        loadingIndicator.setAttribute("aria-busy", "true");
        errorDisplay.style.display = "none";
        updateBreadcrumb(path); // Cáº­p nháº­t breadcrumb

        const apiUrl = `https://api.github.com/repos/${username}/${repoName}/contents/${path}`;

        try {
          const response = await fetch(apiUrl);
          if (!response.ok) {
            let errorMsg = `Lá»—i ${response.status}: ${response.statusText}`;
            try {
              const errorData = await response.json();
              errorMsg += ` - ${errorData.message || ""}`;
            } catch (e) {
              /* Ignore JSON parsing error */
            }
            // Check for rate limit specifically
            if (response.status === 403) {
              errorMsg +=
                ". CÃ³ thá»ƒ báº¡n Ä‘Ã£ vÆ°á»£t quÃ¡ giá»›i háº¡n truy cáº­p API cá»§a GitHub (60 yÃªu cáº§u/giá» náº¿u khÃ´ng Ä‘Äƒng nháº­p). Thá»­ láº¡i sau.";
            }
            throw new Error(errorMsg);
          }
          const data = await response.json();

          data.sort((a, b) => {
            if (a.type === b.type) return a.name.localeCompare(b.name);
            return a.type === "dir" ? -1 : 1;
          });

          // ThÃªm link ".." náº¿u khÃ´ng á»Ÿ gá»‘c
          if (path !== "") {
            const parentPath = path.substring(0, path.lastIndexOf("/"));
            const listItem = document.createElement("li");
            const link = document.createElement("a");
            link.href = "#";
            link.innerHTML = "<strong>ğŸ”™ .. (LÃªn trÃªn)</strong>"; // DÃ¹ng innerHTML Ä‘á»ƒ dÃ¹ng strong
            link.onclick = (e) => {
              e.preventDefault();
              fetchContents(parentPath);
            };
            listItem.appendChild(link);
            fileList.appendChild(listItem);
          }

          data.forEach((item) => {
            const listItem = document.createElement("li");
            const link = document.createElement("a");
            listItem.classList.add(item.type === "dir" ? "folder" : "file");

            link.textContent = item.name;

            if (item.type === "dir") {
              link.href = "#";
              link.onclick = (e) => {
                e.preventDefault();
                fetchContents(item.path);
              };
            } else {
              // Link tá»›i trang xem file trÃªn GitHub (má»Ÿ tab má»›i)
              link.href = item.html_url;
              link.target = "_blank";
              // ThÃªm thÃ´ng tin kÃ­ch thÆ°á»›c file náº¿u cÃ³
              if (item.size) {
                const sizeKb = (item.size / 1024).toFixed(1);
                const sizeSpan = document.createElement("span");
                sizeSpan.textContent = ` (${sizeKb} KB)`;
                sizeSpan.style.fontSize = "0.8em";
                sizeSpan.style.color = "grey";
                link.appendChild(sizeSpan);
              }
            }
            listItem.appendChild(link);
            fileList.appendChild(listItem);
          });

          if (data.length === 0 && path !== "") {
            const emptyMsg = document.createElement("li");
            emptyMsg.textContent = "(ThÆ° má»¥c nÃ y trá»‘ng)";
            emptyMsg.style.fontStyle = "italic";
            emptyMsg.style.color = "grey";
            fileList.appendChild(emptyMsg);
          }
        } catch (error) {
          console.error("Lá»—i khi láº¥y dá»¯ liá»‡u:", error);
          errorDisplay.textContent = `KhÃ´ng thá»ƒ táº£i ná»™i dung: ${error.message}`;
          errorDisplay.style.display = "block";
        } finally {
          loadingIndicator.style.display = "none";
          loadingIndicator.setAttribute("aria-busy", "false");
        }
      }

      document.addEventListener("DOMContentLoaded", () => fetchContents());
    </script>
  </body>
</html>
