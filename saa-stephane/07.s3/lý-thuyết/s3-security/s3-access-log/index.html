
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
      
      
      <link rel="icon" href="../../../../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.11">
    
    
      
        <title>S3 access log - DraDoc</title>
      
    
    
      <link rel="stylesheet" href="../../../../../assets/stylesheets/main.4af4bdda.min.css">
      
        
        <link rel="stylesheet" href="../../../../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("../../../../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#1-s3-access-logs-la-gi" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../../../../.." title="DraDoc" class="md-header__button md-logo" aria-label="DraDoc" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            DraDoc
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              S3 access log
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Chuyển sang chế độ tối"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Chuyển sang chế độ tối" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="slate" data-md-color-primary="black" data-md-color-accent="indigo"  aria-label="Chuyển sang chế độ sáng"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Chuyển sang chế độ sáng" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12s-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
      <div class="md-header__source">
        <a href="https://github.com/lelongc/aws" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../../../.." title="DraDoc" class="md-nav__button md-logo" aria-label="DraDoc" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    DraDoc
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/lelongc/aws" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../.." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Home
    
  </span>
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#1-s3-access-logs-la-gi" class="md-nav__link">
    <span class="md-ellipsis">
      1. S3 Access Logs là gì?
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#2-quy-trinh-hoat-ong-cua-s3-access-logs" class="md-nav__link">
    <span class="md-ellipsis">
      2. Quy trình hoạt động của S3 Access Logs
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#3-inh-dang-cua-access-logs" class="md-nav__link">
    <span class="md-ellipsis">
      3. Định dạng của Access Logs
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#4-canh-bao-quan-trong" class="md-nav__link">
    <span class="md-ellipsis">
      4. Cảnh báo quan trọng
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#5-loi-ich-cua-s3-access-logs" class="md-nav__link">
    <span class="md-ellipsis">
      5. Lợi ích của S3 Access Logs
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#6-han-che-cua-s3-access-logs" class="md-nav__link">
    <span class="md-ellipsis">
      6. Hạn chế của S3 Access Logs
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#7-cach-bat-s3-access-logs" class="md-nav__link">
    <span class="md-ellipsis">
      7. Cách bật S3 Access Logs
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#8-tom-tat-kien-thuc-chinh" class="md-nav__link">
    <span class="md-ellipsis">
      8. Tóm tắt kiến thức chính
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#1-tinh-huong-thuc-te" class="md-nav__link">
    <span class="md-ellipsis">
      1. Tình huống thực tế
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#2-ieu-gi-xay-ra-khi-co-mot-hanh-ong" class="md-nav__link">
    <span class="md-ellipsis">
      2. Điều gì xảy ra khi có một hành động?
    </span>
  </a>
  
    <nav class="md-nav" aria-label="2. Điều gì xảy ra khi có một hành động?">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#buoc-1-nguoi-dung-tai-len-mot-file" class="md-nav__link">
    <span class="md-ellipsis">
      Bước 1: Người dùng tải lên một file
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#buoc-2-file-log-uoc-luu-vao-bucket" class="md-nav__link">
    <span class="md-ellipsis">
      Bước 2: File log được lưu vào bucket
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#buoc-3-ghi-log-cho-file-log" class="md-nav__link">
    <span class="md-ellipsis">
      Bước 3: Ghi log cho file log
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#buoc-4-vong-lap-tiep-dien" class="md-nav__link">
    <span class="md-ellipsis">
      Bước 4: Vòng lặp tiếp diễn
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#3-minh-hoa-truc-quan" class="md-nav__link">
    <span class="md-ellipsis">
      3. Minh họa trực quan
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#4-hau-qua" class="md-nav__link">
    <span class="md-ellipsis">
      4. Hậu quả
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#5-ngan-chan-vong-lap" class="md-nav__link">
    <span class="md-ellipsis">
      5. Ngăn chặn vòng lặp
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#6-vi-du-minh-hoa-truc-quan-voi-bucket-rieng" class="md-nav__link">
    <span class="md-ellipsis">
      6. Ví dụ minh họa trực quan với bucket riêng
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


  
    <a href="https://github.com/lelongc/aws/edit/main/my-website/docs/saa-stephane/07.s3/lý-thuyết/s3-security/s3-access-log.md" title="Edit this page" class="md-content__button md-icon">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M10 20H6V4h7v5h5v3.1l2-2V8l-6-6H6c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h4zm10.2-7c.1 0 .3.1.4.2l1.3 1.3c.2.2.2.6 0 .8l-1 1-2.1-2.1 1-1c.1-.1.2-.2.4-.2m0 3.9L14.1 23H12v-2.1l6.1-6.1z"/></svg>
    </a>
  
  


  <h1>S3 access log</h1>

<p>Dưới đây là kiến thức chi tiết liên quan đến <strong>S3 Access Logs</strong> trong <strong>Amazon S3</strong>:</p>
<hr />
<h3 id="1-s3-access-logs-la-gi"><strong>1. S3 Access Logs là gì?</strong></h3>
<ul>
<li><strong>S3 Access Logs</strong> là một tính năng trong Amazon S3 giúp ghi lại toàn bộ các yêu cầu (requests) đến bucket S3.</li>
<li><strong>Audit purposes</strong>: Công cụ này hữu ích cho mục đích kiểm toán, theo dõi và phân tích truy cập.</li>
<li><strong>Các loại yêu cầu được ghi lại</strong>:</li>
<li>Các yêu cầu <strong>được chấp nhận</strong> (authorized requests).</li>
<li>Các yêu cầu <strong>bị từ chối</strong> (denied requests).</li>
</ul>
<hr />
<h3 id="2-quy-trinh-hoat-ong-cua-s3-access-logs"><strong>2. Quy trình hoạt động của S3 Access Logs</strong></h3>
<ol>
<li><strong>Bật logging trên bucket S3 (monitored bucket)</strong>:</li>
<li>
<p>Khi một bucket được bật tính năng logging, mọi yêu cầu đến bucket này sẽ được ghi lại.</p>
</li>
<li>
<p><strong>Ghi log vào bucket mục tiêu (logging bucket)</strong>:</p>
</li>
<li>Các bản ghi sẽ được lưu dưới dạng file trong một bucket S3 khác (gọi là logging bucket).</li>
<li>
<p>Logging bucket phải nằm trong cùng một <strong>AWS Region</strong> với monitored bucket.</p>
</li>
<li>
<p><strong>Phân tích log</strong>:</p>
</li>
<li>Log có thể được phân tích bằng công cụ như <strong>Amazon Athena</strong>, một dịch vụ phân tích dữ liệu trên AWS.</li>
</ol>
<hr />
<h3 id="3-inh-dang-cua-access-logs"><strong>3. Định dạng của Access Logs</strong></h3>
<ul>
<li><strong>Log format</strong>: Access Logs được lưu dưới dạng các file text có cấu trúc cụ thể.</li>
<li>Mỗi log bao gồm thông tin như:</li>
<li><strong>Bucket name</strong>: Tên bucket được truy cập.</li>
<li><strong>Requester</strong>: Người thực hiện yêu cầu.</li>
<li><strong>Timestamp</strong>: Thời gian yêu cầu được thực hiện.</li>
<li><strong>Action type</strong>: Loại hành động (PUT, GET, DELETE, etc.).</li>
<li><strong>Response</strong>: Phản hồi từ hệ thống (HTTP status codes).</li>
<li>Tham khảo chi tiết định dạng tại tài liệu AWS (URL được đề cập trong đoạn transcript).</li>
</ul>
<hr />
<h3 id="4-canh-bao-quan-trong"><strong>4. Cảnh báo quan trọng</strong></h3>
<ul>
<li><strong>Không sử dụng chung logging bucket và monitored bucket</strong>:</li>
<li>Nếu logging bucket và monitored bucket là một, sẽ dẫn đến:<ul>
<li><strong>Logging loop</strong>: Ghi log lặp vô hạn (infinite loop).</li>
<li><strong>Exponential growth</strong>: Dung lượng bucket tăng theo cấp số nhân.</li>
<li><strong>Chi phí cao</strong>: Phát sinh chi phí lưu trữ không kiểm soát.</li>
</ul>
</li>
</ul>
<p><strong>Ví dụ về logging loop</strong>:
1. Một yêu cầu đến monitored bucket được ghi lại trong chính bucket đó.
2. Log này lại được ghi log lần nữa, tạo ra log mới.
3. Quá trình này lặp lại vô hạn.</p>
<hr />
<h3 id="5-loi-ich-cua-s3-access-logs"><strong>5. Lợi ích của S3 Access Logs</strong></h3>
<ul>
<li><strong>Theo dõi truy cập</strong>: Ghi lại mọi hoạt động để biết ai đang truy cập bucket, làm gì và khi nào.</li>
<li><strong>Bảo mật</strong>: Giúp phát hiện các hành vi truy cập trái phép.</li>
<li><strong>Phân tích</strong>: Dữ liệu log có thể được phân tích để tối ưu hóa hiệu năng và phát hiện lỗi.</li>
</ul>
<hr />
<h3 id="6-han-che-cua-s3-access-logs"><strong>6. Hạn chế của S3 Access Logs</strong></h3>
<ul>
<li><strong>Tăng chi phí lưu trữ</strong>: Lượng log có thể lớn nếu có nhiều truy cập.</li>
<li><strong>Phải quản lý bucket log</strong>: Cần cấu hình logging bucket riêng biệt và giám sát dung lượng của nó.</li>
</ul>
<hr />
<h3 id="7-cach-bat-s3-access-logs"><strong>7. Cách bật S3 Access Logs</strong></h3>
<p>Sử dụng AWS CLI hoặc Console:</p>
<ol>
<li>
<p><strong>Sử dụng AWS CLI</strong>:
   <code>bash
   aws s3api put-bucket-logging --bucket &lt;Monitored-Bucket-Name&gt; \
   --bucket-logging-status '{"LoggingEnabled":{"TargetBucket":"&lt;Logging-Bucket-Name&gt;","TargetPrefix":"logs/"}}'</code></p>
</li>
<li>
<p><strong>Sử dụng AWS Console</strong>:</p>
</li>
<li>Vào bucket cần bật logging.</li>
<li>Tìm mục "Server Access Logging" và bật lên.</li>
<li>Chọn bucket mục tiêu để lưu log (logging bucket).</li>
</ol>
<hr />
<h3 id="8-tom-tat-kien-thuc-chinh"><strong>8. Tóm tắt kiến thức chính</strong></h3>
<ul>
<li><strong>Mục đích chính</strong>: Ghi lại toàn bộ yêu cầu đến bucket S3 để kiểm toán và phân tích.</li>
<li><strong>Phân biệt bucket</strong>: Không dùng chung logging bucket và monitored bucket.</li>
<li><strong>Phân tích log</strong>: Sử dụng Amazon Athena hoặc các công cụ phân tích khác để đọc và phân tích log.</li>
</ul>
<hr />
<h3 id="1-tinh-huong-thuc-te"><strong>1. Tình huống thực tế</strong></h3>
<p>Bạn có một bucket S3 tên là <code>example-bucket</code>, trong đó bạn muốn:
- Theo dõi tất cả các hành động (truy cập, tải lên file, xóa file) xảy ra trong bucket này.
- Bật tính năng <strong>Access Logs</strong> để ghi lại thông tin truy cập.</p>
<p>Bạn <strong>cấu hình sai</strong>: Chọn <code>example-bucket</code> làm cả:
- <strong>Monitored bucket</strong>: Bucket được giám sát.
- <strong>Logging bucket</strong>: Bucket dùng để lưu file log.</p>
<hr />
<h3 id="2-ieu-gi-xay-ra-khi-co-mot-hanh-ong"><strong>2. Điều gì xảy ra khi có một hành động?</strong></h3>
<h4 id="buoc-1-nguoi-dung-tai-len-mot-file"><strong>Bước 1: Người dùng tải lên một file</strong></h4>
<ul>
<li>Một người dùng thực hiện hành động <code>PUT Object</code> để tải file <code>file1.txt</code> vào bucket <code>example-bucket</code>.</li>
<li><strong>Hệ thống ghi lại hành động này</strong> vào file log <code>log1.txt</code>.</li>
</ul>
<h4 id="buoc-2-file-log-uoc-luu-vao-bucket"><strong>Bước 2: File log được lưu vào bucket</strong></h4>
<ul>
<li>File log <code>log1.txt</code> được ghi vào <strong>chính bucket <code>example-bucket</code></strong>.</li>
<li>Hành động này lại là một <strong>yêu cầu mới</strong>: "Ghi file log <code>log1.txt</code> vào bucket".</li>
</ul>
<h4 id="buoc-3-ghi-log-cho-file-log"><strong>Bước 3: Ghi log cho file log</strong></h4>
<ul>
<li>Hệ thống ghi lại hành động trên (ghi file log vào bucket) vào một <strong>file log mới</strong>: <code>log2.txt</code>.</li>
<li>File log mới này (<code>log2.txt</code>) lại được lưu vào chính bucket <code>example-bucket</code>.</li>
</ul>
<h4 id="buoc-4-vong-lap-tiep-dien"><strong>Bước 4: Vòng lặp tiếp diễn</strong></h4>
<ul>
<li>File <code>log2.txt</code> lại tạo ra một hành động mới, và AWS sẽ ghi thêm một file log mới (<code>log3.txt</code>).</li>
<li><strong>Vòng lặp xảy ra</strong>: Mỗi lần ghi file log vào bucket, nó lại được ghi log thêm một lần nữa.</li>
</ul>
<hr />
<h3 id="3-minh-hoa-truc-quan"><strong>3. Minh họa trực quan</strong></h3>
<p>Hãy hình dung một chuỗi hành động như sau:</p>
<ol>
<li><strong>Ban đầu</strong>:</li>
<li>Người dùng tải lên <code>file1.txt</code>.</li>
<li>
<p>Ghi log: <code>log1.txt</code>.</p>
</li>
<li>
<p><strong>Ghi log</strong>:</p>
</li>
<li>File <code>log1.txt</code> được ghi vào bucket.</li>
<li>
<p>Hệ thống tạo ra <code>log2.txt</code>.</p>
</li>
<li>
<p><strong>Tiếp tục lặp</strong>:</p>
</li>
<li>Ghi <code>log2.txt</code> vào bucket → tạo <code>log3.txt</code>.</li>
<li>
<p>Ghi <code>log3.txt</code> vào bucket → tạo <code>log4.txt</code>.</p>
</li>
<li>
<p><strong>Không dừng lại</strong>:</p>
</li>
<li>Mỗi lần thêm file log vào bucket, hệ thống sẽ tạo ra <strong>một file log mới</strong>, và cứ thế tiếp tục.</li>
</ol>
<hr />
<h3 id="4-hau-qua"><strong>4. Hậu quả</strong></h3>
<ul>
<li><strong>Dung lượng tăng nhanh</strong>:</li>
<li>Bucket chứa hàng ngàn, hàng triệu file log chỉ trong vài giờ.</li>
<li>
<p>Kích thước bucket tăng không kiểm soát.</p>
</li>
<li>
<p><strong>Chi phí tăng cao</strong>:</p>
</li>
<li>Chi phí lưu trữ tăng (do lưu trữ quá nhiều file log).</li>
<li>Chi phí request (API calls) tăng vì mỗi lần ghi log là một yêu cầu PUT Object.</li>
</ul>
<hr />
<h3 id="5-ngan-chan-vong-lap"><strong>5. Ngăn chặn vòng lặp</strong></h3>
<ul>
<li><strong>Dùng bucket riêng</strong>:</li>
<li>Luôn sử dụng <strong>một bucket riêng biệt</strong> để lưu log.</li>
<li>
<p>Ví dụ:</p>
<ul>
<li>Monitored bucket: <code>example-bucket</code>.</li>
<li>Logging bucket: <code>logs-bucket</code>.</li>
</ul>
</li>
<li>
<p><strong>Cách kiểm tra cấu hình</strong>:</p>
</li>
<li>Đảm bảo <strong>Target Bucket</strong> (logging bucket) trong cấu hình Access Logs khác với monitored bucket.</li>
</ul>
<hr />
<h3 id="6-vi-du-minh-hoa-truc-quan-voi-bucket-rieng"><strong>6. Ví dụ minh họa trực quan với bucket riêng</strong></h3>
<p>Nếu bạn cấu hình đúng:
- Monitored bucket: <code>example-bucket</code>.
- Logging bucket: <code>logs-bucket</code>.</p>
<ol>
<li>Người dùng tải lên file <code>file1.txt</code> vào <code>example-bucket</code>.</li>
<li>Hệ thống ghi log: Tạo file log <code>log1.txt</code> và lưu vào <code>logs-bucket</code>.</li>
<li>File log được lưu trong <code>logs-bucket</code> <strong>(không quay lại monitored bucket)</strong>, nên không có vòng lặp.</li>
</ol>
<hr />












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      <script id="__config" type="application/json">{"base": "../../../../..", "features": ["content.code.copy", "content.action.edit"], "search": "../../../../../assets/javascripts/workers/search.f8cc74c7.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../../../../../assets/javascripts/bundle.c8b220af.min.js"></script>
      
    
  </body>
</html>