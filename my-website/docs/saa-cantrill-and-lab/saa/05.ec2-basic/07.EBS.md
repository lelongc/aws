## 💽 AWS EBS (Elastic Block Store) Fundamentals – Tổng quan, kiến trúc & lưu ý thực tế

---

## 1. EBS là gì?

<img width="852" height="429" alt="image" src="https://github.com/user-attachments/assets/28211147-60ff-43fd-8a79-308edbfc8699" />

- **EBS (Elastic Block Store):** Dịch vụ Block Storage trên AWS.
- Cung cấp volume (ổ đĩa ảo) cho EC2, có thể attach/detach linh hoạt.
- EC2 nhìn thấy EBS giống như 1 ổ cứng vật lý, tạo file system (ext4, NTFS, XFS, ...).

---

## 2. Kiến trúc & đặc điểm quan trọng

### **Availability Zone (AZ)**
- **EBS là dịch vụ theo AZ** (Availability Zone), giống EC2.
- Volume EBS chỉ attach được vào EC2 cùng AZ.
- Không được cross-AZ (không attach volume ở AZ này vào EC2 ở AZ khác).
- Nếu AZ bị sự cố toàn phần, EBS trong AZ đó cũng bị ảnh hưởng.

### **Persistence & Lifecycle**
- **EBS là Persistent Storage**: volume tồn tại độc lập với EC2 (stop/start, restart, terminate instance, volume vẫn còn trừ khi bạn delete).
- Có thể detach volume khỏi 1 EC2 và attach sang EC2 khác (cùng AZ).

### **Resilience**
- EBS volume được replicate nội bộ trong AZ (trên nhiều physical disk khác nhau).
- Một AZ fail hoàn toàn thì EBS cũng mất (backup bằng snapshot để chống rủi ro này).

---

## 3. Snapshot – Sao lưu & chuyển vùng

- **Snapshot:** Backup EBS volume lên S3 (object storage, region-level durability).
- Snapshot có thể dùng để:
  - Restore/recover lại volume khi mất/hỏng.
  - Tạo volume mới ở AZ khác (từ snapshot).
  - Copy snapshot sang region khác để DR (disaster recovery).
- **Lưu ý:** Snapshot là region-level, volume là AZ-level.

---

## 4. Tính năng & phân loại

- **Volume Types:** SSD (hiệu năng cao), HDD (dung lượng lớn).
- **Multi-Attach:** Một số loại volume (ví dụ io2) có thể attach vào nhiều EC2 cùng lúc (dùng cho cluster), nhưng phải có app quản lý đồng thời ghi/đọc (tránh corruption).
- **Encryption:** Hỗ trợ mã hóa bằng KMS (sẽ học riêng ở bài encryption).
- **Resize:** Có thể tăng dung lượng volume, thay đổi loại volume mà không bị downtime.

---

## 5. Billing – Tính phí

- **Tính phí theo GB/tháng.**
  - 1GB dùng 1 tháng = 2GB dùng nửa tháng, v.v.
- Một số loại volume/option sẽ có extra phí (Provisioned IOPS, Multi-Attach, ...).

---

## 6. Lưu đồ kiến trúc EBS (mô tả nhanh)

<img width="840" height="448" alt="image" src="https://github.com/user-attachments/assets/03e1e719-2a03-4fb1-99b2-276fc9c27dc5" />

```
Region: us-east-1
├── AZ-a:
│   ├── EC2 Instance 1 <─> EBS Volume A1
│   └── EC2 Instance 2 <─> EBS Volume A2
├── AZ-b:
│   └── EC2 Instance 3 <─> EBS Volume B1
└── S3 (region-level): Lưu snapshot của các volume
```

- Volume chỉ attach được vào EC2 trong cùng AZ.
- Snapshot từ AZ-a có thể tạo volume ở AZ-b (hoặc region khác).

---

## 7. Thực tế & lưu ý đi thi

- **Không bao giờ attach volume cross-AZ.**
- **Detach/attach volume thoải mái giữa các EC2 trong 1 AZ.**
- **Snapshot là cách backup, migrate, DR tốt nhất cho EBS.**
- **Billing tính theo dung lượng GB/tháng, chú ý không xóa volume/snapshot sẽ tốn phí.**
- **Multi-Attach chỉ dùng cho workload cluster đặc biệt (VD: Oracle RAC, cần app support).**
- **Luôn backup bằng snapshot để phòng AZ fail.**

---

## 8. Các câu hỏi exam hay gặp

1. **"EBS có attach được cross-AZ không?"** → Không.
2. **"Volume mất khi EC2 terminate?"** → Tùy thuộc flag "Delete on termination"; mặc định root volume sẽ xóa, data volume thì không.
3. **"Snapshot có dùng tạo volume ở AZ khác được không?"** → Có.
4. **"EBS có tự động replicate cross-region không?"** → Không (phải copy snapshot thủ công).
5. **"EBS volume mất khi AZ fail?"** → Có thể mất nếu AZ mất hoàn toàn (phòng bằng snapshot).

---

**Nhớ:**  
- EBS = Block Storage, AZ-level, persistent, attach/detach linh hoạt, backup bằng snapshot (S3, region-level).
- Luôn để ý đến backup, billing và AZ khi thiết kế giải pháp EC2 + EBS trên AWS!
