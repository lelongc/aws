## ğŸ–¥ï¸ AWS EC2 Architecture Fundamentals: Hiá»ƒu sÃ¢u Ä‘á»ƒ master EC2 (Äá»§ thi cert & Ä‘i lÃ m)

---

## ğŸ¯ Táº¡i sao hiá»ƒu EC2 Architecture quan trá»ng?

### **EC2 = Most Important AWS Service**
- **Most frequently used** AWS service
- **Most exam questions** vá» EC2
- **Foundation** cho nhiá»u AWS services khÃ¡c
- **Real-world impact:** Hiá»ƒu architecture â†’ optimize cost & performance

---

## PHáº¦N 1: EC2 High-Level Architecture

### **EC2 Instance = Virtual Machine**
```yaml
ğŸ–¥ï¸ EC2 Instance components:
â”œâ”€â”€ Operating System (Linux/Windows)
â”œâ”€â”€ Virtual CPU (vCPU)
â”œâ”€â”€ Memory (RAM)
â”œâ”€â”€ Storage
â”‚   â”œâ”€â”€ Instance Store (temporary)
â”‚   â””â”€â”€ EBS Volumes (persistent)
â”œâ”€â”€ Network Interface (ENI)
â””â”€â”€ Additional hardware (GPU, etc.)
```

### **EC2 Hosts = Physical Servers**
```yaml
ğŸ¢ EC2 Host types:

Shared Hosts (Default):
  âœ… Multiple customers share same hardware
  âœ… Complete isolation between customers
  âœ… Pay per instance usage
  âœ… No hardware ownership
  
Dedicated Hosts:
  âœ… Entire host dedicated to your account
  âœ… You pay for whole host
  âœ… No sharing with other customers
  âœ… License compliance use cases
```

---

## PHáº¦N 2: CRITICAL Concept - Availability Zone (AZ) Resilience
<img width="715" height="408" alt="image" src="https://github.com/user-attachments/assets/0e65676c-7102-41e8-807d-89d798d91e24" />

### **ğŸš¨ EXAM KILLER: EC2 is AZ-Resilient Service**
```yaml
â— CRITICAL POINT (Remember this!):
  - EC2 hosts run in SINGLE AZ
  - AZ fails â†’ EC2 instances in that AZ fail
  - Cannot move instances between AZs natively
  - All EC2 components tied to specific AZ
```

### **Visual Architecture**
```yaml
ğŸ—ï¸ Region: us-east-1
â”œâ”€â”€ AZ-A (us-east-1a)
â”‚   â”œâ”€â”€ EC2 Host 1
â”‚   â”‚   â”œâ”€â”€ Instance A1 (Customer 1)
â”‚   â”‚   â””â”€â”€ Instance A2 (Customer 2)
â”‚   â”œâ”€â”€ EBS Service (AZ-A)
â”‚   â””â”€â”€ Subnet A (10.0.1.0/24)
â””â”€â”€ AZ-B (us-east-1b)
    â”œâ”€â”€ EC2 Host 2
    â”‚   â”œâ”€â”€ Instance B1 (Customer 1)
    â”‚   â””â”€â”€ Instance B2 (Customer 3)
    â”œâ”€â”€ EBS Service (AZ-B)
    â””â”€â”€ Subnet B (10.0.2.0/24)
```

---

## PHáº¦N 3: EC2 Storage Architecture

### **Instance Store vs EBS**
```yaml
ğŸ’¾ Storage options:

Instance Store (Temporary):
  âœ… Physical storage on EC2 host
  âœ… Very high performance
  âŒ Lost when instance stopped/moved
  âŒ Not persistent
  Use case: Cache, temporary processing

EBS (Elastic Block Store):
  âœ… Persistent network storage
  âœ… Survives instance stop/start
  âœ… Can snapshot for backup
  âŒ Network-based (slight latency)
  Use case: OS, databases, persistent data
```

### **AZ Storage Isolation**
```yaml
ğŸ”’ Storage isolation rules:
  - EBS volume in AZ-A â†’ only attach to instances in AZ-A
  - Cannot attach EBS from AZ-A to instance in AZ-B
  - Each AZ has separate EBS service
  - Instance Store tied to specific host in specific AZ
```

---

## PHáº¦N 4: EC2 Networking Architecture

### **Elastic Network Interface (ENI)**
```yaml
ğŸŒ ENI characteristics:
  - Primary ENI: Auto-created with instance
  - Secondary ENI: Can attach multiple
  - ENI belongs to specific subnet
  - Subnet belongs to specific AZ
  - Instance + ENI must be in same AZ
```

### **Networking Types**
```yaml
ğŸ”— Two types of networking:

Storage Networking:
  - EBS communication
  - High bandwidth for data transfer
  
Data Networking:
  - Application traffic
  - User communication
  - Internet connectivity
```

---

## PHáº¦N 5: Instance Lifecycle & Host Relationship

### **Instance-Host Relationship**
```yaml
ğŸ”„ Instance lifecycle:

Normal restart:
  âœ… Instance stays on same host
  âœ… All data preserved
  âœ… No disruption
  
Stop â†’ Start:
  âš ï¸ Instance may move to different host
  âš ï¸ Same AZ, different physical server
  âš ï¸ Instance Store data lost
  âœ… EBS data preserved
  
Host failure:
  ğŸ†˜ Instance automatically moved to new host
  ğŸ†˜ Instance Store data lost
  âœ… EBS data preserved
```

### **When Instance Moves Hosts**
```yaml
ğŸšš Instance moves when:
  1. Host hardware failure
  2. Host maintenance by AWS
  3. Instance stopped then started (not restart)
  
Always stays in same AZ!
```

---

## PHáº¦N 6: Resource Sharing on Hosts

### **Host Resource Sharing**
```yaml
ğŸ  EC2 Host characteristics:
  - Multiple instances from different customers
  - Generally same instance type/generation per host
  - Complete isolation between customers
  - Shared CPU, memory, network resources
  - Fair share scheduling
```

### **Instance Type Grouping**
```yaml
ğŸ“Š Host grouping logic:
  Host Type A: C5.large, C5.xlarge instances
  Host Type B: M5.large, M5.xlarge instances
  Host Type C: R5.large, R5.xlarge instances
  
  Same generation + family â†’ same host type
```

---

## PHáº¦N 7: When to Use EC2? (Cá»±c quan trá»ng cho exam)

### **âœ… EC2 Perfect For:**
```yaml
ğŸ¯ Ideal use cases:

Traditional OS + Application:
  - Legacy applications
  - Specific OS requirements
  - Vendor support needs
  
Long-running Compute:
  - 24/7 applications
  - Persistent services
  - Always-on requirements
  
Server-style Applications:
  - Web servers
  - Database servers
  - Application servers
  
Burst or Steady-state:
  - Variable workloads
  - Consistent processing
  - Predictable patterns
  
Monolithic Applications:
  - Single-tier applications
  - Tightly coupled components
  - Traditional architecture
  
Migration Scenarios:
  - Lift-and-shift migrations
  - Disaster recovery
  - Hybrid cloud setups
```

### **âŒ Consider Alternatives When:**
```yaml
âš ï¸ EC2 might not be best for:

Short-running tasks:
  â†’ Consider Lambda
  
Container workloads:
  â†’ Consider ECS/EKS
  
Serverless requirements:
  â†’ Consider Lambda/Fargate
  
Event-driven processing:
  â†’ Consider Lambda + SQS
  
Microservices:
  â†’ Consider ECS/EKS + containers
```

---

## PHáº¦N 8: Architecture Implications for High Availability

### **Design for AZ Failure**
```yaml
ğŸ—ï¸ HA Architecture patterns:

Single AZ (Not HA):
  âŒ All instances in one AZ
  âŒ AZ failure = complete outage
  
Multi-AZ (HA):
  âœ… Instances across multiple AZs
  âœ… Load balancer distributes traffic
  âœ… AZ failure = partial capacity reduction
  âœ… Auto scaling compensates
```

### **Cross-AZ Considerations**
```yaml
âš¡ Cross-AZ implications:

Network:
  - Cross-AZ traffic = small latency increase
  - Data transfer charges apply
  
Storage:
  - EBS replication across AZs (automatic)
  - Snapshots stored in S3 (multi-AZ)
  
Design:
  - Design assuming AZ can fail completely
  - Use AZ isolation as blast radius control
```

---

## PHáº¦N 9: Checklist kiáº¿n thá»©c thi cert & phá»ng váº¥n

### **Core Architecture Points**
- [x] EC2 is AZ-resilient service (instances tied to specific AZ)
- [x] Instances run on shared or dedicated hosts
- [x] Instance Store = temporary, EBS = persistent
- [x] ENI belongs to specific subnet in specific AZ
- [x] Stop/start may move instance to different host (same AZ)

### **Storage Rules**
- [x] EBS volumes can only attach to instances in same AZ
- [x] Instance Store lost when instance moves hosts
- [x] Cannot cross AZ boundaries with storage or networking

### **Use Case Guidelines**
- [x] EC2 = default for traditional workloads
- [x] Long-running, persistent applications
- [x] OS-specific requirements
- [x] Monolithic applications
- [x] Migration scenarios

### **CÃ¢u há»i exam killer**
1. **"EC2 instance fails, what happens to Instance Store?"** â†’ Lost
2. **"Can attach EBS from AZ-A to instance in AZ-B?"** â†’ No
3. **"Instance stopped then started, stays on same host?"** â†’ Maybe not
4. **"AZ failure impact on EC2?"** â†’ All instances in that AZ affected
5. **"Best for short-running tasks: EC2 or Lambda?"** â†’ Lambda

---

## PHáº¦N 10: Real-world Architecture Tips

### **Production Best Practices**
```yaml
ğŸ­ Enterprise patterns:

Multi-AZ deployment:
  - Always deploy across multiple AZs
  - Use Auto Scaling Groups
  - Application Load Balancer for distribution
  
Storage strategy:
  - EBS for persistent data
  - Instance Store for temporary/cache
  - Regular EBS snapshots
  
Monitoring:
  - CloudWatch for metrics
  - Systems Manager for patching
  - AWS Config for compliance
```

### **Cost Optimization**
```yaml
ğŸ’° Cost optimization strategies:

Right-sizing:
  - Monitor CPU/memory utilization
  - Resize instances based on usage
  
Instance purchasing:
  - On-Demand for variable workloads
  - Reserved for steady-state
  - Spot for fault-tolerant workloads
  
Architecture optimization:
  - Consider serverless alternatives
  - Use managed services where possible
```

---

## PHáº¦N 11: Tá»•ng káº¿t

- **EC2 = AZ-resilient virtual machines** trÃªn shared/dedicated hosts
- **Critical understanding: Everything tied to specific AZ** 
- **Design for AZ failure** vá»›i multi-AZ architectures
- **EC2 = default choice** cho traditional workloads
- **Instance Store vs EBS** = temporary vs persistent storage
- **Stop/start â‰  restart** vá» host placement

---

**Ghi nhá»›:** EC2 architecture understanding lÃ  foundation cho táº¥t cáº£ advanced AWS concepts. Master AZ concept sáº½ giÃºp báº¡n ace exam questions vá» availability, disaster recovery, vÃ  performance!

**Next:** Deep dive vÃ o EC2 Instance Types, Sizing, vÃ  AWS Nitro System!
