

## üöÄ AWS EC2 Instance Store: Ki·∫øn th·ª©c ƒë·∫ßy ƒë·ªß ƒëi l√†m & ƒëi thi (script th·ª±c t·∫ø, m·∫πo exam)

---

## 1. Instance Store l√† g√¨? (Kh√°i ni·ªám & b·∫£n ch·∫•t)

- **Instance Store** l√† storage **local** g·∫Øn tr·ª±c ti·∫øp v√†o EC2 host v·∫≠t l√Ω (block device, ephemeral).
- **Ephemeral = t·∫°m th·ªùi:** M·∫§T d·ªØ li·ªáu khi:
  - Instance **stop/start, terminate, reboot, migrate** (maintenance, resize, change type)
  - **Host failure** (h·ªèng v·∫≠t l√Ω)
- **Kh√¥ng ph·∫£i EBS**: Kh√¥ng network, kh√¥ng persistent, kh√¥ng snapshot/backup ƒë∆∞·ª£c.
- **Hi·ªáu nƒÉng:** C·ª∞C CAO (IOPS/throughput v∆∞·ª£t xa EBS, nh·∫•t l√† NVMe SSD).
- **Chi ph√≠:** Bao g·ªìm trong gi√° instance (d√πng hay kh√¥ng v·∫´n tr·∫£ ti·ªÅn).

---

## 2. Ki·∫øn tr√∫c & ƒë·∫∑c ƒëi·ªÉm k·ªπ thu·∫≠t

<img width="819" height="447" alt="image" src="https://github.com/user-attachments/assets/e19eb268-81da-442d-9a8e-305f850b49ca" />


- **Attach only at launch:** Ch·ªâ add ƒë∆∞·ª£c khi launch instance (EXAM!).
  - Kh√¥ng th·ªÉ th√™m/b·ªõt instance store sau khi EC2 ƒë√£ ch·∫°y.
- **S·ªë l∆∞·ª£ng/lo·∫°i/size:** Ph·ª• thu·ªôc instance type/size (i3, i4i, d3, h1, m5d, c5d, z1d...)
- **G·∫Øn v√†o OS:** Nh√¨n nh∆∞ block device (ephemeral0, ephemeral1...), b·∫°n t·∫°o file system, mount nh∆∞ b√¨nh th∆∞·ªùng.
- **Kh√¥ng snapshot/backup:** Kh√¥ng c√≥ t√≠nh nƒÉng snapshot nh∆∞ EBS; data bi·∫øn m·∫•t vƒ©nh vi·ªÖn khi m·∫•t instance ho·∫∑c host.

---

## 3. Khi n√†o n√™n d√πng Instance Store?

- **Workload c·∫ßn performance c·ª±c cao, data _replaceable_:**
  - Cache, temporary buffer, scratch space (Spark/Hadoop temp, ETL, batch processing)
  - Log, staging area, swap, NoSQL temp data
  - Big data streaming, analytics intermediate data
- **Kh√¥ng d√πng cho:** Database production, boot volume, b·∫•t k·ª≥ data quan tr·ªçng/persistent

---

## 4. ∆Øu/Nh∆∞·ª£c ƒëi·ªÉm & so s√°nh v·ªõi EBS

| Ti√™u ch√≠               | Instance Store           | EBS (gp3/io2/st1/sc1)           |
|------------------------|-------------------------|----------------------------------|
| Persistent             | Kh√¥ng                   | C√≥                              |
| Performance            | Si√™u cao                | Cao nh∆∞ng th·∫•p h∆°n               |
| Attach/detach          | Ch·ªâ khi launch          | Linh ho·∫°t                        |
| Snapshot/backup        | Kh√¥ng                   | C√≥ (snapshot S3, backup/restore) |
| Data loss on stop/start| C√≥                      | Kh√¥ng                            |
| Billing                | Bao g·ªìm trong gi√° EC2   | T√≠nh ph√≠ ri√™ng (GB/th√°ng)        |
| Use case               | Temp/cache/scratch      | Data quan tr·ªçng, DB, boot        |

**Key exam:**  
- Instance store = ephemeral = m·∫•t data khi stop/start/migrate.
- EBS = persistent, attach/detach linh ho·∫°t, backup ƒë∆∞·ª£c.

---

## 5. Limitation th·ª±c t·∫ø & l∆∞u √Ω v·∫≠n h√†nh

- **M·∫§T D·ªÆ LI·ªÜU khi:**
  - Instance stop/start, terminate, migrate (maintenance/chuy·ªÉn host)
  - Resize/change instance type
  - Host failure (hardware)
- **Kh√¥ng th·ªÉ backup/restore:** Ch·ªâ copy data b·∫±ng ch√≠nh app/script c·ªßa b·∫°n.
- **Kh√¥ng d√πng cho data c·∫ßn b·ªÅn v·ªØng ho·∫∑c b·∫•t k·ª≥ th·ª© g√¨ kh√¥ng t√°i t·∫°o ƒë∆∞·ª£c!**
- **L√†m vi·ªác v·ªõi c√°c block device ephemeral0, ephemeral1,...; t·∫°o xfs/ext4, mount th·ªß c√¥ng**
- **Performance:**  
  - i3.16xlarge (NVMe SSD): 2M IOPS read, ~16GB/s throughput (so v·ªõi EBS io2 max 64k IOPS, 1GB/s)
  - d3/h1: HDD dung l∆∞·ª£ng l·ªõn, throughput c·ª±c cao cho workloads sequential.
  
<img width="835" height="450" alt="image" src="https://github.com/user-attachments/assets/686dde2a-2fc2-40bb-b5c2-723908d61102" />

---

## 6. Mapping nhanh: EC2 + Instance Store

| Instance family | Lo·∫°i instance store | Dung l∆∞·ª£ng/c√°i | S·ªë l∆∞·ª£ng/c√°i  | Use case ch√≠nh         |
|-----------------|--------------------|----------------|---------------|------------------------|
| i3, i4i         | NVMe SSD           | 900GB‚Äì15TB     | 1‚Äì8           | OLAP, Spark, cache     |
| d3, h1          | HDD                | 2TB‚Äì16TB       | 1‚Äì8           | Big data, streaming    |
| c5d, m5d, z1d   | NVMe SSD           | 75GB‚Äì1.8TB     | 1             | App cache, temp, swap  |

- **Check AWS docs:** Instance type n√†o c√≥ instance store, size/quantity ra sao (script ƒëi l√†m c·∫ßn thu·ªôc nh√≥m ph·ªï bi·∫øn).

---

## 7. C√¢u h·ªèi exam/ph·ªèng v·∫•n hay g·∫∑p

- **"Instance store c√≥ persistent kh√¥ng?"** ‚Üí Kh√¥ng, ephemeral, m·∫•t data khi stop/start/terminate/migrate
- **"C√≥ attach ƒë∆∞·ª£c instance store cho EC2 ƒëang ch·∫°y kh√¥ng?"** ‚Üí Kh√¥ng, ch·ªâ add l√∫c launch
- **"Workload n√†o n√™n d√πng instance store?"** ‚Üí Cache/temp/buffer/scratch, Spark/Hadoop, log t·∫°m
- **"C√≥ backup/snapshot instance store kh√¥ng?"** ‚Üí Kh√¥ng, ch·ªâ EBS m·ªõi c√≥ snapshot
- **"T·∫°i sao ch·ªçn EBS thay instance store?"** ‚Üí Persistent, backup, attach linh ho·∫°t
- **"Khi n√†o instance store m·∫•t data?"** ‚Üí Stop/start/terminate/migrate, hardware failure
- **"Performance instance store vs EBS?"** ‚Üí Instance store v∆∞·ª£t tr·ªôi (IOPS, throughput)
- **"C√≥ n√™n l∆∞u file quan tr·ªçng l√™n instance store?"** ‚Üí Kh√¥ng! Ch·ªâ l∆∞u data c√≥ th·ªÉ m·∫•t/kh√¥i ph·ª•c

---

## 8. M·∫πo th·ª±c t·∫ø v·∫≠n h√†nh

- **Lu√¥n script h√≥a l∆∞u/log data ra EBS/S3 n·∫øu c·∫ßn backup.**
- **Tr√°nh l∆∞u b·∫•t k·ª≥ state/data quan tr·ªçng tr√™n instance store.**
- **Gi√°m s√°t hardware health (CloudWatch, EC2 events), ch·ªß ƒë·ªông migrate data n·∫øu c·∫ßn.**
- **D√πng RAID0 (striping) n·∫øu c·∫ßn aggregate nhi·ªÅu instance store device cho hi·ªáu nƒÉng max.**
- **D√πng instance store t·ªëi ƒëa n·∫øu ƒë√£ tr·∫£ ph√≠ (d√πng ho·∫∑c b·ªè ph√≠).**
- **Filesystem mount: t·∫°o xfs/ext4, mount v√†o /mnt/ephemeral* ho·∫∑c custom path.**

---

## 9. L·ªánh m·∫´u th·ª±c t·∫ø

```bash
# Li·ªát k√™ block device instance store (th∆∞·ªùng l√† /dev/nvme* ho·∫∑c /dev/xvd*)
lsblk

# Format v√† mount
mkfs.xfs /dev/nvme1n1
mkdir -p /mnt/ephemeral1
mount /dev/nvme1n1 /mnt/ephemeral1

# Ki·ªÉm tra hi·ªáu nƒÉng
fio --name=randrw --filename=/dev/nvme1n1 --rw=randrw --bs=4k --iodepth=32 --numjobs=4 --runtime=60 --time_based --ioengine=libaio --direct=1
```

---

## 10. T√≥m t·∫Øt nh·ªõ l√¢u

- **Instance Store = ephemeral, local, hi·ªáu nƒÉng cao, m·∫•t data khi stop/start, kh√¥ng snapshot, ch·ªâ add khi launch.**
- **Ch·ªâ d√πng cho data cache/temp/buffer, kh√¥ng bao gi·ªù d√πng cho data quan tr·ªçng ho·∫∑c c·∫ßn backup.**
- **EBS = persistent, backup ƒë∆∞·ª£c, attach ƒë·ªông, d√πng cho m·ªçi data c·∫ßn b·ªÅn v·ªØng.**
- **Lu√¥n ki·ªÉm tra instance type ƒë·ªÉ bi·∫øt c√≥ instance store kh√¥ng, s·ªë l∆∞·ª£ng/dung l∆∞·ª£ng ra sao.**

---
