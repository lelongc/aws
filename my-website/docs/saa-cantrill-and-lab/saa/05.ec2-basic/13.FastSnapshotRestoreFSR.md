## üì∏ AWS EBS Snapshot ‚Äì Th·ª±c t·∫ø ƒëi l√†m & m·∫πo exam (script chi ti·∫øt)
<img width="818" height="458" alt="image" src="https://github.com/user-attachments/assets/e726e4e3-240b-4d7f-88ac-5576732cc2c0" />
<img width="828" height="454" alt="image" src="https://github.com/user-attachments/assets/7ea4189b-9fc5-4408-bcf2-ccead49c07e8" />
<img width="793" height="465" alt="image" src="https://github.com/user-attachments/assets/46d6c649-8bef-4be5-8fed-50c5fa3cc1bf" />
<img width="827" height="468" alt="image" src="https://github.com/user-attachments/assets/d8b41b14-e257-499d-b737-1865bf742c8c" />

---

## 1. EBS Snapshot l√† g√¨? Ki·∫øn tr√∫c & ·ª©ng d·ª•ng th·ª±c t·∫ø

- **Snapshot = backup EBS volume l√™n S3** (region-level durability, ch·ªëng m·∫•t AZ/local disk, DR/migration).
- **Incremental:**  
  - L·∫ßn ƒë·∫ßu: full backup (ch·ªâ data ƒë√£ d√πng, kh√¥ng ph·∫£i to√†n b·ªô size volume).
  - C√°c l·∫ßn sau: ch·ªâ l∆∞u **data thay ƒë·ªïi** so v·ªõi snapshot tr∆∞·ªõc , volume 40 d√πng 10 th√¨ snapshot l√† 10 GB
- **Self-sufficient:**  
  - X√≥a snapshot gi·ªØa chu·ªói kh√¥ng l√†m m·∫•t data, v√¨ AWS t·ª± di chuy·ªÉn data c·∫ßn thi·∫øt ƒë·ªÉ m·ªçi snapshot sau v·∫´n restore ƒë∆∞·ª£c.
- **D√πng snapshot ƒë·ªÉ:**
  - Kh√¥i ph·ª•c (restore) volume khi m·∫•t/h·ªèng.
  - Clone volume (t·∫°o volume m·ªõi t·ª´ snapshot, c√≥ th·ªÉ ·ªü AZ kh√°c, region kh√°c).
  - Di chuy·ªÉn d·ªØ li·ªáu gi·ªØa AZ/region (DR/migration).

---

## 2. C∆° ch·∫ø, billing & chi ph√≠

- **Snapshot l∆∞u tr√™n S3 (region-level):** Kh√¥ng ph·ª• thu·ªôc AZ.
- **Ch·ªâ t√≠nh ph√≠ theo **data th·ª±c s·ª≠ d·ª•ng** (used data), kh√¥ng ph·∫£i to√†n b·ªô dung l∆∞·ª£ng volume.
  - V√≠ d·ª•: Volume 40GB, d√πng 10GB ‚Üí snapshot full ƒë·∫ßu ti√™n ch·ªâ t√≠nh ph√≠ 10GB.
- **Incremental:**  
  - M·ªói snapshot ch·ªâ t√≠nh ph·∫ßn data ph√°t sinh/ch·ªânh s·ª≠a so v·ªõi l·∫ßn tr∆∞·ªõc.
  - Snapshot nhi·ªÅu l·∫ßn/ng√†y c≈©ng kh√¥ng tƒÉng ph√≠ n·∫øu data kh√¥ng ƒë·ªïi.
- **Billing:** GB-th√°ng (10GB snapshot 1 th√°ng = 10GB-th√°ng).

---

## 3. Restore volume t·ª´ snapshot: Th·ª±c t·∫ø & t·ªëi ∆∞u hi·ªáu nƒÉng

- **Restore volume t·ª´ snapshot:**  
  - Volume t·∫°o ra _ch∆∞a c√≥ to√†n b·ªô data local_, data ƒë∆∞·ª£c copy d·∫ßn t·ª´ S3 v·ªÅ EBS khi truy c·∫≠p (lazy restore).
  - L·∫ßn ƒë·∫ßu truy c·∫≠p block ch∆∞a copy s·∫Ω b·ªã **performance th·∫•p** h∆°n; sau khi data local ‚Üí hi·ªáu nƒÉng t·ªëi ƒëa.
- **T·ªëi ∆∞u:**  
  - **Force read all blocks**: D√πng `dd`/`fio`/`cat` ƒë·ªÉ ƒë·ªçc h·∫øt block ‚Üí force data t·ª´ S3 v·ªÅ volume m·ªõi.
  - **Fast Snapshot Restore (FSR):**  
    - B·∫≠t FSR l√™n snapshot + AZ c·∫ßn d√πng ‚Üí volume restore ra s·∫Ω lu√¥n ready, kh√¥ng c·∫ßn force read.
    - **Gi·ªõi h·∫°n:** 50 FSR/AZ/region, t√≠nh ph√≠ ri√™ng.
    - FSR = ch·ªçn snapshot + AZ, m·ªói c·∫∑p snapshot/AZ t√≠nh 1 quota (VD: 1 snap x 4 AZ = 4 FSR).

---

## 4. Quy tr√¨nh th·ª±c t·∫ø (script ƒëi l√†m)

```bash
# T·∫°o snapshot t·ª´ volume
aws ec2 create-snapshot --volume-id vol-0123456789abcdef --description "Backup daily"

# T·∫°o volume m·ªõi t·ª´ snapshot (c√≥ th·ªÉ ch·ªçn AZ kh√°c)
aws ec2 create-volume --snapshot-id snap-0123abcd --availability-zone ap-southeast-1b --volume-type gp3

# Force restore (Linux)
dd if=/dev/xvdf of=/dev/null bs=1M status=progress

# B·∫≠t FSR cho snapshot
aws ec2 enable-fast-snapshot-restores --source-snapshot-ids snap-0123abcd --availability-zones ap-southeast-1a

# Xem tr·∫°ng th√°i FSR
aws ec2 describe-fast-snapshot-restores --filters Name=snapshot-id,Values=snap-0123abcd
```

---

## 5. M·∫πo exam & l∆∞u √Ω th·ª±c t·∫ø quan tr·ªçng

- **Snapshot ch·ªâ backup data ƒë√£ d√πng, kh√¥ng ph·∫£i to√†n b·ªô volume size.**
- **Snapshot nhi·ªÅu l·∫ßn/ng√†y kh√¥ng tƒÉng ph√≠ n·∫øu kh√¥ng ƒë·ªïi/ch·ªânh s·ª≠a d·ªØ li·ªáu.**
- **D√πng snapshot ƒë·ªÉ clone/migrate volume gi·ªØa AZ/region (DR, blue/green).**
- **Restore t·ª´ snapshot = hi·ªáu nƒÉng th·∫•p l√∫c ƒë·∫ßu (tr·ª´ khi d√πng FSR ho·∫∑c force read block).**
- **FSR c√≥ ph√≠ ri√™ng, t·ªëi ƒëa 50 FSR/snapshot/region.**
- **X√≥a snapshot gi·ªØa chain kh√¥ng m·∫•t data, AWS auto gi·ªØ c√°c block c·∫ßn cho c√°c snapshot sau.**
- **Snapshot c≈©ng backup encryption (volume encrypted ‚Üí snapshot c≈©ng encrypted).**
- **Snapshot l∆∞u tr·ªØ ·ªü S3, kh√¥ng hi·ªÉn th·ªã tr·ª±c ti·∫øp trong bucket S3, ch·ªâ qu·∫£n l√Ω qua EBS API/Console.**
- **Billing t√≠nh theo GB-th√°ng d√πng th·ª±c t·∫ø (kh√¥ng ph·∫£i to√†n b·ªô disk).**

---

## 6. T√≥m t·∫Øt nh·ªõ l√¢u

- **Snapshot = backup EBS l√™n S3, incremental, chi ph√≠ tr√™n data th·ª±c d√πng, restore nhanh v·ªõi FSR ho·∫∑c force read.**
- **D√πng snapshot cho backup ƒë·ªãnh k·ª≥, DR, clone/migrate gi·ªØa AZ/region, rollback tr∆∞·ªõc khi upgrade.**
- **Lu√¥n nh·ªõ t·ªëi ∆∞u hi·ªáu nƒÉng restore b·∫±ng FSR ho·∫∑c force read khi c·∫ßn production ready!**

---
