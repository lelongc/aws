## ğŸ“¸ AWS EBS Snapshot â€“ Thá»±c táº¿ Ä‘i lÃ m & máº¹o exam (script chi tiáº¿t)
<img width="818" height="458" alt="image" src="https://github.com/user-attachments/assets/e726e4e3-240b-4d7f-88ac-5576732cc2c0" />
<img width="828" height="454" alt="image" src="https://github.com/user-attachments/assets/7ea4189b-9fc5-4408-bcf2-ccead49c07e8" />
<img width="793" height="465" alt="image" src="https://github.com/user-attachments/assets/46d6c649-8bef-4be5-8fed-50c5fa3cc1bf" />
<img width="827" height="468" alt="image" src="https://github.com/user-attachments/assets/d8b41b14-e257-499d-b737-1865bf742c8c" />

---

## 1. EBS Snapshot lÃ  gÃ¬? Kiáº¿n trÃºc & á»©ng dá»¥ng thá»±c táº¿

- **Snapshot = backup EBS volume lÃªn S3** (region-level durability, chá»‘ng máº¥t AZ/local disk, DR/migration).
- **Incremental:**  
  - Láº§n Ä‘áº§u: full backup (chá»‰ data Ä‘Ã£ dÃ¹ng, khÃ´ng pháº£i toÃ n bá»™ size volume).
  - CÃ¡c láº§n sau: chá»‰ lÆ°u **data thay Ä‘á»•i** so vá»›i snapshot trÆ°á»›c , volume 40 dÃ¹ng 10 thÃ¬ snapshot lÃ  10 GB
- **Self-sufficient:**  
  - XÃ³a snapshot giá»¯a chuá»—i khÃ´ng lÃ m máº¥t data, vÃ¬ AWS tá»± di chuyá»ƒn data cáº§n thiáº¿t Ä‘á»ƒ má»i snapshot sau váº«n restore Ä‘Æ°á»£c.
    
??? info "Self-sufficient"

    - Khi báº¡n **xÃ³a má»™t snapshot á»Ÿ giá»¯a chuá»—i** (khÃ´ng pháº£i snapshot Ä‘áº§u hoáº·c cuá»‘i), **dá»¯ liá»‡u cá»§a báº¡n khÃ´ng bá»‹ máº¥t**.
    - **AWS tá»± Ä‘á»™ng chuyá»ƒn cÃ¡c pháº§n dá»¯ liá»‡u cáº§n thiáº¿t** tá»« snapshot bá»‹ xÃ³a sang cÃ¡c snapshot sau nÃ³, Ä‘á»ƒ Ä‘áº£m báº£o cÃ¡c snapshot sau nÃ y **váº«n cÃ³ Ä‘áº§y Ä‘á»§ dá»¯ liá»‡u Ä‘á»ƒ phá»¥c há»“i (restore)**.
    - VÃ¬ váº­y, **báº¡n cÃ³ thá»ƒ xÃ³a snapshot cÅ© mÃ  khÃ´ng lo máº¥t dá»¯ liá»‡u**, miá»…n lÃ  váº«n cÃ²n snapshot má»›i hÆ¡n trong chuá»—i.
    
    **VÃ­ dá»¥ dá»… hiá»ƒu:**  
    Giáº£ sá»­ báº¡n cÃ³ 3 snapshot: A â†’ B â†’ C  
    - Náº¿u xÃ³a B, thÃ¬ AWS sáº½ chuyá»ƒn dá»¯ liá»‡u cáº§n thiáº¿t tá»« B sang C.  
    - Káº¿t quáº£: Báº¡n váº«n cÃ³ thá»ƒ restore tá»« C Ä‘áº§y Ä‘á»§ nhÆ° chÆ°a tá»«ng xÃ³a B.
    
    **TÃ³m láº¡i:** XÃ³a snapshot giá»¯a chuá»—i KHÃ”NG lÃ m máº¥t data, vÃ¬ AWS tá»± xá»­ lÃ½ Ä‘á»ƒ cÃ¡c snapshot cÃ²n láº¡i luÃ´n Ä‘á»§ dá»¯ liá»‡u Ä‘á»ƒ khÃ´i phá»¥c.
    - **DÃ¹ng snapshot Ä‘á»ƒ:**
      - KhÃ´i phá»¥c (restore) volume khi máº¥t/há»ng.
      - Clone volume (táº¡o volume má»›i tá»« snapshot, cÃ³ thá»ƒ á»Ÿ AZ khÃ¡c, region khÃ¡c).
      - Di chuyá»ƒn dá»¯ liá»‡u giá»¯a AZ/region (DR/migration).

---

## 2. CÆ¡ cháº¿, billing & chi phÃ­

- **Snapshot lÆ°u trÃªn S3 (region-level):** KhÃ´ng phá»¥ thuá»™c AZ.
- **Chá»‰ tÃ­nh phÃ­ theo **data thá»±c sá»­ dá»¥ng** (used data), khÃ´ng pháº£i toÃ n bá»™ dung lÆ°á»£ng volume.
  - VÃ­ dá»¥: Volume 40GB, dÃ¹ng 10GB â†’ snapshot full Ä‘áº§u tiÃªn chá»‰ tÃ­nh phÃ­ 10GB.
- **Incremental:**  
  - Má»—i snapshot chá»‰ tÃ­nh pháº§n data phÃ¡t sinh/chá»‰nh sá»­a so vá»›i láº§n trÆ°á»›c.
  - Snapshot nhiá»u láº§n/ngÃ y cÅ©ng khÃ´ng tÄƒng phÃ­ náº¿u data khÃ´ng Ä‘á»•i.
- **Billing:** GB-thÃ¡ng (10GB snapshot 1 thÃ¡ng = 10GB-thÃ¡ng).

---

## 3. Restore volume tá»« snapshot: Thá»±c táº¿ & tá»‘i Æ°u hiá»‡u nÄƒng

- **Restore volume tá»« snapshot:**  
  - Volume táº¡o ra _chÆ°a cÃ³ toÃ n bá»™ data local_, data Ä‘Æ°á»£c copy dáº§n tá»« S3 vá» EBS khi truy cáº­p (lazy restore).
  - Láº§n Ä‘áº§u truy cáº­p block chÆ°a copy sáº½ bá»‹ **performance tháº¥p** hÆ¡n; sau khi data local â†’ hiá»‡u nÄƒng tá»‘i Ä‘a.
- **Tá»‘i Æ°u:**  
  - **Force read all blocks**: DÃ¹ng `dd`/`fio`/`cat` Ä‘á»ƒ Ä‘á»c háº¿t block â†’ force data tá»« S3 vá» volume má»›i.
  - **Fast Snapshot Restore (FSR):**  
    - Báº­t FSR lÃªn snapshot + AZ cáº§n dÃ¹ng â†’ volume restore ra sáº½ luÃ´n ready, khÃ´ng cáº§n force read.
    - **Giá»›i háº¡n:** 50 FSR/AZ/region, tÃ­nh phÃ­ riÃªng.
    - FSR = chá»n snapshot + AZ, má»—i cáº·p snapshot/AZ tÃ­nh 1 quota (VD: 1 snap x 4 AZ = 4 FSR).

---

## 4. Quy trÃ¬nh thá»±c táº¿ (script Ä‘i lÃ m)

```bash
# Táº¡o snapshot tá»« volume
aws ec2 create-snapshot --volume-id vol-0123456789abcdef --description "Backup daily"

# Táº¡o volume má»›i tá»« snapshot (cÃ³ thá»ƒ chá»n AZ khÃ¡c)
aws ec2 create-volume --snapshot-id snap-0123abcd --availability-zone ap-southeast-1b --volume-type gp3

# Force restore (Linux)
dd if=/dev/xvdf of=/dev/null bs=1M status=progress

# Báº­t FSR cho snapshot
aws ec2 enable-fast-snapshot-restores --source-snapshot-ids snap-0123abcd --availability-zones ap-southeast-1a

# Xem tráº¡ng thÃ¡i FSR
aws ec2 describe-fast-snapshot-restores --filters Name=snapshot-id,Values=snap-0123abcd
```

---

## 5. Máº¹o exam & lÆ°u Ã½ thá»±c táº¿ quan trá»ng

- **Snapshot chá»‰ backup data Ä‘Ã£ dÃ¹ng, khÃ´ng pháº£i toÃ n bá»™ volume size.**
- **Snapshot nhiá»u láº§n/ngÃ y khÃ´ng tÄƒng phÃ­ náº¿u khÃ´ng Ä‘á»•i/chá»‰nh sá»­a dá»¯ liá»‡u.**
- **DÃ¹ng snapshot Ä‘á»ƒ clone/migrate volume giá»¯a AZ/region (DR, blue/green).**
- **Restore tá»« snapshot = hiá»‡u nÄƒng tháº¥p lÃºc Ä‘áº§u (trá»« khi dÃ¹ng FSR hoáº·c force read block).**
- **FSR cÃ³ phÃ­ riÃªng, tá»‘i Ä‘a 50 FSR/snapshot/region.**
- **XÃ³a snapshot giá»¯a chain khÃ´ng máº¥t data, AWS auto giá»¯ cÃ¡c block cáº§n cho cÃ¡c snapshot sau.**
- **Snapshot cÅ©ng backup encryption (volume encrypted â†’ snapshot cÅ©ng encrypted).**
- **Snapshot lÆ°u trá»¯ á»Ÿ S3, khÃ´ng hiá»ƒn thá»‹ trá»±c tiáº¿p trong bucket S3, chá»‰ quáº£n lÃ½ qua EBS API/Console.**
- **Billing tÃ­nh theo GB-thÃ¡ng dÃ¹ng thá»±c táº¿ (khÃ´ng pháº£i toÃ n bá»™ disk).10 GB dÃ¹ng 4 GB thÃ¬ giÃ¡ 4GB , 20GB ná»­a thÃ¡ng thÃ¬ giÃ¡  lÃ  10GB 1 thÃ¡ng **

---

## 6. TÃ³m táº¯t nhá»› lÃ¢u

- **Snapshot = backup EBS lÃªn S3, incremental, chi phÃ­ trÃªn data thá»±c dÃ¹ng, restore nhanh vá»›i FSR hoáº·c force read.**
- **DÃ¹ng snapshot cho backup Ä‘á»‹nh ká»³, DR, clone/migrate giá»¯a AZ/region, rollback trÆ°á»›c khi upgrade.**
- **LuÃ´n nhá»› tá»‘i Æ°u hiá»‡u nÄƒng restore báº±ng FSR hoáº·c force read khi cáº§n production ready!**

---
