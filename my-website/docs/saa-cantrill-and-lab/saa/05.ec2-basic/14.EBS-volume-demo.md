## üõ†Ô∏è Demo th·ª±c t·∫ø: L√†m vi·ªác v·ªõi EBS & Instance Store Tr√™n EC2 (script ƒë·∫ßy ƒë·ªß ƒëi l√†m & ƒëi thi)
1-Click Deployment
[https://console.aws.amazon.com/cloudformation/home?region=us-east-1#/stacks/create/review?templateURL=https://learn-cantrill-labs.s3.amazonaws.com/awscoursedemos/0004-aws-associate-ec2-ebs-demo/A4L_VPC_3PUBLICINSTANCES_AL2023.yaml&stackName=EBSDEMO](https://console.aws.amazon.com/cloudformation/home?region=us-east-1#/stacks/create/review?templateURL=https://learn-cantrill-labs.s3.amazonaws.com/awscoursedemos/0004-aws-associate-ec2-ebs-demo/A4L_VPC_3PUBLICINSTANCES_AL2023.yaml&stackName=EBSDEMO)


??? info "Lesson Commands"

    # Commands User  
    
    ## Instance 1
    
    lsblk
    sudo file -s /dev/xvdf
    sudo mkfs -t xfs /dev/xvdf
    sudo file -s /dev/xvdf
    sudo mkdir /ebstest
    sudo mount /dev/xvdf /ebstest
    cd /ebstest
    sudo nano amazingtestfile.txt
    add a message
    save and exit
    ls -la
    
    ## Reboot Instance 1
    
    sudo reboot
    
    ## Instance 1 After Reboot
    
    df -k
    sudo blkid
    sudo nano /etc/fstab
      ADD LINE 
      UUID=YOURUUIDHEREREPLACEME  /ebstest  xfs  defaults,nofail
    sudo mount -a
    cd /ebstest
    ls -la
    
    ## Instance 2
    
    lsblk 
    sudo file -s /dev/xvdf
    sudo mkdir /ebstest
    sudo mount /dev/xvdf /ebstest
    cd /ebstest
    ls -la
    
    ## Instance 3
    
    lsblk 
    sudo file -s /dev/xvdf
    sudo mkdir /ebstest
    sudo mount /dev/xvdf /ebstest
    cd /ebstest
    ls -la
    
    ## InstanceStoreTest
    
    lsblk
    sudo file -s /dev/nvme1n1 
    sudo mkfs -t xfs /dev/nvme1n1
    sudo file -s /dev/nvme1n1
    sudo mkdir /instancestore
    sudo mount /dev/nvme1n1 /instancestore
    cd /instancestore
    sudo touch instancestore.txt
    
    ## InstancStoreTest - After Restart
    
    df -k
    its not there
    but we can mount it
    sudo mount /dev/nvme1n1 /instancestore
    cd /instancestore
    ls -la
    
    ## InstanceStoreTest - After Stop/Start
    
    sudo file -s /dev/nvme1n1
    
[https://learn-cantrill-labs.s3.amazonaws.com/awscoursedemos/0004-aws-associate-ec2-ebs-demo/lesson_commands_AL2023.txt](https://learn-cantrill-labs.s3.amazonaws.com/awscoursedemos/0004-aws-associate-ec2-ebs-demo/lesson_commands_AL2023.txt)

---

## 1. B·ªëi c·∫£nh & l∆∞u √Ω chi ph√≠

- **Ph·∫ßn 1:** Demo EBS & snapshot (trong Free Tier)
- **Ph·∫ßn 2:** Demo Instance Store (c√≥ th·ªÉ m·∫•t ph√≠, ~0.13$/gi·ªù cho instance l·ªõn, kh√¥ng Free Tier)

---

## 2. Chu·∫©n b·ªã m√¥i tr∆∞·ªùng

- ƒêƒÉng nh·∫≠p AWS management account, ch·ªçn region **N. Virginia (us-east-1)**
- D√πng CloudFormation template ƒë·ªÉ t·∫°o s·∫µn **3 EC2 instances** (2 ·ªü AZ A, 1 ·ªü AZ B)
- M·ªü EC2 Console > Instances, ki·ªÉm tra c√≥ 3 instance: instance-1a, instance-2a, instance-1ab

---

## 3. Ki·ªÉm tra EBS volumes

- EC2 Console > Elastic Block Store > Volumes
- C√≥ 3 volume 8 GiB, m·ªói c√°i g·∫Øn v·ªõi 1 instance l√†m boot volume

---

## 4. T·∫°o EBS volume m·ªõi

- **Create Volume**
  - Volume type: **gp3**
  - Size: **10 GiB**
  - AZ: **us-east-1a**
  - Tag: key = `Name`, value = `EBS test volume`
- B·∫•m **Create volume**, ch·ªù tr·∫°ng th√°i ‚Äúavailable‚Äù

---

## 5. Attach volume v√†o EC2

- Ch·ªçn volume v·ª´a t·∫°o > Actions > Attach volume
- Ch·ªçn instance **instance-1a** (ch·ªâ th·∫•y instance c√πng AZ)
- Device: `/dev/sdf` (Linux c√≥ th·ªÉ nh·∫≠n l√† `/dev/xvdf`)
- B·∫•m **Attach**

---

## 6. SSH/Connect v√†o EC2 instance

- EC2 Console > Instances > Ch·ªçn **instance-1a** > Connect > EC2 Instance Connect
- User: `ec2-user`

---

## 7. Thao t√°c tr√™n Linux (copy, paste t·ª´ng d√≤ng)

```bash
# Xem block devices
lsblk

# Ki·ªÉm tra file system (vd: tr√™n xvdf)
sudo file -s /dev/xvdf
# N·∫øu tr·∫£ v·ªÅ "data", ch∆∞a c√≥ file system

# T·∫°o file system (XFS)
sudo mkfs -t xfs /dev/xvdf

# Ki·ªÉm tra l·∫°i file system
sudo file -s /dev/xvdf

# T·∫°o mount point
sudo mkdir /EBS-test

# Mount volume v√†o th∆∞ m·ª•c
sudo mount /dev/xvdf /EBS-test

# Ki·ªÉm tra mount
df -h

# Chuy·ªÉn v√†o th∆∞ m·ª•c mount
cd /EBS-test

# T·∫°o file test
sudo nano amazing-test-file.txt
# (Nh·∫≠p n·ªôi dung, Ctrl+O ƒë·ªÉ l∆∞u, Ctrl+X ƒë·ªÉ tho√°t)

# Hi·ªÉn th·ªã n·ªôi dung file
cat amazing-test-file.txt

# Li·ªát k√™ file
ls -l

# Reboot instance ƒë·ªÉ test persistence
sudo reboot
# (ƒê·ª£i v√†i ph√∫t, sau ƒë√≥ connect l·∫°i instance)
```

---

## 8. Ki·ªÉm tra l·∫°i sau reboot

- SSH l·∫°i instance, ch·∫°y:
```bash
lsblk
sudo mount /dev/xvdf /EBS-test
ls /EBS-test
cat /EBS-test/amazing-test-file.txt
```
- File v·∫´n c√≤n, ch·ª©ng minh **EBS l√† persistent storage**

---

## 9. Ki·∫øn th·ª©c b·ªï sung & m·∫πo ƒëi thi

- **Ch·ªâ attach EBS volume v√†o instance c√πng AZ**
- **EBS volume t√°ch r·ªùi v√≤ng ƒë·ªùi EC2:** D·ª´ng/x√≥a instance, volume v·∫´n c√≤n (tr·ª´ khi ch·ªçn delete on termination)
- **EBS volume d√πng ƒë∆∞·ª£c cho nhi·ªÅu EC2 (sequential attach, kh√¥ng parallel)**
- **Instance Store:** Ch·ªâ add khi launch, m·∫•t data khi stop/start/terminate, ch·ªâ d√πng cho temp/cache
- **Boot volume ch·ªâ d√πng EBS, kh√¥ng d√πng instance store**
- **EBS volume c√≥ th·ªÉ t·∫°o t·ª´ snapshot, restore/migrate/clone sang AZ/region kh√°c**

---

## 10. L·ªánh tham kh·∫£o kh√°c

```bash
# Format ext4 thay cho xfs
sudo mkfs.ext4 /dev/xvdf

# Unmount volume
sudo umount /EBS-test

# X√≥a volume kh·ªèi EC2 (detach)
# AWS Console > Volumes > Actions > Detach
```

---

## 11. L∆∞u √Ω chi ph√≠

- **EBS gp3:** ~$0.08/GB/th√°ng (10GB ~ $0.8/th√°ng)
- **Instance store:** Kh√¥ng t√≠nh ri√™ng, ƒë√£ include trong gi√° EC2
- **Part 2 (instance store):** D√πng instance l·ªõn t·ªën ~0.13$/gi·ªù
- **Snapshot:** ~$0.05/GB/th√°ng tr√™n data th·ª±c d√πng

---

**T√≥m t·∫Øt:**
- EBS: Persistent, attach/detach linh ho·∫°t, backup ƒë∆∞·ª£c (snapshot), ch·ªâ attach c√πng AZ.
- Instance store: Hi·ªáu nƒÉng cao, ephemeral, ch·ªâ add l√∫c launch, m·∫•t data khi stop/start, kh√¥ng backup.
- Th·ª±c h√†nh ƒë·ªß quy tr√¨nh: t·∫°o, attach, mount, test persistence, reboot, detach, x√≥a...



??? info "stack cloudformation"

    ```
    Description: Animals4Life base VPC Template + 3 Public Instances
    Parameters:
      LatestAmiId:
        Description: AMI for EC2 (default is latest AmaLinux2023)
        Type: AWS::SSM::Parameter::Value<AWS::EC2::Image::Id>
        Default: /aws/service/ami-amazon-linux-latest/al2023-ami-kernel-default-x86_64
    Resources:
      VPC:
        Type: AWS::EC2::VPC
        Properties:
          CidrBlock: 10.16.0.0/16
          EnableDnsSupport: true
          EnableDnsHostnames: true
          Tags:
            - Key: Name
              Value: a4l-vpc1
      IPv6CidrBlock:
        Type: AWS::EC2::VPCCidrBlock
        Properties:
          VpcId: !Ref VPC
          AmazonProvidedIpv6CidrBlock: true
      InternetGateway:
        Type: AWS::EC2::InternetGateway
        Properties:
          Tags:
            - Key: Name
              Value: A4L-vpc1-igw
      InternetGatewayAttachment:
        Type: AWS::EC2::VPCGatewayAttachment
        Properties:
          VpcId: !Ref VPC
          InternetGatewayId: !Ref InternetGateway
      RouteTableWeb:
        Type: AWS::EC2::RouteTable
        Properties:
          VpcId: !Ref VPC
          Tags:
            - Key: Name
              Value: A4L-vpc1-rt-web
      RouteTableWebDefaultIPv4:
        Type: AWS::EC2::Route
        DependsOn: InternetGatewayAttachment
        Properties:
          RouteTableId: !Ref RouteTableWeb
          DestinationCidrBlock: 0.0.0.0/0
          GatewayId: !Ref InternetGateway
      RouteTableWebDefaultIPv6:
        Type: AWS::EC2::Route
        DependsOn: InternetGatewayAttachment
        Properties:
          RouteTableId: !Ref RouteTableWeb
          DestinationIpv6CidrBlock: '::/0'
          GatewayId: !Ref InternetGateway
      RouteTableAssociationWebA:
        Type: AWS::EC2::SubnetRouteTableAssociation
        Properties:
          SubnetId: !Ref SubnetWEBA
          RouteTableId: !Ref RouteTableWeb
      RouteTableAssociationWebB:
        Type: AWS::EC2::SubnetRouteTableAssociation
        Properties:
          SubnetId: !Ref SubnetWEBB
          RouteTableId: !Ref RouteTableWeb
      RouteTableAssociationWebC:
        Type: AWS::EC2::SubnetRouteTableAssociation
        Properties:
          SubnetId: !Ref SubnetWEBC
          RouteTableId: !Ref RouteTableWeb
      SubnetReservedA:
        Type: AWS::EC2::Subnet
        DependsOn: IPv6CidrBlock
        Properties:
          VpcId: !Ref VPC
          AvailabilityZone: !Select
            - 0
            - !GetAZs ''
          CidrBlock: 10.16.0.0/20
          AssignIpv6AddressOnCreation: true
          Ipv6CidrBlock: !Sub
            - ${VpcPart}${SubnetPart}
            - SubnetPart: 00::/64
              VpcPart: !Select
                - 0
                - !Split
                  - 00::/56
                  - !Select
                    - 0
                    - !GetAtt VPC.Ipv6CidrBlocks
          Tags:
            - Key: Name
              Value: sn-reserved-A
      SubnetReservedB:
        Type: AWS::EC2::Subnet
        DependsOn: IPv6CidrBlock
        Properties:
          VpcId: !Ref VPC
          AvailabilityZone: !Select
            - 1
            - !GetAZs ''
          CidrBlock: 10.16.64.0/20
          AssignIpv6AddressOnCreation: true
          Ipv6CidrBlock: !Sub
            - ${VpcPart}${SubnetPart}
            - SubnetPart: 04::/64
              VpcPart: !Select
                - 0
                - !Split
                  - 00::/56
                  - !Select
                    - 0
                    - !GetAtt VPC.Ipv6CidrBlocks
          Tags:
            - Key: Name
              Value: sn-reserved-B
      SubnetReservedC:
        Type: AWS::EC2::Subnet
        DependsOn: IPv6CidrBlock
        Properties:
          VpcId: !Ref VPC
          AvailabilityZone: !Select
            - 2
            - !GetAZs ''
          CidrBlock: 10.16.128.0/20
          AssignIpv6AddressOnCreation: true
          Ipv6CidrBlock: !Sub
            - ${VpcPart}${SubnetPart}
            - SubnetPart: 08::/64
              VpcPart: !Select
                - 0
                - !Split
                  - 00::/56
                  - !Select
                    - 0
                    - !GetAtt VPC.Ipv6CidrBlocks
          Tags:
            - Key: Name
              Value: sn-reserved-C
      SubnetDBA:
        Type: AWS::EC2::Subnet
        DependsOn: IPv6CidrBlock
        Properties:
          VpcId: !Ref VPC
          AvailabilityZone: !Select
            - 0
            - !GetAZs ''
          CidrBlock: 10.16.16.0/20
          AssignIpv6AddressOnCreation: true
          Ipv6CidrBlock: !Sub
            - ${VpcPart}${SubnetPart}
            - SubnetPart: 01::/64
              VpcPart: !Select
                - 0
                - !Split
                  - 00::/56
                  - !Select
                    - 0
                    - !GetAtt VPC.Ipv6CidrBlocks
          Tags:
            - Key: Name
              Value: sn-db-A
      SubnetDBB:
        Type: AWS::EC2::Subnet
        DependsOn: IPv6CidrBlock
        Properties:
          VpcId: !Ref VPC
          AvailabilityZone: !Select
            - 1
            - !GetAZs ''
          CidrBlock: 10.16.80.0/20
          AssignIpv6AddressOnCreation: true
          Ipv6CidrBlock: !Sub
            - ${VpcPart}${SubnetPart}
            - SubnetPart: 05::/64
              VpcPart: !Select
                - 0
                - !Split
                  - 00::/56
                  - !Select
                    - 0
                    - !GetAtt VPC.Ipv6CidrBlocks
          Tags:
            - Key: Name
              Value: sn-db-B
      SubnetDBC:
        Type: AWS::EC2::Subnet
        DependsOn: IPv6CidrBlock
        Properties:
          VpcId: !Ref VPC
          AvailabilityZone: !Select
            - 2
            - !GetAZs ''
          CidrBlock: 10.16.144.0/20
          AssignIpv6AddressOnCreation: true
          Ipv6CidrBlock: !Sub
            - ${VpcPart}${SubnetPart}
            - SubnetPart: 09::/64
              VpcPart: !Select
                - 0
                - !Split
                  - 00::/56
                  - !Select
                    - 0
                    - !GetAtt VPC.Ipv6CidrBlocks
          Tags:
            - Key: Name
              Value: sn-db-C
      SubnetAPPA:
        Type: AWS::EC2::Subnet
        DependsOn: IPv6CidrBlock
        Properties:
          VpcId: !Ref VPC
          AvailabilityZone: !Select
            - 0
            - !GetAZs ''
          CidrBlock: 10.16.32.0/20
          AssignIpv6AddressOnCreation: true
          Ipv6CidrBlock: !Sub
            - ${VpcPart}${SubnetPart}
            - SubnetPart: 02::/64
              VpcPart: !Select
                - 0
                - !Split
                  - 00::/56
                  - !Select
                    - 0
                    - !GetAtt VPC.Ipv6CidrBlocks
          Tags:
            - Key: Name
              Value: sn-app-A
      SubnetAPPB:
        Type: AWS::EC2::Subnet
        DependsOn: IPv6CidrBlock
        Properties:
          VpcId: !Ref VPC
          AvailabilityZone: !Select
            - 1
            - !GetAZs ''
          CidrBlock: 10.16.96.0/20
          AssignIpv6AddressOnCreation: true
          Ipv6CidrBlock: !Sub
            - ${VpcPart}${SubnetPart}
            - SubnetPart: 06::/64
              VpcPart: !Select
                - 0
                - !Split
                  - 00::/56
                  - !Select
                    - 0
                    - !GetAtt VPC.Ipv6CidrBlocks
          Tags:
            - Key: Name
              Value: sn-app-B
      SubnetAPPC:
        Type: AWS::EC2::Subnet
        DependsOn: IPv6CidrBlock
        Properties:
          VpcId: !Ref VPC
          AvailabilityZone: !Select
            - 2
            - !GetAZs ''
          CidrBlock: 10.16.160.0/20
          AssignIpv6AddressOnCreation: true
          Ipv6CidrBlock: !Sub
            - ${VpcPart}${SubnetPart}
            - SubnetPart: 0A::/64
              VpcPart: !Select
                - 0
                - !Split
                  - 00::/56
                  - !Select
                    - 0
                    - !GetAtt VPC.Ipv6CidrBlocks
          Tags:
            - Key: Name
              Value: sn-app-C
      SubnetWEBA:
        Type: AWS::EC2::Subnet
        DependsOn: IPv6CidrBlock
        Properties:
          VpcId: !Ref VPC
          AvailabilityZone: !Select
            - 0
            - !GetAZs ''
          CidrBlock: 10.16.48.0/20
          MapPublicIpOnLaunch: true
          Ipv6CidrBlock: !Sub
            - ${VpcPart}${SubnetPart}
            - SubnetPart: 03::/64
              VpcPart: !Select
                - 0
                - !Split
                  - 00::/56
                  - !Select
                    - 0
                    - !GetAtt VPC.Ipv6CidrBlocks
          Tags:
            - Key: Name
              Value: sn-web-A
      SubnetWEBB:
        Type: AWS::EC2::Subnet
        DependsOn: IPv6CidrBlock
        Properties:
          VpcId: !Ref VPC
          AvailabilityZone: !Select
            - 1
            - !GetAZs ''
          CidrBlock: 10.16.112.0/20
          MapPublicIpOnLaunch: true
          Ipv6CidrBlock: !Sub
            - ${VpcPart}${SubnetPart}
            - SubnetPart: 07::/64
              VpcPart: !Select
                - 0
                - !Split
                  - 00::/56
                  - !Select
                    - 0
                    - !GetAtt VPC.Ipv6CidrBlocks
          Tags:
            - Key: Name
              Value: sn-web-B
      SubnetWEBC:
        Type: AWS::EC2::Subnet
        DependsOn: IPv6CidrBlock
        Properties:
          VpcId: !Ref VPC
          AvailabilityZone: !Select
            - 2
            - !GetAZs ''
          CidrBlock: 10.16.176.0/20
          MapPublicIpOnLaunch: true
          Ipv6CidrBlock: !Sub
            - ${VpcPart}${SubnetPart}
            - SubnetPart: 0B::/64
              VpcPart: !Select
                - 0
                - !Split
                  - 00::/56
                  - !Select
                    - 0
                    - !GetAtt VPC.Ipv6CidrBlocks
          Tags:
            - Key: Name
              Value: sn-web-C
      IPv6WorkaroundSubnetWEBA:
        Type: Custom::SubnetModify
        Properties:
          ServiceToken: !GetAtt IPv6WorkaroundLambda.Arn
          SubnetId: !Ref SubnetWEBA
      IPv6WorkaroundSubnetWEBB:
        Type: Custom::SubnetModify
        Properties:
          ServiceToken: !GetAtt IPv6WorkaroundLambda.Arn
          SubnetId: !Ref SubnetWEBB
      IPv6WorkaroundSubnetWEBC:
        Type: Custom::SubnetModify
        Properties:
          ServiceToken: !GetAtt IPv6WorkaroundLambda.Arn
          SubnetId: !Ref SubnetWEBC
      IPv6WorkaroundRole:
        Type: AWS::IAM::Role
        Properties:
          AssumeRolePolicyDocument:
            Version: '2012-10-17'
            Statement:
              - Effect: Allow
                Principal:
                  Service:
                    - lambda.amazonaws.com
                Action:
                  - sts:AssumeRole
          Path: /
          Policies:
            - PolicyName: !Sub ipv6-fix-logs-${AWS::StackName}
              PolicyDocument:
                Version: '2012-10-17'
                Statement:
                  - Effect: Allow
                    Action:
                      - logs:CreateLogGroup
                      - logs:CreateLogStream
                      - logs:PutLogEvents
                    Resource: arn:aws:logs:*:*:*
            - PolicyName: !Sub ipv6-fix-modify-${AWS::StackName}
              PolicyDocument:
                Version: '2012-10-17'
                Statement:
                  - Effect: Allow
                    Action:
                      - ec2:ModifySubnetAttribute
                    Resource: '*'
      IPv6WorkaroundLambda:
        Type: AWS::Lambda::Function
        Properties:
          Handler: index.lambda_handler
          Code:
            #import cfnresponse below required to send respose back to CFN
            ZipFile: !Sub |
              import cfnresponse
              import boto3
    
              def lambda_handler(event, context):
                if event['RequestType'] is 'Delete':
                  cfnresponse.send(event, context, cfnresponse.SUCCESS)
                  return
    
                responseValue = event['ResourceProperties']['SubnetId']
                ec2 = boto3.client('ec2', region_name='${AWS::Region}')
                ec2.modify_subnet_attribute(AssignIpv6AddressOnCreation={
                                'Value': True
                                },
                                SubnetId=responseValue)
                responseData = {}
                responseData['SubnetId'] = responseValue
                cfnresponse.send(event, context, cfnresponse.SUCCESS, responseData, "CustomResourcePhysicalID")
          Runtime: python3.9
          Role: !GetAtt IPv6WorkaroundRole.Arn
          Timeout: 30
      Instance1:
        Type: AWS::EC2::Instance
        Properties:
          InstanceType: t2.micro
          ImageId: !Ref LatestAmiId
          IamInstanceProfile: !Ref SessionManagerInstanceProfile
          SubnetId: !Ref SubnetWEBA
          SecurityGroupIds:
            - !Ref InstanceSecurityGroup
          Tags:
            - Key: Name
              Value: A4L-EBS-INSTANCE1-AZA
      Instance2:
        Type: AWS::EC2::Instance
        Properties:
          InstanceType: t2.micro
          ImageId: !Ref LatestAmiId
          IamInstanceProfile: !Ref SessionManagerInstanceProfile
          SubnetId: !Ref SubnetWEBA
          SecurityGroupIds:
            - !Ref InstanceSecurityGroup
          Tags:
            - Key: Name
              Value: A4L-EBS-INSTANCE2-AZA
      Instance3:
        Type: AWS::EC2::Instance
        Properties:
          InstanceType: t2.micro
          ImageId: !Ref LatestAmiId
          IamInstanceProfile: !Ref SessionManagerInstanceProfile
          SubnetId: !Ref SubnetWEBB
          SecurityGroupIds:
            - !Ref InstanceSecurityGroup
          Tags:
            - Key: Name
              Value: A4L-EBS-INSTANCE1-AZB
      InstanceSecurityGroup:
        Type: AWS::EC2::SecurityGroup
        Properties:
          VpcId: !Ref VPC
          GroupDescription: Enable SSH access via port 22 IPv4 & v6
          SecurityGroupIngress:
            - Description: Allow SSH IPv4 IN
              IpProtocol: tcp
              FromPort: '22'
              ToPort: '22'
              CidrIp: 0.0.0.0/0
            - Description: Allow HTTP IPv4 IN
              IpProtocol: tcp
              FromPort: '80'
              ToPort: '80'
              CidrIp: 0.0.0.0/0
            - Description: Allow SSH IPv6 IN
              IpProtocol: tcp
              FromPort: '22'
              ToPort: '22'
              CidrIpv6: '::/0'
      SessionManagerRole:
        Type: AWS::IAM::Role
        Properties:
          AssumeRolePolicyDocument:
            Version: 2012-10-17
            Statement:
              - Effect: Allow
                Principal:
                  Service:
                    - ec2.amazonaws.com
                Action:
                  - sts:AssumeRole
          Path: /
          Policies:
            - PolicyName: root
              PolicyDocument:
                Version: 2012-10-17
                Statement:
                  - Effect: Allow
                    Action:
                      - ssm:DescribeAssociation
                      - ssm:GetDeployablePatchSnapshotForInstance
                      - ssm:GetDocument
                      - ssm:DescribeDocument
                      - ssm:GetManifest
                      - ssm:GetParameter
                      - ssm:GetParameters
                      - ssm:ListAssociations
                      - ssm:ListInstanceAssociations
                      - ssm:PutInventory
                      - ssm:PutComplianceItems
                      - ssm:PutConfigurePackageResult
                      - ssm:UpdateAssociationStatus
                      - ssm:UpdateInstanceAssociationStatus
                      - ssm:UpdateInstanceInformation
                    Resource: '*'
                  - Effect: Allow
                    Action:
                      - ssmmessages:CreateControlChannel
                      - ssmmessages:CreateDataChannel
                      - ssmmessages:OpenControlChannel
                      - ssmmessages:OpenDataChannel
                    Resource: '*'
                  - Effect: Allow
                    Action:
                      - ec2messages:AcknowledgeMessage
                      - ec2messages:DeleteMessage
                      - ec2messages:FailMessage
                      - ec2messages:GetEndpoint
                      - ec2messages:GetMessages
                      - ec2messages:SendReply
                    Resource: '*'
      SessionManagerInstanceProfile:
        Type: AWS::IAM::InstanceProfile
        Properties:
          Path: /
          Roles:
            - !Ref SessionManagerRole
    Outputs:
      a4lvpc1:
        Description: Animals4Life VPC1_ID
        Value: !Ref VPC
        Export:
          Name: a4l-vpc1
      a4lvpc1subnetweba:
        Description: Animals4Life VPC1 SubnetWEBA
        Value: !Ref SubnetWEBA
        Export:
          Name: a4l-vpc1-subnet-weba
      a4lvpc1subnetwebb:
        Description: Animals4Life VPC1 SubnetWEBB
        Value: !Ref SubnetWEBB
        Export:
          Name: a4l-vpc1-subnet-webb
      a4lvpc1subnetwebc:
        Description: Animals4Life VPC1 SubnetWEBC
        Value: !Ref SubnetWEBC
        Export:
          Name: a4l-vpc1-subnet-webc
      a4lvpc1subnetappa:
        Description: Animals4Life VPC1 SubnetAPPA
        Value: !Ref SubnetAPPA
        Export:
          Name: a4l-vpc1-subnet-appa
      a4lvpc1subnetappb:
        Description: Animals4Life VPC1 SubnetAPPB
        Value: !Ref SubnetAPPB
        Export:
          Name: a4l-vpc1-subnet-appb
      a4lvpc1subnetappc:
        Description: Animals4Life VPC1 SubnetAPPC
        Value: !Ref SubnetAPPC
        Export:
          Name: a4l-vpc1-subnet-appc
      a4lvpc1subnetdba:
        Description: Animals4Life VPC1 SubnetDBA
        Value: !Ref SubnetDBA
        Export:
          Name: a4l-vpc1-subnet-dba
      a4lvpc1subnetdbb:
        Description: Animals4Life VPC1 SubnetDBB
        Value: !Ref SubnetDBB
        Export:
          Name: a4l-vpc1-subnet-dbb
      a4lvpc1subnetdbc:
        Description: Animals4Life VPC1 SubnetDBC
        Value: !Ref SubnetDBC
        Export:
          Name: a4l-vpc1-subnet-dbc
      a4lvpc1subnetreserveda:
        Description: Animals4Life VPC1 SubnetReservedA
        Value: !Ref SubnetReservedA
        Export:
          Name: a4l-vpc1-subnet-reserveda
      a4lvpc1subnetreservedb:
        Description: Animals4Life VPC1 SubnetReservedB
        Value: !Ref SubnetReservedB
        Export:
          Name: a4l-vpc1-subnet-reservedb
      a4lvpc1subnetreservedc:
        Description: Animals4Life VPC1 SubnetReservedC
        Value: !Ref SubnetReservedC
        Export:
          Name: a4l-vpc1-subnet-reservedc
    ```          

