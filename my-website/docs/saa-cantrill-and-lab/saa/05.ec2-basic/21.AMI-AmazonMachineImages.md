

## ğŸ–¼ï¸ Amazon Machine Image (AMI) â€“ Kiáº¿n thá»©c & kiáº¿n trÃºc Ä‘áº§y Ä‘á»§ EC2 (chuáº©n Ä‘i thi vÃ  Ä‘i lÃ m)

---

## 1. AMI lÃ  gÃ¬? KhÃ¡i niá»‡m cÆ¡ báº£n & á»©ng dá»¥ng

<img width="837" height="396" alt="image" src="https://github.com/user-attachments/assets/bcdf9174-c6fd-49c6-8ba8-755f6b05cd67" />

- **AMI (Amazon Machine Image):**  
  - LÃ  â€œmáº«uâ€ cáº¥u hÃ¬nh EC2 instance, chá»©a OS + á»©ng dá»¥ng + cáº¥u hÃ¬nh + (tÃ¹y chá»n) dá»¯ liá»‡u.
  - DÃ¹ng Ä‘á»ƒ **táº¡o má»›i nhanh nhiá»u EC2 instance** tá»« cÃ¹ng má»™t chuáº©n cáº¥u hÃ¬nh.
  - Khi báº¡n launch EC2, thá»±c cháº¥t lÃ  launch tá»« má»™t AMI.

- **CÃ³ 3 nguá»“n AMI:**
    - **AWS managed:** VÃ­ dá»¥ Amazon Linux 2, Ubuntu, Red Hatâ€¦
    - **Community AMI:** Do cá»™ng Ä‘á»“ng/vendor cung cáº¥p (CentOS, cÃ¡c báº£n customâ€¦).
    - **Marketplace AMI:** AMI cÃ³ kÃ¨m license pháº§n má»m thÆ°Æ¡ng máº¡i, tráº£ phÃ­ thÃªm (cÃ³ thá»ƒ theo giá»).

---

## 2. Äáº·c Ä‘iá»ƒm & vÃ¹ng (region) cá»§a AMI

- **AMI lÃ  tÃ i nguyÃªn theo **region**:**
    - Má»—i region cÃ³ ID AMI riÃªng cho cÃ¹ng má»™t OS/distribution.
    - **AMI chá»‰ dÃ¹ng Ä‘Æ°á»£c trong region mÃ  nÃ³ Ä‘Æ°á»£c táº¡o** (nhÆ°ng cÃ³ thá»ƒ copy sang vÃ¹ng khÃ¡c).

- **Má»—i AMI cÃ³ ID dáº¡ng:**  
    - `ami-xxxxxxxxxxxxxxxxx` (khÃ´ng giá»‘ng nhau giá»¯a cÃ¡c vÃ¹ng).

---

## 3. Quyá»n truy cáº­p AMI

- **Default:** Private, chá»‰ account táº¡o Ä‘Æ°á»£c dÃ¹ng.
- **CÃ³ thá»ƒ chá»‰nh:**
    - **Public:** Ai cÅ©ng dÃ¹ng Ä‘Æ°á»£c.
    - **Explicit:** Chá»‰ Ä‘á»‹nh tá»«ng AWS Account Ä‘Æ°á»£c quyá»n dÃ¹ng.

---

## 4. VÃ²ng Ä‘á»i AMI: 4 bÆ°á»›c chuáº©n

<img width="817" height="427" alt="image" src="https://github.com/user-attachments/assets/52fddd23-fe97-41fe-9592-5de0a6422cdf" />

1. **Launch:** DÃ¹ng AMI táº¡o EC2 instance.
2. **Configure:** CÃ i Ä‘áº·t, cáº¥u hÃ¬nh, tinh chá»‰nh instance theo Ã½ (cÃ i app, Ä‘á»•i config, thÃªm volumeâ€¦).
3. **Create image:** Táº¡o AMI má»›i tá»« instance Ä‘Ã£ tinh chá»‰nh (bake láº¡i tráº¡ng thÃ¡i).
4. **Launch again:** DÃ¹ng AMI Ä‘Ã£ â€œbakeâ€ Ä‘á»ƒ táº¡o nhiá»u EC2 instance chuáº©n cáº¥u hÃ¬nh mong muá»‘n.

- **KhÃ¡i niá»‡m â€œAMI bakingâ€:**  
    - CÃ i Ä‘áº·t, cáº¥u hÃ¬nh, kiá»ƒm tra trÃªn má»™t instance â†’ táº¡o AMI tá»« Ä‘Ã³ â†’ dÃ¹ng AMI má»›i â€œbakeâ€ ra hÃ ng loáº¡t instance giá»‘ng nhau.
    - Hiá»‡u quáº£ cho deploy production, tiáº¿t kiá»‡m thá»i gian, giáº£m lá»—i.

---

## 5. Kiáº¿n trÃºc AMI â€“ Snapshot & Block Device Mapping

- **Khi táº¡o AMI tá»« má»™t EC2 instance:**
    - **Táº¥t cáº£ EBS volume Ä‘ang gáº¯n sáº½ Ä‘Æ°á»£c snapshot láº¡i.**
    - **AMI khÃ´ng chá»©a trá»±c tiáº¿p dá»¯ liá»‡u, mÃ  chá»‰ chá»©a thÃ´ng tin:**
        - Danh sÃ¡ch cÃ¡c snapshot ID.
        - Block device mapping: LiÃªn káº¿t snapshot vá»›i device id gá»‘c (vÃ­ dá»¥: /dev/xvda, /dev/xvdfâ€¦).
        - Metadata quyá»n truy cáº­p.
    - **Khi launch instance tá»« AMI:**
        - AWS dÃ¹ng snapshot Ä‘á»ƒ táº¡o EBS volume má»›i theo device id gá»‘c.
        - Attach cÃ¡c volume nÃ y vÃ o instance má»›i.

- **Snapshot lÃ  incremental:**  
    - Láº§n Ä‘áº§u lÃ  full, cÃ¡c láº§n sau chá»‰ lÆ°u thay Ä‘á»•i.
      
??? info "thÃªm rÃµ"

    ### 1. **Block device mapping: LiÃªn káº¿t snapshot vá»›i device id gá»‘c (vÃ­ dá»¥: /dev/xvda, /dev/xvdfâ€¦)**
    
    * **Block device mapping** nghÄ©a lÃ  â€œbáº£n Ä‘á»“ thiáº¿t bá»‹ lÆ°u trá»¯â€ â€” nÃ³ xÃ¡c Ä‘á»‹nh á»• Ä‘Ä©a áº£o nÃ o sáº½ gáº¯n vÃ o mÃ¡y áº£o vÃ  á»• Ä‘Ã³ láº¥y dá»¯ liá»‡u tá»« Ä‘Ã¢u.
    * Má»—i mÃ¡y áº£o cÃ³ thá»ƒ cÃ³ nhiá»u á»• Ä‘Ä©a (á»• cá»©ng áº£o) nhÆ°:
    
      * `/dev/xvda` (thÆ°á»ng lÃ  á»• Ä‘Ä©a chÃ­nh chá»©a há»‡ Ä‘iá»u hÃ nh)
      * `/dev/xvdf` (á»• Ä‘Ä©a phá»¥ Ä‘á»ƒ chá»©a dá»¯ liá»‡u khÃ¡c)
    * Má»—i á»• Ä‘Ä©a áº£o nÃ y Ä‘Æ°á»£c táº¡o ra dá»±a trÃªn má»™t **snapshot** cá»¥ thá»ƒ â€” tá»©c lÃ  má»™t báº£n sao lÆ°u cá»§a á»• Ä‘Ä©a Ä‘Ã³.
    * Block device mapping lÃ  **liÃªn káº¿t giá»¯a snapshot** (báº£n sao lÆ°u) vÃ  **á»• Ä‘Ä©a áº£o trÃªn mÃ¡y** â€” nÃ³i cÃ¡ch khÃ¡c, nÃ³ báº£o â€œá»• Ä‘Ä©a `/dev/xvda` sáº½ Ä‘Æ°á»£c dá»±ng lÃªn tá»« snapshot sá»‘ 12345â€, â€œá»• Ä‘Ä©a `/dev/xvdf` sáº½ Ä‘Æ°á»£c dá»±ng lÃªn tá»« snapshot sá»‘ 67890â€.
    
    ---
    
    ### 2. **Metadata quyá»n truy cáº­p**
    
    * **Metadata** lÃ  â€œthÃ´ng tin vá» thÃ´ng tinâ€ â€” á»Ÿ Ä‘Ã¢y lÃ  dá»¯ liá»‡u vá» quyá»n sá»­ dá»¥ng AMI.
    * NÃ³ quy Ä‘á»‹nh ai Ä‘Æ°á»£c phÃ©p xem, dÃ¹ng hoáº·c chia sáº» AMI Ä‘Ã³.
    * VÃ­ dá»¥:
    
      * AMI chá»‰ dÃ nh cho báº¡n hoáº·c nhÃ³m ngÆ°á»i trong tÃ i khoáº£n cá»§a báº¡n.
      * Hoáº·c báº¡n cho phÃ©p má»i ngÆ°á»i cÃ´ng khai sá»­ dá»¥ng AMI Ä‘Ã³.
    * Metadata quyá»n truy cáº­p giÃºp Ä‘áº£m báº£o an toÃ n, khÃ´ng ai ngoÃ i ngÆ°á»i Ä‘Æ°á»£c phÃ©p cÃ³ thá»ƒ táº¡o mÃ¡y áº£o tá»« AMI Ä‘Ã³.
    
    * cÃ²n khi táº¡o Snapshot thÃ´ng thÆ°á»ng **chÆ°a cÃ³ cÃ¡i gÃ¬ map vÃ o nÃ³** cáº£, vÃ¬ nÃ³ chá»‰ lÆ°u dá»¯ liá»‡u cá»§a á»• Ä‘Ä©a táº¡i thá»i Ä‘iá»ƒm Ä‘Ã³.

    
    ### **1. Khi báº¡n táº¡o AMI tá»« má»™t EC2 instance:**
    
    - AWS sáº½ **snapshot láº¡i tá»«ng EBS volume** gáº¯n vÃ o instance Ä‘Ã³ (vÃ­ dá»¥: á»• boot `/dev/xvda`, á»• data `/dev/xvdf`, ...).
    - **AMI khÃ´ng lÆ°u dá»¯ liá»‡u trá»±c tiáº¿p.**  
      AMI **chá»‰ lÆ°u thÃ´ng tin Ã¡nh xáº¡** (Block Device Mapping):
        - Device name (vÃ­ dá»¥: `/dev/xvda`)
        - TÆ°Æ¡ng á»©ng vá»›i Snapshot ID (vÃ­ dá»¥: `snap-abc123â€¦`)
        - ThÃªm metadata: region, permission, visibility,â€¦
    
    ---
    
    ### **2. Khi báº¡n dÃ¹ng AMI Ä‘á»ƒ táº¡o EC2 instance má»›i:**
    
    - AWS sáº½ **dÃ¹ng mapping trong AMI** Ä‘á»ƒ biáº¿t cáº§n táº¡o nhá»¯ng EBS volume nÃ o.
    - Vá»›i má»—i dÃ²ng mapping:
        - **Snapshot gá»‘c** â†’ **Táº¡o EBS volume má»›i** trong AZ báº¡n chá»n
        - Gáº¯n volume Ä‘Ã³ vÃ o instance má»›i á»Ÿ Ä‘Ãºng device name (vÃ­ dá»¥: `/dev/xvda` lÃ  á»• boot OS, `/dev/xvdf` lÃ  á»• data).
    - Káº¿t quáº£:  
      - Instance má»›i cÃ³ há»‡ Ä‘iá»u hÃ nh, á»©ng dá»¥ng, dá»¯ liá»‡u nhÆ° instance gá»‘c, Ä‘Ãºng vá»‹ trÃ­ volume.
    
    ---
    
    ### **SÆ¡ Ä‘á»“ hÃ³a láº¡i quÃ¡ trÃ¬nh:**
    
    1. **EC2 Instance gá»‘c**
        - `/dev/xvda` (OS, app) â†’ **Snapshot A**
        - `/dev/xvdf` (Data) â†’ **Snapshot B**
    
    2. **Táº¡o AMI**
        - AMI chá»©a:  
            - Block Device Mapping:  
                - `/dev/xvda` â†’ Snapshot A  
                - `/dev/xvdf` â†’ Snapshot B  
            - Metadata (region, permissionâ€¦)
    
    3. **DÃ¹ng AMI launch instance má»›i**
        - Snapshot A â†’ Táº¡o volume má»›i â†’ Gáº¯n vÃ o `/dev/xvda` cá»§a instance má»›i
        - Snapshot B â†’ Táº¡o volume má»›i â†’ Gáº¯n vÃ o `/dev/xvdf` cá»§a instance má»›i
    
    ---
    
    ### **Káº¿t luáº­n**
    - AMI **khÃ´ng lÆ°u dá»¯ liá»‡u**, chá»‰ lÆ°u mapping.
    - Khi launch, mapping sáº½ Ä‘Æ°á»£c dÃ¹ng Ä‘á»ƒ láº¥y snapshot vÃ  táº¡o volume má»›i, gáº¯n Ä‘Ãºng vá»‹ trÃ­ cho OS.
    - Instance má»›i **giá»‘ng há»‡t cáº¥u hÃ¬nh volume** cá»§a instance gá»‘c táº¡i thá»i Ä‘iá»ƒm snapshot.









---

## 6. TÃ­nh nÄƒng nÃ¢ng cao & lÆ°u Ã½

<img width="818" height="443" alt="image" src="https://github.com/user-attachments/assets/c1063b29-09b0-4cbb-bc7c-d877508fd1d5" />

- **KhÃ´ng thá»ƒ chá»‰nh sá»­a trá»±c tiáº¿p AMI Ä‘Ã£ táº¡o.**  
    - Muá»‘n thay Ä‘á»•i: launch tá»« AMI â†’ cáº¥u hÃ¬nh láº¡i â†’ táº¡o AMI má»›i.
- **AMI cÃ³ thá»ƒ copy sang region khÃ¡c.**  
    - Khi copy, cÃ¡c snapshot liÃªn quan cÅ©ng Ä‘Æ°á»£c copy.
- **CÃ³ thá»ƒ chia sáº» AMI cho account khÃ¡c hoáº·c public.**
- **Chi phÃ­:**  
    - **AMI khÃ´ng tÃ­nh phÃ­ riÃªng**, nhÆ°ng **snapshot bÃªn dÆ°á»›i sáº½ bá»‹ tÃ­nh phÃ­ lÆ°u trá»¯**.
    - Dung lÆ°á»£ng snapshot chá»‰ tÃ­nh dá»±a trÃªn data thá»±c sá»± dÃ¹ng trÃªn EBS volume (khÃ´ng pháº£i toÃ n bá»™ dung lÆ°á»£ng cáº¥p phÃ¡t).

---

## 7. Má»™t sá»‘ thuáº­t ngá»¯ vÃ  máº¹o thi

- **Block device mapping:** Báº£n Ä‘á»“ Ã¡nh xáº¡ giá»¯a device id vÃ  snapshot id. Khi launch instance, AWS dÃ¹ng Ã¡nh xáº¡ nÃ y Ä‘á»ƒ attach Ä‘Ãºng volume ra Ä‘Ãºng device.
- **AMI baking:** TiÃªu chuáº©n triá»ƒn khai production (lÃ m 1 â†’ nhÃ¢n báº£n n).
- **Chá»‰nh sá»­a AMI:** KhÃ´ng chá»‰nh sá»­a, chá»‰ táº¡o má»›i tá»« instance Ä‘Ã£ tinh chá»‰nh.
- **AMI lÃ  tÃ i nguyÃªn theo region, muá»‘n dÃ¹ng á»Ÿ vÃ¹ng khÃ¡c pháº£i copy.**
- **Chi phÃ­ snapshot phá»¥ thuá»™c vÃ o data dÃ¹ng, khÃ´ng pháº£i tá»•ng size EBS.**
- **AMI cÃ³ thá»ƒ dÃ¹ng cho má»i AZ trong cÃ¹ng region.**

---


## 9. Tá»•ng káº¿t dá»… nhá»›

- **AMI = â€œmáº«uâ€ cáº¥u hÃ¬nh EC2, gá»“m snapshot cÃ¡c volume + Ã¡nh xáº¡ device.**
- **AMI chá»‰ dÃ¹ng trong 1 region, muá»‘n dÃ¹ng vÃ¹ng khÃ¡c pháº£i copy.**
- **KhÃ´ng chá»‰nh sá»­a trá»±c tiáº¿p AMI, chá»‰ táº¡o má»›i tá»« instance.**
- **AMI baking = Ä‘Ã³ng gÃ³i cáº¥u hÃ¬nh, triá»ƒn khai hÃ ng loáº¡t instance giá»‘ng nhau.**
- **Chi phÃ­: snapshot EBS (dá»¯ liá»‡u thá»±c dÃ¹ng).**
- **CÃ³ thá»ƒ chia sáº» AMI cho account khÃ¡c hoáº·c public.**

---

??? info "Ghi chÃº thÃªm"

    - **Báº¡n cÃ³ thá»ƒ dÃ¹ng AMI marketplace Ä‘á»ƒ deploy instance kÃ¨m license pháº§n má»m thÆ°Æ¡ng máº¡i.**
    - **Khi launch instance tá»« AMI, snapshot sáº½ táº¡o ra EBS volume má»›i á»Ÿ AZ báº¡n chá»n.**
    - **Náº¿u AMI cÃ³ nhiá»u volume, táº¥t cáº£ volume sáº½ snapshot riÃªng biá»‡t vÃ  Ã¡nh xáº¡ Ä‘Ãºng device.**
    - **AMI baking ráº¥t hiá»‡u quáº£ Ä‘á»ƒ chuáº©n hÃ³a mÃ´i trÆ°á»ng production/dev/test.**
    - **AMI Ä‘Ã­nh kÃ¨m permission/metadata, khÃ´ng chá»©a data trá»±c tiáº¿p mÃ  chá»‰ tham chiáº¿u Ä‘áº¿n cÃ¡c snapshot.**

---
