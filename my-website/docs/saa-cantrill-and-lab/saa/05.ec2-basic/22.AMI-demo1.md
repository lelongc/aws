??? info "1-Click Deployment"

[https://console.aws.amazon.com/cloudformation/home?region=us-east-1#/stacks/create/review?templateURL=https://learn-cantrill-labs.s3.amazonaws.com/awscoursedemos/0007-aws-associate-ec2-ami-demo/A4L_VPC_PUBLICINSTANCE_AL2023.yaml&stackName=AMIDEMO
](https://console.aws.amazon.com/cloudformation/home?region=us-east-1#/stacks/create/review?templateURL=https://learn-cantrill-labs.s3.amazonaws.com/awscoursedemos/0007-aws-associate-ec2-ami-demo/A4L_VPC_PUBLICINSTANCE_AL2023.yaml&stackName=AMIDEMO
)

??? info "Lesson Commands"

    ```
    # DBName=database name for wordpress
    # DBUser=mariadb user for wordpress
    # DBPassword=password for the mariadb user for wordpress
    # DBRootPassword = root password for mariadb
    
    # STEP 1 - Configure Authentication Variables which are used below
    DBName='a4lwordpress'
    DBUser='a4lwordpress'
    DBPassword='4n1m4l$L1f3'
    DBRootPassword='4n1m4l$L1f3'
    
    # STEP 2 - Install system software - including Web and DB
    sudo dnf install wget php-mysqlnd httpd php-fpm php-mysqli mariadb105-server php-json php php-devel -y
    
    
    # STEP 3 - Web and DB Servers Online - and set to startup
    
    sudo systemctl enable httpd
    sudo systemctl enable mariadb
    sudo systemctl start httpd
    sudo systemctl start mariadb
    
    
    # STEP 4 - Set Mariadb Root Password
    sudo mysqladmin -u root password $DBRootPassword
    
    
    # STEP 5 - Install Wordpress
    sudo wget http://wordpress.org/latest.tar.gz -P /var/www/html
    cd /var/www/html
    sudo tar -zxvf latest.tar.gz
    sudo cp -rvf wordpress/* .
    sudo rm -R wordpress
    sudo rm latest.tar.gz
    
    
    # STEP 6 - Configure Wordpress
    
    sudo cp ./wp-config-sample.php ./wp-config.php
    sudo sed -i "s/'database_name_here'/'$DBName'/g" wp-config.php
    sudo sed -i "s/'username_here'/'$DBUser'/g" wp-config.php
    sudo sed -i "s/'password_here'/'$DBPassword'/g" wp-config.php   
    sudo chown apache:apache * -R
    
    
    # STEP 7 Create Wordpress DB
    
    echo "CREATE DATABASE $DBName;" >> /tmp/db.setup
    echo "CREATE USER '$DBUser'@'localhost' IDENTIFIED BY '$DBPassword';" >> /tmp/db.setup
    echo "GRANT ALL ON $DBName.* TO '$DBUser'@'localhost';" >> /tmp/db.setup
    echo "FLUSH PRIVILEGES;" >> /tmp/db.setup
    mysql -u root --password=$DBRootPassword < /tmp/db.setup
    sudo rm /tmp/db.setup
    
    
    # STEP 8 - Browse to http://your_instance_public_ipv4_ip
    
    
    
    
    # Step 9
    
    sudo dnf install -y cowsay
    
    
    cowsay "oh hi"
    
    
    Create file /etc/update-motd.d/40-cow
    
    sudo nano /etc/update-motd.d/40-cow
    
    #!/bin/sh
    cowsay "Amazon Linux 2023 AMI - Animals4Life"
    
    sudo chmod 755 /etc/update-motd.d/40-cow
    
    sudo update-motd
    sudo reboot
    
    Relogin
    
    
    
    
    ## STEP 10 - CREATE AMI
    ## STEP 11 - USE AMI to launch an instance
    ```

[https://learn-cantrill-labs.s3.amazonaws.com/awscoursedemos/0007-aws-associate-ec2-ami-demo/lesson_commands_AL2023.txt](https://learn-cantrill-labs.s3.amazonaws.com/awscoursedemos/0007-aws-associate-ec2-ami-demo/lesson_commands_AL2023.txt)


## ğŸŒŸ Demo: Táº¡o custom AMI tá»« EC2 instance cÃ i sáºµn WordPress (Animals For Life) â€“ Pháº§n 1

---

## 1. Má»¥c tiÃªu

- **Táº¡o má»™t Amazon Machine Image (AMI) tá»« EC2 Ä‘Ã£ cÃ i Ä‘áº·t vÃ  cáº¥u hÃ¬nh sáºµn WordPress**
- AMI nÃ y sáº½ lÃ  â€œmáº«uâ€ Ä‘á»ƒ deploy nhanh hÃ ng loáº¡t mÃ¡y chá»§ WordPress cho business Animals For Life, vá»›i banner Ä‘á»™ng váº­t Ä‘á»™c Ä‘Ã¡o khi Ä‘Äƒng nháº­p.

---

## 2. Chuáº©n bá»‹ háº¡ táº§ng

1. **ÄÄƒng nháº­p AWS (management account)**
2. **Chá»n region:** us-east-1 (Northern Virginia)
3. **Deploy CloudFormation stack:**  
   - DÃ¹ng link "one-click deployment" vá»›i stack name: `AMI Demo`
   - Tick vÃ o capabilities, nháº¥n **Create stack**
   - Äá»£i tráº¡ng thÃ¡i chuyá»ƒn thÃ nh `CREATE_COMPLETE`
4. **Má»Ÿ tÃ i liá»‡u lá»‡nh:** â€œLesson Commands Documentâ€ (chá»©a toÃ n bá»™ cÃ¡c command cáº§n cháº¡y trÃªn EC2)

---

## 3. Chuáº©n bá»‹ EC2 Instance

1. **VÃ o AWS Console â†’ EC2 â†’ Instances (running)**
2. **Chá»n instance:** `A4L public EC2`
3. **Káº¿t ná»‘i:**  
   - Chuá»™t pháº£i â†’ Connect â†’ EC2 Instance Connect
   - Username: `ec2-user` â†’ Connect

---

## 4. CÃ i Ä‘áº·t & cáº¥u hÃ¬nh WordPress (lÃ m nhanh vÃ¬ Ä‘Ã£ thá»±c hiá»‡n á»Ÿ demo trÆ°á»›c)

### a. Äáº·t biáº¿n mÃ´i trÆ°á»ng

```bash
export DB_NAME='a4l_wordpress_db'
export DB_USER='a4l_wordpress_user'
export DB_PASSWORD='Password123!!'
export DB_ROOT_PASSWORD='Password321!!'
```

### b. CÃ i Ä‘áº·t pháº§n má»m cáº§n thiáº¿t

```bash
sudo dnf install mariadb105-server httpd wget -y
```

### c. Enable vÃ  start dá»‹ch vá»¥

```bash
sudo systemctl enable httpd
sudo systemctl enable mariadb
sudo systemctl start httpd
sudo systemctl start mariadb
```

### d. Äáº·t máº­t kháº©u root cho MariaDB

```bash
sudo mysqladmin -u root password "$DB_ROOT_PASSWORD"
```

### e. Táº£i vÃ  giáº£i nÃ©n WordPress vÃ o web root

```bash
sudo wget https://wordpress.org/latest.tar.gz -P /var/www/html
cd /var/www/html
sudo tar -zxvf latest.tar.gz
sudo cp -r wordpress/* .
sudo rm -rf wordpress
sudo rm -f latest.tar.gz
```

### f. Táº¡o file wp-config.php vÃ  thay tháº¿ thÃ´ng tin DB

```bash
sudo cp wp-config-sample.php wp-config.php
sudo sed -i "s/database_name_here/$DB_NAME/" wp-config.php
sudo sed -i "s/username_here/$DB_USER/" wp-config.php
sudo sed -i "s/password_here/$DB_PASSWORD/" wp-config.php
```

### g. PhÃ¢n quyá»n cho Apache

```bash
sudo chown -R apache:apache /var/www/html
```

### h. Táº¡o script cáº¥u hÃ¬nh database cho WordPress

```bash
echo "CREATE DATABASE $DB_NAME;" > /tmp/dbsetup.sql
echo "CREATE USER '$DB_USER'@'localhost' IDENTIFIED BY '$DB_PASSWORD';" >> /tmp/dbsetup.sql
echo "GRANT ALL PRIVILEGES ON $DB_NAME.* TO '$DB_USER'@'localhost';" >> /tmp/dbsetup.sql
echo "FLUSH PRIVILEGES;" >> /tmp/dbsetup.sql
sudo mysql -u root -p"$DB_ROOT_PASSWORD" < /tmp/dbsetup.sql
rm -f /tmp/dbsetup.sql
```

---

## 5. Kiá»ƒm tra tráº¡ng thÃ¡i WordPress

- **Láº¥y IP public cá»§a EC2**
- Truy cáº­p `http://<EC2_Public_IP>` trÃªn trÃ¬nh duyá»‡t
- Náº¿u Ä‘Ãºng, tháº¥y giao diá»‡n cÃ i Ä‘áº·t WordPress (chÆ°a hoÃ n táº¥t setup â€“ chÃ­nh xÃ¡c nhÆ° mong muá»‘n Ä‘á»ƒ táº¡o AMI!)

---

## 6. Tuá»³ biáº¿n EC2: Banner Ä‘á»™ng váº­t khi Ä‘Äƒng nháº­p

### a. CÃ i Ä‘áº·t cowsay (utility táº¡o ASCII Ä‘á»™ng váº­t)

```bash
sudo dnf install cowsay -y
```

### b. Táº¡o file message of the day (MOTD) Ä‘á»™ng váº­t

```bash
sudo nano /etc/update-motd.d/40-cow
# DÃ¡n vÃ o bÃªn trong file:
#!/bin/bash
cowsay "Welcome to Animals For Life EC2!"
```
- Ctrl+O Ä‘á»ƒ save, Ctrl+X Ä‘á»ƒ thoÃ¡t

### c. Set permission vÃ  force update MOTD

```bash
sudo chmod +x /etc/update-motd.d/40-cow
sudo run-parts /etc/update-motd.d > /run/motd.dynamic
```

### d. Reboot láº¡i instance Ä‘á»ƒ kiá»ƒm tra banner

```bash
sudo reboot
```

- Sau khi reboot, reconnect láº¡i EC2 (Instance Connect) sáº½ tháº¥y **banner Ä‘á»™ng váº­t** khi Ä‘Äƒng nháº­p.

---

## 7. Tá»•ng káº¿t pháº§n 1

- EC2 Ä‘Ã£ Ä‘Æ°á»£c cÃ i sáºµn WordPress (chÆ°a hoÃ n táº¥t cÃ i Ä‘áº·t) + banner Ä‘á»™ng váº­t cho business Animals For Life.
- ÄÃ¢y lÃ  â€œmáº«u gá»‘câ€ Ä‘á»ƒ **táº¡o AMI**.
- AMI nÃ y giÃºp deploy nhanh nhiá»u EC2 vá»›i cáº¥u hÃ¬nh giá»‘ng há»‡t (WordPress sáºµn sÃ ng, banner Ä‘á»™ng váº­t).

---

**Tiáº¿p tá»¥c pháº§n 2: HÆ°á»›ng dáº«n táº¡o AMI tá»« instance nÃ y vÃ  kiá»ƒm tra launch EC2 má»›i tá»« AMI.**
