## ğŸ—ï¸ XÃ¢y dá»±ng VPC Custom Ä‘a táº§ng trÃªn AWS â€“ LÃ½ thuyáº¿t ná»n táº£ng cho ngÆ°á»i má»›i

---
<img width="847" height="486" alt="image" src="https://github.com/user-attachments/assets/52822379-dfdb-4246-9397-24d99471d87f" />

## PHáº¦N 1: LÃ½ thuyáº¿t ná»n táº£ng (Cáº¦N NHá»š Äá»‚ LÃ€M VÃ€ THI)

### 1. **Custom VPC lÃ  gÃ¬?**
- **VPC (Virtual Private Cloud)**: Máº¡ng riÃªng áº£o, tÃ¡ch biá»‡t hoÃ n toÃ n, chá»‰ báº¡n kiá»ƒm soÃ¡t trong 1 AWS Region.
- **Custom VPC** lÃ  VPC do báº¡n tá»± thiáº¿t káº¿, tá»± cáº¥u hÃ¬nh IP, subnet, báº£o máº­t, khÃ¡c hoÃ n toÃ n vá»›i Default VPC (AWS táº¡o sáºµn, cá»©ng nháº¯c, Ã­t tÃ¹y biáº¿n).
- **Multi-tier VPC**: VPC chia thÃ nh nhiá»u lá»›p (tier) â€“ vÃ­ dá»¥: Web, App, Database, Reserved â€“ Ä‘á»ƒ tÄƒng báº£o máº­t, má»Ÿ rá»™ng, dá»… quáº£n trá»‹.

### 2. **TÆ° duy thiáº¿t káº¿ tá»«ng bÆ°á»›c nhÆ° chÆ¡i Lego**
- Äá»«ng sá»£ sÆ¡ Ä‘á»“ phá»©c táº¡p! XÃ¢y tá»«ng layer, tá»«ng pháº§n, giá»‘ng nhÆ° láº¯p Lego.
- Báº¯t Ä‘áº§u tá»« â€œvá»â€ (shell) VPC, sau Ä‘Ã³ thÃªm subnet, gateway, routing, securityâ€¦
- Má»¥c tiÃªu: Äáº¿n cuá»‘i section nÃ y, báº¡n sáº½ tá»± tin xÃ¢y dá»±ng máº¡ng riÃªng phá»©c táº¡p trÃªn AWS.

### 3. **IP Plan thá»±c táº¿ (vÃ­ dá»¥ cho account general, US region 1)**
- **CIDR cho VPC:** `10.16.0.0/16` (65,536 IP usable)
- **4 tiers x 4 AZ = 16 subnet** (Web, App, DB, Reserved Ã— AZ a/b/c/d)
- **Demo nÃ y táº¡o 4 tier Ã— 3 AZ (A, B, C) = 12 subnet**. DÃ nh pháº§n AZ D Ä‘á»ƒ má»Ÿ rá»™ng vá» sau (theo best practice â€œluÃ´n dá»± phÃ²ngâ€).

### 4. **CÃ¡c thÃ nh pháº§n sáº½ bá»• sung dáº§n:**
- **Internet Gateway**: Cho phÃ©p tÃ i nguyÃªn trong VPC ra/vÃ o Internet (sau bÃ i shell sáº½ táº¡o).
- **NAT Gateway**: Cho phÃ©p private subnet truy cáº­p Internet (outbound only).
- **Bastion Host**: MÃ¡y chá»§ â€œtráº¡m trung gianâ€ SSH vÃ o VPC (dÃ¹ng Ä‘á»ƒ há»c, thá»±c táº¿ sáº½ thay báº±ng giáº£i phÃ¡p an toÃ n hÆ¡n).
- **NACLs (Network ACL)**: TÆ°á»ng lá»­a lá»›p máº¡ng, bá»• sung báº£o máº­t cho VPC.
- **Data transfer cost**: Cáº§n tÃ­nh toÃ¡n khi thiáº¿t káº¿ máº¡ng (in-out giá»¯a VPC, Internet, cross-AZâ€¦).

### 5. **LÃ½ thuyáº¿t kiáº¿n trÃºc VPC cáº§n nhá»› Ä‘á»ƒ thi & Ä‘i lÃ m**
- **VPC lÃ  dá»‹ch vá»¥ â€œregionalâ€ â€“ táº¡o trong 1 region, dÃ¹ng Ä‘Æ°á»£c táº¥t cáº£ AZ cá»§a region Ä‘Ã³**
- **Má»™t account cÃ³ thá»ƒ cÃ³ nhiá»u VPC, má»—i VPC lÃ  â€œrÃ o cháº¯nâ€ báº£o vá»‡ â€“ khÃ´ng gÃ¬ tá»± do ra/vÃ o náº¿u chÆ°a explicit allow**
- **VPC = blast radius boundary**: Náº¿u bá»‹ hack/lá»—i, chá»‰ áº£nh hÆ°á»Ÿng trong VPC (giá»›i háº¡n thiá»‡t háº¡i)
- **Default VPC**: AWS tá»± cáº¥u hÃ¬nh, 1 subnet/AZ, IP range giá»‘ng nhau, khÃ´ng cáº§n setup gÃ¬
- **Custom VPC**: Báº¡n tá»± quyáº¿t Ä‘á»‹nh má»i thá»©, phÃ¹ há»£p cho production, dá»… má»Ÿ rá»™ng/hybrid
- **Há»— trá»£ Hybrid networking**: Káº¿t ná»‘i VPC vá»›i on-premises hoáº·c cloud khÃ¡c (VPN, Direct Connect, Peering...)

### 6. **TÃ¹y chá»n Tenancy (Ráº¤T hay ra Ä‘á» thi)**
- **Default tenancy**: TÃ i nguyÃªn dÃ¹ng shared hardware (dÃ¹ng chung váº­t lÃ½, tÃ¡ch biá»‡t logical). CÃ³ thá»ƒ chá»n dedicated khi táº¡o EC2.
- **Dedicated tenancy**: ToÃ n bá»™ tÃ i nguyÃªn cháº¡y trÃªn dedicated hardware riÃªng biá»‡t, Ä‘áº¯t tiá»n, chá»‰ chá»n khi cÃ³ nhu cáº§u compliance Ä‘áº·c biá»‡t (PCI, ngÃ¢n hÃ ngâ€¦). Náº¿u chá»n nháº§m thÃ¬ khÃ´ng Ä‘á»•i láº¡i Ä‘Æ°á»£c, chá»‰ dÃ¹ng khi thá»±c sá»± cáº§n.

### 7. **Cáº¥u hÃ¬nh IP cho VPC**
- **Báº¯t buá»™c cÃ³ 1 dáº£i private IPv4 khi táº¡o VPC** (CIDR block), vÃ­ dá»¥: /16 = 65,536 IP, /28 = 16 IP (dÃ¹ng Ä‘Æ°á»£c ~11 IP do AWS giá»¯ láº¡i 5).
- **CÃ³ thá»ƒ gÃ¡n thÃªm tá»‘i Ä‘a 5 CIDR block phá»¥ sau khi táº¡o (má»Ÿ support request thÃ¬ tÄƒng Ä‘Æ°á»£c)**
- **IPv6**: CÃ³ thá»ƒ thÃªm /56 IPv6 CIDR, AWS cáº¥p range (khÃ´ng chá»n Ä‘Æ°á»£c nhÆ° IPv4). IPv6 trÃªn AWS Ä‘á»u lÃ  public-routeable (báº­t/táº¯t káº¿t ná»‘i Internet báº±ng security, chá»© khÃ´ng phÃ¢n public/private IP nhÆ° IPv4).
- **Tip**: DÃ¹ IPv6 lÃ  public, nhÆ°ng pháº£i cáº¥u hÃ¬nh rule thÃ¬ má»›i káº¿t ná»‘i ra ngoÃ i Ä‘Æ°á»£c â€“ máº·c Ä‘á»‹nh váº«n an toÃ n.

### 8. **DNS trong VPC (Ráº¥t hay bá»‹ há»i & dÃ­nh lá»—i tháº­t khi Ä‘i lÃ m)**
- **Route53 Resolver**: Má»—i VPC auto cÃ³ DNS. IP DNS lÃ  [Base IP cá»§a VPC] + 2 (vÃ­ dá»¥ VPC 10.0.0.0/16 â†’ DNS server: 10.0.0.2).
- **2 Option quan trá»ng:**

 **1. `enableDnsSupport`**

ÄÃ¢y lÃ  cÃ´ng táº¯c chÃ­nh Ä‘á»ƒ báº­t **dá»‹ch vá»¥ phÃ¢n giáº£i tÃªn miá»n (DNS)** cho toÃ n bá»™ VPC.

* **Chá»©c nÄƒng:** Cho phÃ©p cÃ¡c mÃ¡y chá»§ (EC2 instance) trong VPC cá»§a báº¡n cÃ³ thá»ƒ sá»­ dá»¥ng tÃªn miá»n (vÃ­ dá»¥: `google.com`) thay vÃ¬ pháº£i nhá»› Ä‘á»‹a chá»‰ IP.
* **VÃ­ dá»¥ ngáº¯n gá»n:** Khi báº­t tÃ­nh nÄƒng nÃ y, cÃ¡c EC2 instance trong VPC cÃ³ thá»ƒ truy cáº­p `s3.amazonaws.com`. Náº¿u táº¯t, chÃºng khÃ´ng thá»ƒ lÃ m Ä‘iá»u Ä‘Ã³.
* **Vá»‹ trÃ­ mÃ¡y chá»§ DNS:** AWS tá»± Ä‘á»™ng táº¡o má»™t mÃ¡y chá»§ DNS vÃ  gÃ¡n cho nÃ³ Ä‘á»‹a chá»‰ IP Ä‘áº·c biá»‡t: **Ä‘á»‹a chá»‰ IP Ä‘áº§u tiÃªn cá»§a VPC cá»™ng 2** (vÃ­ dá»¥: `10.0.0.2` náº¿u VPC lÃ  `10.0.0.0/16`).



 **2. `enableDnsHostnames`**

ÄÃ¢y lÃ  cÃ´ng táº¯c phá»¥, dá»±a trÃªn `enableDnsSupport` Ä‘Ã£ Ä‘Æ°á»£c báº­t.

* **Chá»©c nÄƒng:** GÃ¡n má»™t **tÃªn miá»n cÃ´ng cá»™ng (public DNS name)** cho cÃ¡c EC2 instance cÃ³ Ä‘á»‹a chá»‰ IP cÃ´ng cá»™ng (Public IP).
* **VÃ­ dá»¥ ngáº¯n gá»n:** Má»™t EC2 instance cÃ³ Ä‘á»‹a chá»‰ IP cÃ´ng cá»™ng lÃ  `34.200.1.20` sáº½ Ä‘Æ°á»£c gÃ¡n tÃªn miá»n cÃ´ng cá»™ng lÃ  `ec2-34-200-1-20.compute.amazonaws.com`.
* **Äiá»u kiá»‡n:** Thuá»™c tÃ­nh nÃ y **chá»‰ hoáº¡t Ä‘á»™ng khi `enableDnsSupport` Ä‘Ã£ Ä‘Æ°á»£c báº­t**.


 **TÃ³m táº¯t Ä‘Æ¡n giáº£n:**

-   **`enableDnsSupport`**: Báº­t chá»©c nÄƒng DNS cho VPC, giÃºp cÃ¡c mÃ¡y chá»§ trong Ä‘Ã³ truy cáº­p Ä‘Æ°á»£c cÃ¡c tÃªn miá»n.
-   **`enableDnsHostnames`**: GÃ¡n tÃªn miá»n cÃ´ng cá»™ng cho cÃ¡c mÃ¡y chá»§ cÃ³ Public IP.


## PHáº¦N 2: Checklist kiáº¿n thá»©c cáº§n nhá»› Ä‘á»ƒ Ä‘i thi & Ä‘i lÃ m

- [x] VPC lÃ  gÃ¬? TÃ¡ch biá»‡t, báº£o máº­t, giá»›i háº¡n blast radius
- [x] VPC lÃ  dá»‹ch vá»¥ regional, dÃ¹ng Ä‘Æ°á»£c má»i AZ cá»§a region
- [x] Default VPC vs Custom VPC: khÃ¡c biá»‡t lá»›n vá» tÃ¹y chá»‰nh, báº£o máº­t, má»Ÿ rá»™ng
- [x] TÃ¹y chá»n tenancy (Default vs Dedicated): khi nÃ o dÃ¹ng, lÆ°u Ã½ chi phÃ­
- [x] Khi táº¡o VPC pháº£i chá»n IPv4 CIDR, cÃ³ thá»ƒ thÃªm IPv6
- [x] IPv4 chia subnet theo AZ, má»—i subnet náº±m trong 1 AZ duy nháº¥t
- [x] IPv6 lÃ  public, khÃ´ng phÃ¢n biá»‡t public/private, quáº£n báº±ng security
- [x] DNS trong VPC: nhá»› 2 setting enableDnsHostnames & enableDnsSupport
- [x] File IP plan lÃ  â€œbáº£o bá»‘iâ€ khi lÃ m dá»± Ã¡n tháº­t

---

## PHáº¦N 3: á»¨ng dá»¥ng thá»±c táº¿ & bÃ i táº­p hands-on

### **TÃ¬nh huá»‘ng thá»±c táº¿**
- CÃ´ng ty cáº§n VPC riÃªng cho tá»«ng mÃ´i trÆ°á»ng (general, prod, dev), má»—i VPC theo chuáº©n 4 tier Ã— 4 AZ â†’ 16 subnet. Dá»… má»Ÿ rá»™ng, dá»… quáº£n trá»‹, báº£o máº­t tá»‘t, dá»… káº¿t ná»‘i hybrid.
- Má»—i khi táº¡o VPC, luÃ´n lÆ°u láº¡i IP plan, subnet plan Ä‘á»ƒ trÃ¡nh trÃ¹ng láº·p, dá»… audit, dá»… troubleshoot.

### **CÃ¢u há»i phá»ng váº¥n/cert hay gáº·p**
- So sÃ¡nh Default VPC vÃ  Custom VPC?
- Tenancy lÃ  gÃ¬? Khi nÃ o chá»n dedicated?
- IPv6 trÃªn AWS khÃ¡c gÃ¬ IPv4 vá» khÃ¡i niá»‡m public/private?
- DNS trong VPC hoáº¡t Ä‘á»™ng tháº¿ nÃ o? Náº¿u EC2 khÃ´ng resolve Ä‘Æ°á»£c DNS thÃ¬ kiá»ƒm tra gÃ¬ trÆ°á»›c?
- Maximum/minimum CIDR VPC lÃ  gÃ¬? (Min: /28, Max: /16)

### **Practice: Táº¡o VPC shell Ä‘áº§u tiÃªn cho Animals4Life**
- VPC CIDR: 10.16.0.0/16
- Chá»n 3 AZ Ä‘áº§u tiÃªn (A, B, C), má»—i AZ sau nÃ y sáº½ cÃ³ 4 subnet (web, app, db, reserved)
- Enable DNS support & DNS hostnames
- Tenancy: Default
- ChÆ°a táº¡o subnet, gateway â€“ Ä‘á»ƒ á»Ÿ bÃ i sau

---

## PHáº¦N 4: Tá»•ng káº¿t & tips nhá»› lÃ¢u

- XÃ¢y VPC custom lÃ  bÆ°á»›c Ä‘áº§u tiÃªn, cá»±c ká»³ quan trá»ng khi lÃ m cloud thá»±c táº¿ vÃ  Ä‘i thi AWS.
- Äá»«ng ngáº¡i sÆ¡ Ä‘á»“ phá»©c táº¡p, cá»© chia nhá» tá»«ng bÆ°á»›c, lÃ m tá»«ng pháº§n (giá»‘ng chÆ¡i Lego).
- Ghi nhá»›: VPC lÃ  â€œrÃ o cháº¯nâ€ báº£o máº­t, blast radius, má»—i VPC lÃ  1 vÃ¹ng an toÃ n tÃ¡ch biá»‡t.
- LÃºc nÃ o cÅ©ng pháº£i cÃ³ file IP plan/subnet plan â€“ Ä‘i lÃ m khÃ´ng cÃ³ lÃ  â€œtoangâ€!
- Khi gáº·p lá»—i DNS/route, luÃ´n check 2 setting enableDnsHostnames & enableDnsSupport trÆ°á»›c!


