# ğŸŒ VPC Subnets trÃªn AWS: LÃ½ thuyáº¿t & tÆ° duy thá»±c chiáº¿n (Dá»… hiá»ƒu cho ngÆ°á»i má»›i, Ä‘á»§ thi & Ä‘i lÃ m)

---

## PHáº¦N 1: LÃ½ thuyáº¿t ná»n táº£ng vá» Subnet (Cáº¦N NHá»š)

### 1. **Subnet lÃ  gÃ¬?**
- **Subnet = â€œphÃ²ngâ€ nhá» trong â€œngÃ´i nhÃ â€ VPC**
- LÃ  **khu vá»±c máº¡ng con** náº±m trá»n váº¹n trong 1 Availability Zone (AZ) cá»¥ thá»ƒ, khÃ´ng thá»ƒ â€œkÃ©oâ€ qua AZ khÃ¡c.
- **Má»™t subnet = má»™t AZ duy nháº¥t** (Äi thi cá»±c hay há»i!)
- Subnet lÃ  nÆ¡i cÃ¡c dá»‹ch vá»¥ AWS (EC2, RDS, Lambda, â€¦) thá»±c sá»± â€œcháº¡yâ€. KhÃ´ng thá»ƒ cháº¡y tÃ i nguyÃªn trá»±c tiáº¿p trÃªn VPC, pháº£i Ä‘áº·t trong subnet.

### 2. **Vai trÃ² cá»§a subnet trong kiáº¿n trÃºc thá»±c táº¿**
- **TÄƒng tÃ­nh sáºµn sÃ ng (High Availability):** Äáº·t tá»«ng thÃ nh pháº§n (web, app, db, â€¦) vÃ o cÃ¡c subnet thuá»™c nhiá»u AZ khÃ¡c nhau. Náº¿u 1 AZ cháº¿t, dá»‹ch vá»¥ váº«n sá»‘ng á»Ÿ AZ khÃ¡c.
- **TÃ¡ch biá»‡t chá»©c nÄƒng:** Táº¡o subnet riÃªng cho tá»«ng tier (web/app/db), dá»… set rule báº£o máº­t, quáº£n lÃ½ traffic.
- **Kiá»ƒm soÃ¡t public/private:** Chá»‰ subnet nÃ o cáº¥u hÃ¬nh â€œpublicâ€ (qua Internet Gateway & auto-assign public IP) thÃ¬ má»›i truy cáº­p Internet Ä‘Æ°á»£c.

### 3. **Quy táº¯c vÃ ng vá» subnet**
- **1 subnet = 1 AZ.** KhÃ´ng bao giá» cÃ³ subnet náº±m á»Ÿ nhiá»u AZ.
- **1 AZ cÃ³ thá»ƒ cÃ³ nhiá»u subnet, hoáº·c khÃ´ng cÃ³ subnet nÃ o.**
- **Subnet pháº£i náº±m hoÃ n toÃ n trong dáº£i IP VPC, khÃ´ng Ä‘Æ°á»£c trÃ¹ng nhau.**
- **Subnet cÃ³ thá»ƒ cÃ³ cáº£ IPv4 vÃ  IPv6 (náº¿u VPC báº­t IPv6).**
- **IPv4 CIDR cá»§a subnet lÃ  â€œconâ€ cá»§a CIDR VPC.** VÃ­ dá»¥ VPC `/16`, chia subnet `/20` hoáº·c `/24`â€¦

### 4. **AWS sáº½ giá»¯ láº¡i 5 IP trong má»—i subnet, báº¡n khÃ´ng dÃ¹ng Ä‘Æ°á»£c!**
- 5 IP nÃ y lÃ :
    1. **Network address** (Ä‘á»‹a chá»‰ Ä‘áº§u tiÃªn, dÃ¹ng Ä‘á»ƒ Ä‘á»‹nh danh subnet)
    2. **Network+1** (dÃ¹ng cho VPC router â€“ Ä‘á»‹nh tuyáº¿n giá»¯a cÃ¡c subnet)
    3. **Network+2** (dÃ¹ng cho DNS server trong VPC)
    4. **Network+3** (AWS dá»± phÃ²ng cho tÆ°Æ¡ng lai, hiá»‡n chÆ°a dÃ¹ng)
    5. **Broadcast address** (Ä‘á»‹a chá»‰ cuá»‘i cÃ¹ng â€“ dÃ¹ VPC khÃ´ng há»— trá»£ broadcast, nhÆ°ng váº«n giá»¯ láº¡i)
- **â†’ Khi tÃ­nh sá»‘ IP usable luÃ´n láº¥y tá»•ng sá»‘ IP trá»« Ä‘i 5.**  
  VÃ­ dá»¥: `/24` = 256 IP, usable = 251.



### 5. **DHCP Option Set**
- VPC auto cÃ³ 1 DHCP Option Set â€“ giÃºp EC2 trong subnet tá»± nháº­n IP, DNS server, NTP serverâ€¦
- KhÃ´ng chá»‰nh sá»­a Ä‘Æ°á»£c DHCP Option Set, muá»‘n Ä‘á»•i pháº£i táº¡o má»›i rá»“i gÃ¡n vÃ o VPC.
<details>
<summary>< Giáº£i thÃ­ch chi tiáº¿t vá» DHCP Option Set (Báº¥m Ä‘á»ƒ xem)</summary>

---

### DHCP Option Set lÃ  gÃ¬?

Náº¿u VPC lÃ  má»™t khu máº¡ng áº£o riÃªng, thÃ¬ **DHCP Option Set** chÃ­nh lÃ  **bá»™ quy táº¯c cáº¥u hÃ¬nh máº¡ng máº·c Ä‘á»‹nh** Ä‘Æ°á»£c Ã¡p dá»¥ng cho toÃ n bá»™ khu vá»±c Ä‘Ã³. NÃ³ lÃ  má»™t táº­p há»£p cÃ¡c thÃ´ng sá»‘ mÃ  giao thá»©c DHCP (Dynamic Host Configuration Protocol) sáº½ cung cáº¥p tá»± Ä‘á»™ng cho cÃ¡c mÃ¡y chá»§ (EC2) má»›i Ä‘Æ°á»£c khá»Ÿi táº¡o bÃªn trong VPC.

Má»¥c tiÃªu chÃ­nh cá»§a DHCP Option Set lÃ  **Ä‘Æ¡n giáº£n hÃ³a viá»‡c cáº¥u hÃ¬nh máº¡ng** vÃ  Ä‘áº£m báº£o tÃ­nh nháº¥t quÃ¡n cho toÃ n bá»™ há»‡ thá»‘ng.



---
### CÃ¡c tÃ¹y chá»n (Options) chÃ­nh

Má»™t DHCP Option Set bao gá»“m nhiá»u tÃ¹y chá»n, nhÆ°ng Ä‘Ã¢y lÃ  nhá»¯ng tÃ¹y chá»n quan trá»ng nháº¥t:

* **MÃ¡y chá»§ DNS (`domain-name-servers`)**
    * **Chá»©c nÄƒng:** Chá»‰ Ä‘á»‹nh mÃ¡y chá»§ DNS mÃ  cÃ¡c EC2 sáº½ dÃ¹ng Ä‘á»ƒ phÃ¢n giáº£i tÃªn miá»n (vÃ­ dá»¥: biáº¿n `google.com` thÃ nh Ä‘á»‹a chá»‰ IP).
    * **Máº·c Ä‘á»‹nh cá»§a AWS:** `AmazonProvidedDNS`, má»™t dá»‹ch vá»¥ Ä‘áº·c biá»‡t cÃ³ thá»ƒ phÃ¢n giáº£i cáº£ tÃªn miá»n cÃ´ng cá»™ng vÃ  tÃªn miá»n riÃªng tÆ° cá»§a cÃ¡c EC2 khÃ¡c trong cÃ¹ng VPC.
    * **TÃ¹y chá»‰nh:** Báº¡n cÃ³ thá»ƒ thay báº±ng DNS cá»§a cÃ´ng ty hoáº·c DNS cÃ´ng cá»™ng nhÆ° `8.8.8.8`.

* **TÃªn Miá»n (`domain-name`)**
    * **Chá»©c nÄƒng:** GÃ¡n má»™t tÃªn miá»n máº·c Ä‘á»‹nh cho cÃ¡c mÃ¡y chá»§, giÃºp táº¡o thÃ nh TÃªn miá»n Äáº§y Ä‘á»§ (FQDN). VÃ­ dá»¥: `server-1.mycompany.local`.

* **MÃ¡y chá»§ Thá»i gian NTP (`ntp-servers`)**
    * **Chá»©c nÄƒng:** Chá»‰ Ä‘á»‹nh mÃ¡y chá»§ thá»i gian Ä‘á»ƒ cÃ¡c EC2 Ä‘á»“ng bá»™ giá» giáº¥c. Äiá»u nÃ y ráº¥t quan trá»ng cho viá»‡c ghi log vÃ  báº£o máº­t.

---
### Táº¡i sao khÃ´ng thá»ƒ chá»‰nh sá»­a trá»±c tiáº¿p?

ÄÃ¢y lÃ  má»™t quy táº¯c thiáº¿t káº¿ quan trá»ng cá»§a AWS nháº±m Ä‘áº£m báº£o **an toÃ n vÃ  nháº¥t quÃ¡n**.

Viá»‡c cho phÃ©p sá»­a Ä‘á»•i trá»±c tiáº¿p má»™t DHCP Option Set Ä‘ang Ä‘Æ°á»£c sá»­ dá»¥ng cÃ³ thá»ƒ gÃ¢y ra sá»± cá»‘ máº¥t káº¿t ná»‘i máº¡ng trÃªn diá»‡n rá»™ng náº¿u cÃ³ lá»—i xáº£y ra. Do Ä‘Ã³, quy trÃ¬nh an toÃ n lÃ :

1.  **Táº¡o má»™t DHCP Option Set má»›i** vá»›i cáº¥u hÃ¬nh báº¡n muá»‘n.
2.  **GÃ¡n (associate)** set má»›i nÃ y vÃ o VPC Ä‘á»ƒ thay tháº¿ cho set cÅ©.

---
### Khi nÃ o cáº§n quan tÃ¢m?

Báº¡n chá»‰ thá»±c sá»± cáº§n táº¡o má»™t DHCP Option Set tÃ¹y chá»‰nh trong cÃ¡c trÆ°á»ng há»£p sau:

* **MÃ´i trÆ°á»ng Lai (Hybrid Cloud):** Khi báº¡n muá»‘n mÃ¡y chá»§ trÃªn AWS "tháº¥y" vÃ  giao tiáº¿p Ä‘Æ°á»£c vá»›i cÃ¡c mÃ¡y chá»§ á»Ÿ vÄƒn phÃ²ng cÃ´ng ty báº±ng tÃªn miá»n ná»™i bá»™.
* **TÃ­ch há»£p Active Directory:** Khi cÃ¡c mÃ¡y chá»§ Windows cáº§n gia nháº­p vÃ o miá»n (domain) cá»§a cÃ´ng ty.
* **TuÃ¢n thá»§ chÃ­nh sÃ¡ch ná»™i bá»™:** Khi cÃ´ng ty yÃªu cáº§u sá»­ dá»¥ng mÃ¡y chá»§ DNS hoáº·c NTP riÃªng.

</details>



### 6. **Option quan trá»ng khi táº¡o subnet**
- **Auto-assign public IPv4:** Náº¿u báº­t, má»i EC2 khi launch vÃ o subnet nÃ y sáº½ tá»± Ä‘Æ°á»£c gÃ¡n public IP.
    - **Muá»‘n subnet public:** Báº­t option nÃ y + subnet cÃ³ route ra Internet Gateway.
    - **Muá»‘n subnet private:** Táº¯t option nÃ y, EC2 chá»‰ cÃ³ private IP (muá»‘n ra Internet pháº£i qua NAT Gateway).
- **IPv6:** Náº¿u subnet (vÃ  VPC) báº­t IPv6, EC2 vÃ o subnet sáº½ Ä‘Æ°á»£c gÃ¡n IPv6 (public routeable).

### 7. **Káº¿t ná»‘i giá»¯a cÃ¡c subnet**
- **Máº·c Ä‘á»‹nh:** CÃ¡c subnet trong cÃ¹ng VPC truy cáº­p nhau tá»± do (do route table máº·c Ä‘á»‹nh), khÃ´ng bá»‹ cháº·n (báº£o máº­t dÃ¹ng Security Group/Network ACL).
- **Isolation thá»±c sá»±:** á» biÃªn cá»§a VPC, khÃ´ng pháº£i giá»¯a cÃ¡c subnet.

---

## PHáº¦N 2: TÆ° duy thiáº¿t káº¿ subnet thá»±c chiáº¿n (Äi lÃ m & Ä‘i thi)

### 1. **Multi-tier subnet máº«u cho production**
- **Web tier:** Chá»‰ web server, cÃ³ thá»ƒ Ä‘áº·t public náº¿u cáº§n.
- **App tier:** Logic xá»­ lÃ½, private subnet.
- **Database tier:** CÆ¡ sá»Ÿ dá»¯ liá»‡u, luÃ´n á»Ÿ private subnet.
- **Reserved tier:** Äá»ƒ trá»‘ng, dá»± phÃ²ng má»Ÿ rá»™ng.
- **Má»—i tier nhÃ¢n vá»›i sá»‘ AZ (thÆ°á»ng lÃ  3 hoáº·c 4) â†’ tá»•ng sá»‘ subnet.**

### 2. **VÃ­ dá»¥ chia subnet thá»±c táº¿**
- VPC: `10.16.0.0/16`
- Chia 4 tier Ã— 3 AZ (A, B, C) = **12 subnet**
    - Web-A: `10.16.0.0/20`
    - Web-B: `10.16.16.0/20`
    - Web-C: `10.16.32.0/20`
    - App-A: `10.16.48.0/20`
    - ...
    - Reserved-C: `10.16.176.0/20`
- **Subnet nÃ o AZ nÃ o pháº£i Ä‘áº·t Ä‘Ãºng, khÃ´ng Ä‘áº£o lá»™n!**

### 3. **BÃ i há»c thá»±c táº¿**
- Sai subnet/AZ hoáº·c CIDR trÃ¹ng láº·p â†’ há»‡ thá»‘ng lá»—i, ráº¥t khÃ³ sá»­a sau nÃ y.
- QuÃªn báº­t/táº¯t auto-assign public IP â†’ EC2 khÃ´ng truy cáº­p Internet hoáº·c bá»‹ public ngoÃ i Ã½ muá»‘n.
- KhÃ´ng tÃ­nh trá»« 5 IP â†’ háº¿t IP sá»›m, Ä‘áº·c biá»‡t subnet nhá» `/28`, `/27`.

---

## PHáº¦N 3: Checklist & cÃ¢u há»i phá»ng váº¥n/cert

- [x] 1 subnet chá»‰ thuá»™c 1 AZ, AZ cÃ³ thá»ƒ nhiá»u subnet
- [x] CIDR subnet pháº£i náº±m trong CIDR VPC, khÃ´ng trÃ¹ng nhau
- [x] 5 IP bá»‹ AWS giá»¯ láº¡i/subnet (network, router, DNS, dá»± phÃ²ng, broadcast)
- [x] Muá»‘n subnet public pháº£i báº­t auto-assign public IP & cÃ³ route ra IGW
- [x] Táº¥t cáº£ subnet trong 1 VPC máº·c Ä‘á»‹nh truy cáº­p nhau Ä‘Æ°á»£c
- [x] Khi chia subnet pháº£i cÃ³ file/subnet plan Ä‘á»ƒ trÃ¡nh trÃ¹ng

### **CÃ¢u há»i Ä‘i thi/phá»ng váº¥n:**
- â€œMá»™t subnet cÃ³ thá»ƒ náº±m á»Ÿ nhiá»u AZ khÃ´ng?â€
- â€œSubnet cÃ³ thá»ƒ trÃ¹ng CIDR khÃ´ng?â€
- â€œLÃ m sao Ä‘á»ƒ subnet thÃ nh public/private?â€
- â€œ5 IP bá»‹ giá»¯ láº¡i lÃ  gÃ¬?â€
- â€œNáº¿u EC2 khÃ´ng cÃ³ public IP dÃ¹ subnet public, kiá»ƒm tra gÃ¬?â€

---

## PHáº¦N 4: Tá»•ng káº¿t & chuáº©n bá»‹ demo thá»±c hÃ nh

- Subnet lÃ  ná»n táº£ng cá»§a má»i thiáº¿t káº¿ máº¡ng AWS â€“ pháº£i hiá»ƒu cá»±c cháº¯c.
- Tuyá»‡t Ä‘á»‘i khÃ´ng Ä‘Æ°á»£c nháº§m subnet/AZ, khÃ´ng Ä‘Æ°á»£c trÃ¹ng CIDR.
- Muá»‘n subnet public/private lÃ  do option khi táº¡o + route table, khÃ´ng pháº£i do tÃªn.
- Khi chia subnet nÃªn lÃ m báº£ng (excel/pdf) lÆ°u láº¡i mapping tierâ€“AZâ€“CIDR.
- **BÃ i sau:** Thá»±c hÃ nh táº¡o 12 subnet cho VPC, cáº¥u hÃ¬nh Ä‘Ãºng tá»«ng AZ, Ä‘Ãºng option!

---

**Äá»c láº¡i bÃ i nÃ y trÆ°á»›c khi Ä‘i thi hoáº·c báº¯t Ä‘áº§u lÃ m báº¥t ká»³ dá»± Ã¡n AWS production nÃ o!**
