# üõ°Ô∏è Network ACL (NACL) tr√™n AWS: L√Ω thuy·∫øt & th·ª±c chi·∫øn cho ng∆∞·ªùi m·ªõi (ƒê·ªß thi cert & ƒëi l√†m)

---

## PH·∫¶N 1: Network ACL (NACL) l√† g√¨?
<img width="836" height="473" alt="image" src="https://github.com/user-attachments/assets/cdd31e15-df34-499b-af2a-1df0f1abe14e" />

### **ƒê·ªãnh nghƒ©a c∆° b·∫£n**
- **Network Access Control List (NACL)** = **firewall truy·ªÅn th·ªëng** ·ªü c·∫•p subnet trong AWS VPC
- **Associate v·ªõi subnet**, kh√¥ng ph·∫£i v·ªõi instance
- **Stateless firewall** (kh√¥ng nh·ªõ tr·∫°ng th√°i k·∫øt n·ªëi)
- **Filter traffic khi ƒëi qua bi√™n gi·ªõi subnet** (v√†o/ra subnet)

### **ƒêi·ªÉm quan tr·ªçng c·∫ßn nh·ªõ**
- ‚úÖ **Traffic v√†o/ra subnet:** B·ªã NACL ki·ªÉm so√°t
- ‚ùå **Traffic gi·ªØa c√°c instance trong c√πng subnet:** KH√îNG b·ªã NACL ki·ªÉm so√°t
- üîÑ **C·∫ßn 2 rule cho 1 k·∫øt n·ªëi:** Inbound rule + Outbound rule (v√¨ stateless)

---

## PH·∫¶N 2: C√°ch NACL ho·∫°t ƒë·ªông (C·ª±c quan tr·ªçng)
<img width="859" height="468" alt="image" src="https://github.com/user-attachments/assets/e2555731-bae9-491b-b841-85d821ed208f" />

### **C·∫•u tr√∫c rule trong NACL**
```yaml
NACL Rules Structure:
  Inbound Rules:    # Traffic v√†o subnet
    - Rule #100: Allow TCP 443 from 0.0.0.0/0
    - Rule #200: Allow TCP 80 from 0.0.0.0/0
    - Rule #*: DENY all (implicit deny)
    
  Outbound Rules:   # Traffic ra kh·ªèi subnet
    - Rule #100: Allow TCP 1024-65535 to 0.0.0.0/0
    - Rule #*: DENY all (implicit deny)
```

### **Rule processing logic**
1. **NACL x√°c ƒë·ªãnh:** D√πng inbound hay outbound rule set
2. **Process theo th·ª© t·ª±:** Rule number th·∫•p nh·∫•t tr∆∞·ªõc (100 ‚Üí 200 ‚Üí 300...)
3. **First match wins:** G·∫∑p rule kh·ªõp ƒë·∫ßu ti√™n ‚Üí apply ‚Üí d·ª´ng
4. **Implicit deny (*):** N·∫øu kh√¥ng match rule n√†o ‚Üí deny

> **Critical:** Rule 100 DENY s·∫Ω block ngay, d√π rule 200 ALLOW c√πng traffic!

---

## PH·∫¶N 3: V√¨ sao NACL ph·ª©c t·∫°p? (Stateless Problems)
<img width="848" height="466" alt="image" src="https://github.com/user-attachments/assets/76b100de-b09e-45ed-91f4-e0725ca338fe" />

### **V√≠ d·ª• th·ª±c t·∫ø: Web server nh·∫≠n HTTPS**
```yaml
üåê User (Bob) ‚Üí Web Server (HTTPS):

Request: 
  Bob:random_port ‚Üí Server:443 (inbound to subnet)
  
Response:
  Server:443 ‚Üí Bob:random_port (outbound from subnet)

Required NACL Rules:
  Inbound: Allow TCP 443 from 0.0.0.0/0    # Cho request
  Outbound: Allow TCP 1024-65535 to 0.0.0.0/0  # Cho response (ephemeral)
```

### **Multi-tier architecture nightmare**
```yaml
üèóÔ∏è Ki·∫øn tr√∫c: Bob ‚Üí Web Subnet ‚Üí App Subnet

C·∫ßn rules:
1. Bob ‚Üí Web:
   - Web subnet inbound: Allow 443
   - Web subnet outbound: Allow ephemeral
   
2. Web ‚Üí App:
   - Web subnet outbound: Allow app_port
   - App subnet inbound: Allow app_port
   - App subnet outbound: Allow ephemeral  
   - Web subnet inbound: Allow ephemeral

K·∫øt qu·∫£: 1 k·∫øt n·ªëi end-to-end = 6 rules! üòµ
```

### **V·∫•n ƒë·ªÅ ephemeral port**
- **Response lu√¥n d√πng ephemeral port** (1024-65535)
- **NACL ph·∫£i allow c·∫£ d·∫£i** (k√©m b·∫£o m·∫≠t)
- **Kh√¥ng bi·∫øt tr∆∞·ªõc port n√†o** ‚Üí m·ªü r·ªông

---

## PH·∫¶N 4: Default NACL vs Custom NACL
<img width="851" height="433" alt="image" src="https://github.com/user-attachments/assets/a78fc820-499d-42ce-a290-22f040838828" />

### **Default NACL (khi t·∫°o VPC)**
```yaml
‚úÖ Default NACL behavior:
  - Auto t·∫°o c√πng VPC
  - Inbound: Allow all (Rule #100: 0.0.0.0/0)
  - Outbound: Allow all (Rule #100: 0.0.0.0/0)  
  - Net effect: Kh√¥ng block g√¨ c·∫£
  - Beginner-friendly
```

### **Custom NACL (t·ª± t·∫°o)**
```yaml
‚ùå Custom NACL behavior:
  - T·∫°o ri√™ng cho VPC
  - Ban ƒë·∫ßu: ch·ªâ c√≥ implicit deny (*)
  - Associate v·ªõi subnet ‚Üí block ALL traffic
  - Ph·∫£i t·ª± add allow rules
  - Kh√° nguy hi·ªÉm n·∫øu kh√¥ng c·∫©n th·∫≠n!
```

---

## PH·∫¶N 5: NACL Key Characteristics (C·∫ßn thu·ªôc l√≤ng)

### **Core Properties**
- **Stateless:** Request & response c·∫ßn rule ri√™ng
- **Subnet-level:** 1 subnet = 1 NACL, 1 NACL = nhi·ªÅu subnet
- **Ordered processing:** Rule number th·ª© t·ª± x·ª≠ l√Ω
- **Allow & Deny:** C√≥ th·ªÉ explicit allow + explicit deny
- **Protocol/Port/IP based:** Kh√¥ng reference logical AWS resources

### **Use Cases th·ª±c t·∫ø**
```yaml
‚úÖ NACL t·ªët cho:
  - Block specific malicious IPs/ranges
  - Compliance requirements (explicit deny)
  - Network-level security (defense in depth)
  - Backup security layer

‚ùå NACL kh√¥ng t·ªët cho:
  - Primary security control (d√πng Security Group)
  - Complex application rules
  - Dynamic resources (Auto Scaling...)
```

---

## PH·∫¶N 6: NACL vs Security Group (So s√°nh c·ª±c quan tr·ªçng)

| Aspect                 | NACL                      | Security Group           |
|------------------------|---------------------------|--------------------------|
| **Level**              | Subnet                    | Instance/ENI             |
| **State**              | Stateless                 | Stateful                 |
| **Rules needed**       | 2 (inbound + outbound)    | 1 (auto allow response)  |
| **Allow/Deny**         | Both                      | Allow only               |
| **Processing**         | Ordered (first match)     | All rules evaluated      |
| **Default behavior**   | Allow all (default NACL)  | Deny all                 |
| **Use case**           | Block bad actors          | Primary access control   |

---

## PH·∫¶N 7: Best Practices & Real-world Tips

### **Th·ª±c t·∫ø khi ƒëi l√†m**
```yaml
üîß Production practices:
  - D√πng Security Group l√†m primary security
  - D√πng NACL ƒë·ªÉ block malicious IPs
  - Gi·ªØ NACL rules ƒë∆°n gi·∫£n, √≠t rule
  - Document rule numbers & purposes
  - Test carefully tr∆∞·ªõc khi apply production
```

### **Common Mistakes**
- Qu√™n rule cho response (ephemeral ports)
- Rule ordering sai (deny tr∆∞·ªõc allow)
- Associate custom NACL m√† ch∆∞a c√≥ allow rules
- Qu√™n subnet boundary behavior

---

## PH·∫¶N 8: Checklist ki·∫øn th·ª©c thi cert & ph·ªèng v·∫•n

- [x] NACL l√† stateless, c·∫ßn 2 rule/k·∫øt n·ªëi
- [x] Process theo rule number order, first match wins
- [x] 1 subnet = 1 NACL, 1 NACL = nhi·ªÅu subnet
- [x] Default NACL allow all, custom NACL deny all
- [x] Ch·ªâ filter traffic cross subnet boundary
- [x] C√≥ th·ªÉ explicit deny (kh√°c Security Group)
- [x] Kh√¥ng reference AWS logical resources

### **C√¢u h·ªèi exam th∆∞·ªùng g·∫∑p**
1. **"EC2 trong subnet kh√¥ng access ƒë∆∞·ª£c Internet, c√≥ th·ªÉ do NACL?"**
2. **"Mu·ªën block specific IP range, d√πng NACL hay Security Group?"**
3. **"Custom NACL associate v·ªõi subnet, traffic b·ªã block h·∫øt. T·∫°i sao?"**
4. **"NACL rule 100 DENY, rule 200 ALLOW c√πng traffic. K·∫øt qu·∫£?"**

---

## PH·∫¶N 9: T·ªïng k·∫øt & takeaways

- **NACL = subnet-level stateless firewall**
- **Ph·ª©c t·∫°p ƒë·ªÉ setup ƒë√∫ng** ‚Üí ch·ªâ d√πng khi c·∫ßn thi·∫øt
- **Combination v·ªõi Security Group** = defense in depth
- **Primary use: Block bad actors, compliance**
- **Rule ordering matters!** Deny tr∆∞·ªõc c√≥ th·ªÉ block allow sau

---

**Ghi nh·ªõ:** NACL l√† tool m·∫°nh nh∆∞ng ph·ª©c t·∫°p. Trong th·ª±c t·∫ø, Security Group ƒë∆°n gi·∫£n v√† hi·ªáu qu·∫£ h∆°n cho h·∫ßu h·∫øt use case. NACL d√πng khi c·∫ßn explicit deny specific IPs/ranges!

**ƒê·ªçc l·∫°i b√†i n√†y tr∆∞·ªõc khi design VPC security ho·∫∑c chu·∫©n b·ªã thi AWS SAA!**
