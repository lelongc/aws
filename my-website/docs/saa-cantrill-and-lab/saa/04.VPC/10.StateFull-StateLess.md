# üî• Ph√¢n bi·ªát Firewall Stateful & Stateless ‚Äì C·ª±c d·ªÖ hi·ªÉu cho AWS, thi cert & ƒëi l√†m

---

## PH·∫¶N 1: √în l·∫°i Networking ‚Äì TCP/IP c√≥ g√¨ li√™n quan?
<img width="845" height="483" alt="image" src="https://github.com/user-attachments/assets/ef42cb5f-d643-4631-be5b-408625e36cf1" />

- **TCP/IP:** M·ªói k·∫øt n·ªëi TCP g·ªìm nhi·ªÅu g√≥i tin (packet), m·ªói packet c√≥:
    - Source IP & port (m√°y g·ª≠i)
    - Destination IP & port (m√°y nh·∫≠n)
- **Port n·ªïi ti·∫øng:** HTTP (80), HTTPS (443)
- **Ephemeral port:** Khi client k·∫øt n·ªëi, n√≥ ch·ªçn port t·∫°m th·ªùi (random, th∆∞·ªùng 1024-65535)

### **C√°ch nh√¨n ƒë√∫ng v·ªÅ traffic**
- Client (Bob) d√πng ephemeral port ‚Üí g·ª≠i request ƒë·∫øn server port 443 (HTTPS)
- Server tr·∫£ v·ªÅ: t·ª´ port 443 ‚Üí ƒë√∫ng ephemeral port c·ªßa Bob
- **M·ªôt k·∫øt n·ªëi th·ª±c ra l√†:**
    - Request: client ‚Üí server (ephemeral ‚Üí well-known port)
    - Response: server ‚Üí client (well-known port ‚Üí ephemeral)

> **L∆∞u √Ω:** Outbound hay inbound l√† do "G√ìC NH√åN"
 <img width="829" height="482" alt="image" src="https://github.com/user-attachments/assets/b92ebae4-8f28-4a56-b253-4efe3b8c0bbf" />

> - V·ªõi client: Request l√† outbound, response l√† inbound  
> - V·ªõi server: Request l√† inbound, response l√† outbound

---

## PH·∫¶N 2: Stateless Firewall ‚Äì ‚ÄúNg·ªë‚Äù v√† phi·ªÅn ph·ª©c
<img width="840" height="479" alt="image" src="https://github.com/user-attachments/assets/f6764587-f204-4242-af23-57ae7c8ece2f" />

### **Stateless firewall l√† g√¨?**
<img width="839" height="477" alt="image" src="https://github.com/user-attachments/assets/3f967093-0c24-474e-ae4c-85ad05432c8f" />

- Kh√¥ng nh·ªõ tr·∫°ng th√°i k·∫øt n·ªëi, ch·ªâ bi·∫øt packet n√†y v√†o hay ra, port n√†o, IP n√†o.
- **Mu·ªën cho ph√©p 1 k·∫øt n·ªëi ‚Üí ph·∫£i t·∫°o 2 rule**:
    - 1 rule cho request (inbound ho·∫∑c outbound)
    - 1 rule cho response (outbound ho·∫∑c inbound ‚Äì ng∆∞·ª£c chi·ªÅu)
- **VD:**  
    - Bob k·∫øt n·ªëi t·ªõi server port 443 (HTTPS), stateless firewall:
        - server Ph·∫£i allow inbound 443 (cho request)
        - server Ph·∫£i allow outbound ephemeral port (cho response)
- **K·∫øt qu·∫£:**  
    - N·∫øu server v·ª´a nh·∫≠n connection, v·ª´a t·∫£i update (outbound), ph·∫£i c√≥ c·∫£ rule inbound & outbound cho c·∫£ hai chi·ªÅu.
    - Ph·∫£i allow c·∫£ d·∫£i port ephemeral (1024-65535) cho response v√¨ kh√¥ng bi·∫øt tr∆∞·ªõc client d√πng port n√†o ‚Üí **k√©m b·∫£o m·∫≠t, d·ªÖ sai s√≥t**.

---

## PH·∫¶N 3: Stateful Firewall ‚Äì ‚ÄúTh√¥ng minh‚Äù v√† b·∫£o m·∫≠t h∆°n

### **Stateful firewall l√† g√¨?**
<img width="842" height="498" alt="image" src="https://github.com/user-attachments/assets/8ac0f407-4b25-4943-a25d-9130eb30a491" />

- **Nh·ªõ tr·∫°ng th√°i k·∫øt n·ªëi!**
    - Khi th·∫•y packet request ƒë∆∞·ª£c allow, n√≥ t·ª± ƒë·ªông allow response v·ªÅ.
- **Ch·ªâ c·∫ßn 1 rule cho 1 chi·ªÅu:**
    - VD: Cho ph√©p inbound TCP 443 (request), response v·ªÅ ephemeral port ƒë∆∞·ª£c t·ª± ƒë·ªông allow **(kh√¥ng c·∫ßn vi·∫øt rule ri√™ng)**
- **TƒÉng b·∫£o m·∫≠t, gi·∫£m nh·∫ßm l·∫´n, d·ªÖ qu·∫£n l√Ω**
    - Kh√¥ng c·∫ßn m·ªü c·∫£ d·∫£i port ephemeral cho response
    - Gi·∫£m s·ªë rule ph·∫£i vi·∫øt, gi·∫£m l·ªói

---

## PH·∫¶N 4: So s√°nh th·ª±c t·∫ø & ·ª©ng d·ª•ng AWS

| T√≠nh nƒÉng                  | Stateless Firewall          | Stateful Firewall               |
|---------------------------|----------------------------|---------------------------------|
| Nh·ªõ tr·∫°ng th√°i            | ‚ùå Kh√¥ng                   | ‚úÖ C√≥                           |
| Quy t·∫Øc response          | Ph·∫£i vi·∫øt ri√™ng            | T·ª± ƒë·ªông ƒë∆∞·ª£c allow              |
| Qu·∫£n l√Ω port ephemeral    | Ph·∫£i m·ªü c·∫£ d·∫£i             | Kh√¥ng c·∫ßn m·ªü r·ªông               |
| B·∫£o m·∫≠t                   | K√©m h∆°n                    | T·ªët h∆°n                         |
| T·ª∑ l·ªá l·ªói/l·∫ßm             | D·ªÖ sai                     | √çt l·ªói h∆°n                      |
| AWS √°p d·ª•ng               | NACL (Network ACL)         | Security Group                  |

---

## PH·∫¶N 5: Checklist ki·∫øn th·ª©c ƒëi thi & ƒëi l√†m

- [x] Stateless: kh√¥ng nh·ªõ tr·∫°ng th√°i, m·ªói chi·ªÅu 1 rule
- [x] Stateful: nh·ªõ tr·∫°ng th√°i, ch·ªâ c·∫ßn 1 rule (c√≤n l·∫°i t·ª± ƒë·ªông)
- [x] Response lu√¥n v·ªÅ ephemeral port ‚Äì stateless ph·∫£i m·ªü r·ªông, stateful kh√¥ng c·∫ßn
- [x] AWS: NACL l√† stateless, Security Group l√† stateful

---

## PH·∫¶N 6: C√¢u h·ªèi exam/ph·ªèng v·∫•n

1. **Ph√¢n bi·ªát firewall stateful v√† stateless?**
2. **Mu·ªën cho ph√©p EC2 nh·∫≠n inbound HTTP, c·∫ßn m·∫•y rule v·ªõi NACL v√† v·ªõi Security Group?**
3. **T·∫°i sao stateless ph·∫£i allow c·∫£ d·∫£i ephemeral port khi cho response?**
4. **AWS s·ª≠ d·ª•ng lo·∫°i n√†o cho Security Group/NACL?**

---

**T√≥m l·∫°i:**  
- Stateless firewall = nhi·ªÅu rule, d·ªÖ sai, b·∫£o m·∫≠t y·∫øu  
- Stateful firewall = √≠t rule, t·ª± ƒë·ªông allow response, b·∫£o m·∫≠t t·ªët, d·ªÖ qu·∫£n l√Ω  
- Trong AWS: **NACL = stateless, Security Group = stateful**

---

**ƒê·ªçc l·∫°i tr∆∞·ªõc khi l√†m network security AWS ho·∫∑c ƒëi thi SAA!**
