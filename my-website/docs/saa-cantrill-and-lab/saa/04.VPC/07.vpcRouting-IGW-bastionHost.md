# üåê VPC Routing, Internet Gateway & Bastion Host tr√™n AWS (L√Ω thuy·∫øt n·ªÅn t·∫£ng cho thi cert & ƒëi l√†m)

---

## PH·∫¶N 1: VPC Router - B·ªô ƒë·ªãnh tuy·∫øn trong VPC

### 1. **VPC Router l√† g√¨?**
- **Thi·∫øt b·ªã ƒë·ªãnh tuy·∫øn** c√≥ s·∫µn trong m·ªçi VPC (Default & Custom), ho·∫°t ƒë·ªông ·ªü t·∫•t c·∫£ AZ trong VPC.
- **Highly available by design** ‚Äì kh√¥ng c·∫ßn lo v·ªÅ availability, AWS qu·∫£n l√Ω ho√†n to√†n.
- **C√≥ network interface ·ªü m·ªçi subnet** v·ªõi IP l√† `Network+1` (ƒë·ªãa ch·ªâ th·ª© 2 c·ªßa subnet).
- **Nhi·ªám v·ª•:** Di chuy·ªÉn traffic gi·ªØa c√°c subnet trong VPC ho·∫∑c ra ngo√†i (n·∫øu ƒë∆∞·ª£c c·∫•u h√¨nh).

### 2. **Route Table - B·∫£ng ƒë·ªãnh tuy·∫øn**
- **Route table = "b·∫£n ƒë·ªì ch·ªâ ƒë∆∞·ªùng"** cho VPC router, quy ƒë·ªãnh traffic ƒëi ƒë√¢u khi r·ªùi subnet.
- **M·ªói subnet ph·∫£i c√≥ 1 route table** (Main route table m·∫∑c ƒë·ªãnh ho·∫∑c custom).
- **1 route table c√≥ th·ªÉ g√°n cho nhi·ªÅu subnet, nh∆∞ng 1 subnet ch·ªâ c√≥ 1 route table.**

### 3. **C·∫•u tr√∫c Route trong Route Table**
```yaml
Route components:
  Destination: 10.16.0.0/16      # IP/network ƒë√≠ch
  Target: local                  # ƒêi ƒë√¢u (local/IGW/NAT/...)
  
Route matching priority:
  /32 > /24 > /16 > /8 > /0     # C√†ng c·ª• th·ªÉ c√†ng ∆∞u ti√™n
  Except: Local routes lu√¥n ∆∞u ti√™n tuy·ªát ƒë·ªëi
```

### 4. **Local Routes (Lu√¥n c√≥, kh√¥ng s·ª≠a ƒë∆∞·ª£c)**
- **T·ª± ƒë·ªông c√≥ trong m·ªçi route table**, match v·ªõi VPC CIDR.
- **IPv4**: `10.16.0.0/16 ‚Üí local`
- **IPv6**: `2600:1f14:xxx::/56 ‚Üí local` (n·∫øu VPC c√≥ IPv6)
- **√ù nghƒ©a:** Traffic trong VPC ƒë∆∞·ª£c route tr·ª±c ti·∫øp, kh√¥ng qua gateway.

---

## PH·∫¶N 2: Internet Gateway (IGW) - C·ª≠a ng√µ ra Internet

### 1. **Internet Gateway l√† g√¨?**
- **Managed gateway** k·∫øt n·ªëi VPC v·ªõi AWS Public Zone & Internet.
- **Regionally resilient** ‚Äì 1 IGW ph·ªß t·∫•t c·∫£ AZ trong region, kh√¥ng c·∫ßn 1 IGW/AZ.
- **Relationship 1:1 v·ªõi VPC** ‚Äì 1 VPC t·ªëi ƒëa 1 IGW, 1 IGW ch·ªâ attach 1 VPC.

### 2. **C√°ch IGW ho·∫°t ƒë·ªông**
```yaml
üîÑ IGW Process:
1. T·∫°o IGW ‚Üí Attach v√†o VPC
2. T·∫°o custom route table cho public subnet
3. Add default route (0.0.0.0/0) ‚Üí IGW target
4. Associate route table v·ªõi subnet c·∫ßn public
5. Enable auto-assign public IPv4 cho subnet
```

### 3. **Public Subnet vs Private Subnet**
```yaml
üìä Comparison:

Public Subnet:
  ‚úÖ C√≥ route 0.0.0.0/0 ‚Üí IGW
  ‚úÖ Auto-assign public IPv4 enabled
  ‚úÖ Resources c√≥ th·ªÉ truy c·∫≠p Internet 2-way

Private Subnet:
  ‚ùå Kh√¥ng c√≥ route ra IGW (ho·∫∑c c√≥ qua NAT)
  ‚ùå Auto-assign public IPv4 disabled
  ‚ùå Resources ch·ªâ c√≥ private IP, kh√¥ng truy c·∫≠p Internet tr·ª±c ti·∫øp
```

---

## PH·∫¶N 3: IPv4 Public Address - C√°ch th·ª©c ho·∫°t ƒë·ªông th·ª±c t·∫ø

### 1. **ƒêi·ªÅu quan tr·ªçng: Public IP kh√¥ng "ch·∫°m" v√†o EC2!**
```yaml
‚ùå Sai l·∫ßm th∆∞·ªùng g·∫∑p:
  "EC2 instance ƒë∆∞·ª£c g√°n tr·ª±c ti·∫øp public IP"

‚úÖ Th·ª±c t·∫ø:
  - EC2 ch·ªâ bi·∫øt private IP (VD: 10.16.16.20)
  - Public IP (VD: 43.250.192.20) ƒë∆∞·ª£c IGW qu·∫£n l√Ω
  - IGW gi·ªØ mapping: private IP ‚Üî public IP
```

### 2. **Flow d·ªØ li·ªáu qua IGW**
```yaml
üîÑ Outbound (EC2 ‚Üí Internet):
1. EC2 t·∫°o packet: src=10.16.16.20, dst=Linux_Update_Server
2. Packet ƒë·∫øn IGW qua default route
3. IGW thay ƒë·ªïi: src=43.250.192.20 (public IP)
4. Forward packet ra Internet

üîÑ Inbound (Internet ‚Üí EC2):
1. Server reply packet: src=Server, dst=43.250.192.20
2. IGW nh·∫≠n packet, check mapping
3. IGW thay ƒë·ªïi: dst=10.16.16.20 (private IP)  
4. Forward packet v√†o VPC ƒë·∫øn EC2
```

### 3. **IPv6 kh√°c ho√†n to√†n IPv4**
- **IPv6 addresses tr√™n AWS ƒë·ªÅu publicly routable** (kh√¥ng c√≥ private/public concept).
- **EC2 ƒë∆∞·ª£c config tr·ª±c ti·∫øp v·ªõi IPv6 address** (kh√°c IPv4).
- **IGW ch·ªâ pass-through traffic**, kh√¥ng l√†m NAT/translation.

---

## PH·∫¶N 4: Bastion Host (Jump Box) - Tr·∫°m trung gian

### 1. **Bastion Host l√† g√¨?**
- **EC2 instance ·ªü public subnet**, l√†m "c·ª≠a ng√µ" v√†o VPC private.
- **Ch·ª©c nƒÉng:** SSH v√†o bastion ‚Üí SSH ti·∫øp v√†o c√°c instance private.
- **Use case:** Qu·∫£n l√Ω VPC highly secure, kh√¥ng cho k·∫øt n·ªëi tr·ª±c ti·∫øp t·ª´ Internet.

### 2. **Ki·∫øn tr√∫c Bastion Host**
```yaml
üèóÔ∏è Architecture:
Internet ‚Üí Bastion (Public Subnet) ‚Üí Private Instances

Security:
  - Ch·ªâ m·ªü port 22 (SSH) t·ª´ IP c·ª• th·ªÉ
  - Integrate v·ªõi identity server (LDAP/AD)
  - Key-based authentication
  - Audit m·ªçi connection
```

### 3. **Bastion vs Modern Alternatives**
```yaml
üìä Comparison:

Bastion Host (Traditional):
  ‚úÖ ƒê∆°n gi·∫£n, d·ªÖ hi·ªÉu
  ‚ùå Single point of failure
  ‚ùå Ph·∫£i maintain OS, security patches
  ‚ùå Complex key management

Modern Alternatives:
  ‚úÖ AWS Systems Manager Session Manager
  ‚úÖ AWS EC2 Instance Connect
  ‚úÖ AWS SSM (kh√¥ng c·∫ßn bastion)
```

---

## PH·∫¶N 5: Checklist & ki·∫øn th·ª©c thi cert/ƒëi l√†m

### **Route Table Rules (C·ª±c hay ra ƒë·ªÅ thi)**
- [x] M·ªói subnet b·∫Øt bu·ªôc c√≥ 1 route table
- [x] Route table c√≥ th·ªÉ g√°n nhi·ªÅu subnet
- [x] Local routes lu√¥n ∆∞u ti√™n, kh√¥ng s·ª≠a ƒë∆∞·ª£c
- [x] Prefix cao h∆°n = ∆∞u ti√™n cao h∆°n (/32 > /24 > /16 > /0)

### **Internet Gateway Rules**
- [x] 1 VPC t·ªëi ƒëa 1 IGW, 1 IGW ch·ªâ attach 1 VPC
- [x] IGW l√† regionally resilient (kh√¥ng c·∫ßn 1 IGW/AZ)
- [x] Public subnet = c√≥ route 0.0.0.0/0 ‚Üí IGW + auto-assign public IP

### **IPv4 Public Addressing**
- [x] Public IP kh√¥ng config tr·ª±c ti·∫øp tr√™n EC2 OS
- [x] IGW l√†m NAT: private IP ‚Üî public IP
- [x] EC2 ch·ªâ bi·∫øt private IP, kh√¥ng bi·∫øt public IP

### **IPv6 Addressing**
- [x] IPv6 addresses ƒë·ªÅu publicly routable
- [x] EC2 ƒë∆∞·ª£c config tr·ª±c ti·∫øp v·ªõi IPv6
- [x] IGW pass-through, kh√¥ng l√†m NAT

---

## PH·∫¶N 6: C√¢u h·ªèi ph·ªèng v·∫•n/exam th∆∞·ªùng g·∫∑p

1. **"T·∫°i sao EC2 instance trong public subnet kh√¥ng truy c·∫≠p Internet ƒë∆∞·ª£c?"**
   - Check route table c√≥ default route ra IGW kh√¥ng
   - Check subnet c√≥ auto-assign public IP kh√¥ng
   - Check Security Group/NACL c√≥ block kh√¥ng

2. **"C√≥ th·ªÉ assign public IP tr·ª±c ti·∫øp v√†o EC2 OS kh√¥ng?"**
   - Kh√¥ng! IPv4 public ch·ªâ c√≥ ·ªü IGW mapping
   - IPv6 th√¨ c√≥, ƒë∆∞·ª£c assign tr·ª±c ti·∫øp

3. **"1 VPC c√≥ th·ªÉ c√≥ bao nhi√™u IGW?"**
   - T·ªëi ƒëa 1 IGW/VPC, relationship 1:1

4. **"Subnet n√†o ƒë∆∞·ª£c g·ªçi l√† public subnet?"**
   - C√≥ route 0.0.0.0/0 ‚Üí IGW + auto-assign public IP enabled

---

## PH·∫¶N 7: Demo chu·∫©n b·ªã (B√†i sau s·∫Ω th·ª±c h√†nh)

**S·∫Ω implement:**
1. ‚úÖ T·∫°o & attach IGW v√†o VPC
2. ‚úÖ T·∫°o custom route table cho web tier
3. ‚úÖ Add default routes (IPv4 & IPv6) ‚Üí IGW
4. ‚úÖ Associate route table v·ªõi web subnets
5. ‚úÖ Enable auto-assign public IP cho web subnets
6. ‚úÖ Launch bastion host & test SSH connection

**K·∫øt qu·∫£:** VPC s·∫Ω c√≥ public subnets th·∫≠t s·ª±, k·∫øt n·ªëi Internet 2-way, ready cho production!

---

**ƒê·ªçc l·∫°i b√†i n√†y tr∆∞·ªõc m·ªói l·∫ßn thi·∫øt k·∫ø network architecture ho·∫∑c chu·∫©n b·ªã ƒëi thi AWS Solutions Architect!**
