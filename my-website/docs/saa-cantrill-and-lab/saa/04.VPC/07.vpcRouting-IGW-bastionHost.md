## ğŸŒ VPC Routing, Internet Gateway & Bastion Host trÃªn AWS (LÃ½ thuyáº¿t ná»n táº£ng cho thi cert & Ä‘i lÃ m)

---

## PHáº¦N 1: VPC Router - Bá»™ Ä‘á»‹nh tuyáº¿n trong VPC

### 1. **VPC Router lÃ  gÃ¬?**
- **Thiáº¿t bá»‹ Ä‘á»‹nh tuyáº¿n** cÃ³ sáºµn trong má»i VPC (Default & Custom), hoáº¡t Ä‘á»™ng á»Ÿ táº¥t cáº£ AZ trong VPC.
- **Highly available by design** â€“ khÃ´ng cáº§n lo vá» availability, AWS quáº£n lÃ½ hoÃ n toÃ n.
- **CÃ³ network interface á»Ÿ má»i subnet** vá»›i IP lÃ  `Network+1` (Ä‘á»‹a chá»‰ thá»© 2 cá»§a subnet).
- **Nhiá»‡m vá»¥:** Di chuyá»ƒn traffic giá»¯a cÃ¡c subnet trong VPC hoáº·c ra ngoÃ i (náº¿u Ä‘Æ°á»£c cáº¥u hÃ¬nh).

### 2. **Route Table - Báº£ng Ä‘á»‹nh tuyáº¿n**
- **Route table = "báº£n Ä‘á»“ chá»‰ Ä‘Æ°á»ng"** cho VPC router, quy Ä‘á»‹nh traffic Ä‘i Ä‘Ã¢u khi rá»i subnet.
- **Má»—i subnet pháº£i cÃ³ 1 route table** (Main route table máº·c Ä‘á»‹nh hoáº·c custom).
- **1 route table cÃ³ thá»ƒ gÃ¡n cho nhiá»u subnet, nhÆ°ng 1 subnet chá»‰ cÃ³ 1 route table.**

### 3. **Cáº¥u trÃºc Route trong Route Table**
```yaml
Route components:
  Destination: 10.16.0.0/16      # IP/network Ä‘Ã­ch
  Target: local                  # Äi Ä‘Ã¢u (local/IGW/NAT/...)
  
Route matching priority:
  /32 > /24 > /16 > /8 > /0     # CÃ ng cá»¥ thá»ƒ cÃ ng Æ°u tiÃªn
  Except: Local routes luÃ´n Æ°u tiÃªn tuyá»‡t Ä‘á»‘i
```

### 4. **Local Routes (LuÃ´n cÃ³, khÃ´ng sá»­a Ä‘Æ°á»£c)**
- **Tá»± Ä‘á»™ng cÃ³ trong má»i route table**, match vá»›i VPC CIDR.
- **IPv4**: `10.16.0.0/16 â†’ local`
- **IPv6**: `2600:1f14:xxx::/56 â†’ local` (náº¿u VPC cÃ³ IPv6)
- **Ã nghÄ©a:** Traffic trong VPC Ä‘Æ°á»£c route trá»±c tiáº¿p, khÃ´ng qua gateway.

---

## PHáº¦N 2: Internet Gateway (IGW) - Cá»­a ngÃµ ra Internet

### 1. **Internet Gateway lÃ  gÃ¬?**
- **Managed gateway** káº¿t ná»‘i VPC vá»›i AWS Public Zone & Internet.
- **Regionally resilient** â€“ 1 IGW phá»§ táº¥t cáº£ AZ trong region, khÃ´ng cáº§n 1 IGW/AZ.
- **Relationship 1:1 vá»›i VPC** â€“ 1 VPC tá»‘i Ä‘a 1 IGW, 1 IGW chá»‰ attach 1 VPC.

### 2. **CÃ¡ch IGW hoáº¡t Ä‘á»™ng**
<img width="870" height="405" alt="image" src="https://github.com/user-attachments/assets/87f0cfbf-6e7b-4b7e-87de-0775cf5f50fe" />

```yaml
ğŸ”„ IGW Process:
1. Táº¡o IGW â†’ Attach vÃ o VPC
2. Táº¡o custom route table cho public subnet
3. Add default route (0.0.0.0/0) â†’ IGW target
4. Associate route table vá»›i subnet cáº§n public
5. Enable auto-assign public IPv4 cho subnet
```

### 3. **Public Subnet vs Private Subnet**
```yaml
ğŸ“Š Comparison:

Public Subnet:
  âœ… CÃ³ route 0.0.0.0/0 â†’ IGW
  âœ… Auto-assign public IPv4 enabled
  âœ… Resources cÃ³ thá»ƒ truy cáº­p Internet 2-way

Private Subnet:
  âŒ KhÃ´ng cÃ³ route ra IGW (hoáº·c cÃ³ qua NAT)
  âŒ Auto-assign public IPv4 disabled
  âŒ Resources chá»‰ cÃ³ private IP, khÃ´ng truy cáº­p Internet trá»±c tiáº¿p
```

---

## PHáº¦N 3: IPv4 Public Address - CÃ¡ch thá»©c hoáº¡t Ä‘á»™ng thá»±c táº¿

### 1. **Äiá»u quan trá»ng: Public IP khÃ´ng "cháº¡m" vÃ o EC2!**

```yaml
âŒ Sai láº§m thÆ°á»ng gáº·p:
  "EC2 instance Ä‘Æ°á»£c gÃ¡n trá»±c tiáº¿p public IP"

âœ… Thá»±c táº¿:
  - EC2 chá»‰ biáº¿t private IP (VD: 10.16.16.20)
  - Public IP (VD: 43.250.192.20) Ä‘Æ°á»£c IGW quáº£n lÃ½
  - IGW giá»¯ mapping: private IP â†” public IP
```

### 2. **Flow dá»¯ liá»‡u qua IGW**
<img width="855" height="496" alt="image" src="https://github.com/user-attachments/assets/570a0865-f18c-4f53-951e-a0f8797e8d71" />
<img width="856" height="493" alt="image" src="https://github.com/user-attachments/assets/ece95db0-b2ed-4624-8503-b478610c1ad2" />

```yaml
ğŸ”„ Outbound (EC2 â†’ Internet):
1. EC2 táº¡o packet: src=10.16.16.20, dst=Linux_Update_Server
2. Packet Ä‘áº¿n IGW qua default route
3. IGW thay Ä‘á»•i: src=43.250.192.20 (public IP)
4. Forward packet ra Internet

ğŸ”„ Inbound (Internet â†’ EC2):
1. Server reply packet: src=Server, dst=43.250.192.20
2. IGW nháº­n packet, check mapping
3. IGW thay Ä‘á»•i: dst=10.16.16.20 (private IP)  
4. Forward packet vÃ o VPC Ä‘áº¿n EC2
```

### 3. **IPv6 khÃ¡c hoÃ n toÃ n IPv4**
- **IPv6 addresses trÃªn AWS Ä‘á»u publicly routable** (khÃ´ng cÃ³ private/public concept).
- **EC2 Ä‘Æ°á»£c config trá»±c tiáº¿p vá»›i IPv6 address** (khÃ¡c IPv4).
- **IGW chá»‰ pass-through traffic**, khÃ´ng lÃ m NAT/translation.

---

## PHáº¦N 4: Bastion Host (Jump Box) - Tráº¡m trung gian

### 1. **Bastion Host lÃ  gÃ¬?**
- **EC2 instance á»Ÿ public subnet**, lÃ m "cá»­a ngÃµ" vÃ o VPC private.
- **Chá»©c nÄƒng:** SSH vÃ o bastion â†’ SSH tiáº¿p vÃ o cÃ¡c instance private.
- **Use case:** Quáº£n lÃ½ VPC highly secure, khÃ´ng cho káº¿t ná»‘i trá»±c tiáº¿p tá»« Internet.

### 2. **Kiáº¿n trÃºc Bastion Host**
```yaml
ğŸ—ï¸ Architecture:
Internet â†’ Bastion (Public Subnet) â†’ Private Instances

Security:
  - Chá»‰ má»Ÿ port 22 (SSH) tá»« IP cá»¥ thá»ƒ
  - Integrate vá»›i identity server (LDAP/AD)
  - Key-based authentication
  - Audit má»i connection
```

### 3. **Bastion vs Modern Alternatives**
```yaml
ğŸ“Š Comparison:

Bastion Host (Traditional):
  âœ… ÄÆ¡n giáº£n, dá»… hiá»ƒu
  âŒ Single point of failure
  âŒ Pháº£i maintain OS, security patches
  âŒ Complex key management

Modern Alternatives:
  âœ… AWS Systems Manager Session Manager
  âœ… AWS EC2 Instance Connect
  âœ… AWS SSM (khÃ´ng cáº§n bastion)
```

---

## PHáº¦N 5: Checklist & kiáº¿n thá»©c thi cert/Ä‘i lÃ m

### **Route Table Rules (Cá»±c hay ra Ä‘á» thi)**
- [x] Má»—i subnet báº¯t buá»™c cÃ³ 1 route table
- [x] Route table cÃ³ thá»ƒ gÃ¡n nhiá»u subnet
- [x] Local routes luÃ´n Æ°u tiÃªn, khÃ´ng sá»­a Ä‘Æ°á»£c
- [x] Prefix cao hÆ¡n = Æ°u tiÃªn cao hÆ¡n (/32 > /24 > /16 > /0)

### **Internet Gateway Rules**
- [x] 1 VPC tá»‘i Ä‘a 1 IGW, 1 IGW chá»‰ attach 1 VPC
- [x] IGW lÃ  regionally resilient (khÃ´ng cáº§n 1 IGW/AZ)
- [x] Public subnet = cÃ³ route 0.0.0.0/0 â†’ IGW + auto-assign public IP

### **IPv4 Public Addressing**
- [x] Public IP khÃ´ng config trá»±c tiáº¿p trÃªn EC2 OS
- [x] IGW lÃ m NAT: private IP â†” public IP
- [x] EC2 chá»‰ biáº¿t private IP, khÃ´ng biáº¿t public IP

### **IPv6 Addressing**
- [x] IPv6 addresses Ä‘á»u publicly routable
- [x] EC2 Ä‘Æ°á»£c config trá»±c tiáº¿p vá»›i IPv6
- [x] IGW pass-through, khÃ´ng lÃ m NAT

---

## PHáº¦N 6: CÃ¢u há»i phá»ng váº¥n/exam thÆ°á»ng gáº·p

1. **"Táº¡i sao EC2 instance trong public subnet khÃ´ng truy cáº­p Internet Ä‘Æ°á»£c?"**
   - Check route table cÃ³ default route ra IGW khÃ´ng
   - Check subnet cÃ³ auto-assign public IP khÃ´ng
   - Check Security Group/NACL cÃ³ block khÃ´ng

2. **"CÃ³ thá»ƒ assign public IP trá»±c tiáº¿p vÃ o EC2 OS khÃ´ng?"**
   - KhÃ´ng! IPv4 public chá»‰ cÃ³ á»Ÿ IGW mapping
   - IPv6 thÃ¬ cÃ³, Ä‘Æ°á»£c assign trá»±c tiáº¿p

3. **"1 VPC cÃ³ thá»ƒ cÃ³ bao nhiÃªu IGW?"**
   - Tá»‘i Ä‘a 1 IGW/VPC, relationship 1:1

4. **"Subnet nÃ o Ä‘Æ°á»£c gá»i lÃ  public subnet?"**
   - CÃ³ route 0.0.0.0/0 â†’ IGW + auto-assign public IP enabled

---

## PHáº¦N 7: Demo chuáº©n bá»‹ (BÃ i sau sáº½ thá»±c hÃ nh)

**Sáº½ implement:**
1. âœ… Táº¡o & attach IGW vÃ o VPC
2. âœ… Táº¡o custom route table cho web tier
3. âœ… Add default routes (IPv4 & IPv6) â†’ IGW
4. âœ… Associate route table vá»›i web subnets
5. âœ… Enable auto-assign public IP cho web subnets
6. âœ… Launch bastion host & test SSH connection

**Káº¿t quáº£:** VPC sáº½ cÃ³ public subnets tháº­t sá»±, káº¿t ná»‘i Internet 2-way, ready cho production!

---

**Äá»c láº¡i bÃ i nÃ y trÆ°á»›c má»—i láº§n thiáº¿t káº¿ network architecture hoáº·c chuáº©n bá»‹ Ä‘i thi AWS Solutions Architect!**
