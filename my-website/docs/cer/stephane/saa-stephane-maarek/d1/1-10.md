# 1.**Amazon S3 Lifecycle** â€“ cÃ¡ch mÃ  báº¡n tá»± Ä‘á»™ng **xÃ³a hoáº·c lÆ°u trá»¯ dá»¯ liá»‡u cÅ©** trong S3 bucket. MÃ¬nh sáº½ **giáº£i thÃ­ch tá»«ng pháº§n** má»™t cÃ¡ch dá»… hiá»ƒu nháº¥t:

---

### ğŸ”¸ Báº£n gá»‘c:

> **If you have an object expiration lifecycle configuration in your unversioned bucket**
>
> and **you want to maintain the same permanent delete behavior** when you enable versioning,
>
> you must add a **noncurrent expiration configuration** .

#### âœ… NghÄ©a:

> Náº¿u báº¡n Ä‘ang dÃ¹ng cáº¥u hÃ¬nh **tá»± Ä‘á»™ng xÃ³a Ä‘á»‘i tÆ°á»£ng (object expiration)** trong má»™t bucket **khÃ´ng báº­t versioning** ,
>
> vÃ  báº¡n muá»‘n giá»¯ nguyÃªn hÃ nh vi "xÃ³a vÄ©nh viá»…n" Ä‘Ã³ khi báº¡n **báº­t versioning lÃªn** ,
>
> thÃ¬ báº¡n **pháº£i thÃªm má»™t cáº¥u hÃ¬nh `noncurrent expiration`** .

---

### ğŸ”¸ Báº£n gá»‘c:

> The **noncurrent expiration lifecycle configuration** manages the **deletes of the noncurrent object versions**
>
> in the versioning-enabled bucket.

#### âœ… NghÄ©a:

> Cáº¥u hÃ¬nh `noncurrent expiration` dÃ¹ng Ä‘á»ƒ **tá»± Ä‘á»™ng xÃ³a cÃ¡c phiÃªn báº£n cÅ© (noncurrent versions)**
>
> trong bucket Ä‘Ã£ báº­t versioning.

---

### ğŸ”¸ Báº£n gá»‘c:

> (A versioning-enabled bucket maintains one current, and zero or more noncurrent, object versions.)

#### âœ… NghÄ©a:

> Má»™t bucket báº­t versioning sáº½ lÆ°u:
>
> - 1 phiÃªn báº£n hiá»‡n táº¡i ( **current** )
> - vÃ  0 hoáº·c nhiá»u phiÃªn báº£n cÅ© ( **noncurrent** )

---

### ğŸ“Œ TÃ³m táº¯t dá»… hiá»ƒu:

| TrÆ°á»›c khi báº­t versioning                     | Sau khi báº­t versioning                                   |
| -------------------------------------------- | -------------------------------------------------------- |
| Báº¡n dÃ¹ng `expiration`Ä‘á»ƒ xÃ³a object vÄ©nh viá»…n | S3 khÃ´ng cÃ²n xÃ³a vÄ©nh viá»…n khi object bá»‹ ghi Ä‘Ã¨ hoáº·c xÃ³a |
| â†’ Object biáº¿n máº¥t hoÃ n toÃ n                  | â†’ Object cÅ© trá»Ÿ thÃ nh**noncurrent version**              |
| KhÃ´ng cáº§n thÃªm gÃ¬                            | **Pháº£i thÃªm `noncurrent expiration`**Ä‘á»ƒ dá»n rÃ¡c          |

---

### ğŸ” VÃ­ dá»¥:

Báº¡n cÃ³ file `report.pdf` trong bucket:

- âœ… Khi bucket **chÆ°a báº­t versioning** :
  - Báº¡n cáº¥u hÃ¬nh: "xÃ³a sau 30 ngÃ y"
  - â†’ 30 ngÃ y sau, file `report.pdf` bá»‹ xÃ³a vÄ©nh viá»…n.
- âŒ Sau khi **báº­t versioning** :
  - Khi báº¡n cáº­p nháº­t `report.pdf`, thÃ¬:
    - báº£n cÅ© trá»Ÿ thÃ nh **noncurrent version**
    - báº£n má»›i lÃ  **current version**
  - Náº¿u báº¡n chá»‰ cÃ³ `expiration`, thÃ¬ **chá»‰ báº£n hiá»‡n táº¡i má»›i bá»‹ xÃ³a** , cÃ²n báº£n cÅ© váº«n cÃ²n.
  - ğŸ‘‰ Báº¡n cáº§n **thÃªm `noncurrent expiration`** Ä‘á»ƒ xÃ³a cáº£ báº£n cÅ© sau x ngÃ y.

# 2.Má»™t trÆ°á»ng Ä‘áº¡i há»c Ivy League Ä‘ang há»— trá»£ NASA xÃ¡c Ä‘á»‹nh cÃ¡c Ä‘á»‹a Ä‘iá»ƒm háº¡ cÃ¡nh tiá»m nÄƒng cho tÃ u thÄƒm dÃ² khÃ´ng ngÆ°á»i lÃ¡i. Há» sá»­ dá»¥ng kiáº¿n trÃºc á»©ng dá»¥ng dá»±a trÃªn **HPC** . Há»i á»©ng dá»¥ng nÃ y nÃªn triá»ƒn khai EC2 theo kiá»ƒu topology nÃ o?

---

## âœ… ÄÃ¡p Ã¡n Ä‘Ãºng:

**The Amazon EC2 instances should be deployed in a _cluster placement group_ so that the underlying workload can benefit from low network latency and high network throughput.**

---

## ğŸ” Giáº£i thÃ­ch chi tiáº¿t:

### 1. ğŸ”¬ **Hiá»ƒu yÃªu cáº§u cá»§a bÃ i toÃ¡n HPC:**

- **High Performance Computing (HPC)** lÃ  cÃ¡c á»©ng dá»¥ng tÃ­nh toÃ¡n hiá»‡u nÄƒng cao, thÆ°á»ng xá»­ lÃ½ khá»‘i lÆ°á»£ng lá»›n dá»¯ liá»‡u vÃ  yÃªu cáº§u:
  - **Truyá»n dá»¯ liá»‡u nhanh giá»¯a cÃ¡c node**
  - **Äá»™ trá»… tháº¥p**
  - **BÄƒng thÃ´ng máº¡ng cao**
  - **Giao tiáº¿p node-to-node thÆ°á»ng xuyÃªn**
- VÃ­ dá»¥ trong cÃ¢u há»i lÃ  má»™t bÃ i toÃ¡n **khoa há»c khÃ´ng gian** , sá»­ dá»¥ng tÃ­nh toÃ¡n máº¡nh Ä‘á»ƒ phÃ¢n tÃ­ch dá»¯ liá»‡u vÃ  mÃ´ phá»ng, ráº¥t Ä‘iá»ƒn hÃ¬nh cho workload HPC.

---

### 2. ğŸ§  **Cluster Placement Group phÃ¹ há»£p nháº¥t cho HPC vÃ¬:**

- **Cluster Placement Group** Ä‘áº·t táº¥t cáº£ cÃ¡c instance trong má»™t nhÃ³m **gáº§n nhau vá» váº­t lÃ½** bÃªn trong **má»™t Availability Zone (AZ)** .
- Äiá»u nÃ y cho phÃ©p:
  - **Äá»™ trá»… máº¡ng tháº¥p**
  - **Tá»‘c Ä‘á»™ truyá»n dá»¯ liá»‡u giá»¯a cÃ¡c EC2 cao**
  - PhÃ¹ há»£p vá»›i á»©ng dá»¥ng **tightly-coupled** , nÆ¡i cÃ¡c mÃ¡y pháº£i thÆ°á»ng xuyÃªn trao Ä‘á»•i dá»¯ liá»‡u.

> ğŸ“Œ **HPC workloads luÃ´n Ä‘Æ°á»£c khuyáº¿n nghá»‹ triá»ƒn khai trong Cluster Placement Group** theo tÃ i liá»‡u chÃ­nh thá»©c cá»§a AWS.

---

## âŒ Giáº£i thÃ­ch cÃ¡c lá»±a chá»n sai:

### 3. ğŸš« **Partition Placement Group** :

- DÃ¹ng Ä‘á»ƒ tÃ¡ch nhÃ³m EC2 theo **partition logic riÃªng biá»‡t** , má»—i partition khÃ´ng dÃ¹ng chung pháº§n cá»©ng.
  partition cÃ³ thá»ƒ á»Ÿ cÃ¡c az khÃ¡c nhau,**Tá»‘i Ä‘a** : 7 partition má»—i AZ.
- Tá»‘t cho há»‡ thá»‘ng phÃ¢n tÃ¡n lá»›n nhÆ° **Hadoop, Cassandra, Kafka** .
- **KhÃ´ng táº­p trung cÃ¡c mÃ¡y gáº§n nhau** â†’ **khÃ´ng Ä‘áº£m báº£o Ä‘á»™ trá»… tháº¥p** â†’ **KhÃ´ng phÃ¹ há»£p cho HPC** .

---

### 4. ğŸš« **Spread Placement Group** :

- Má»—i EC2 Ä‘Æ°á»£c Ä‘áº·t trÃªn **racks khÃ¡c nhau** , **cÃ¡ch ly váº­t lÃ½** â†’ giáº£m nguy cÆ¡ **cÃ¡c lá»—i Ä‘á»“ng thá»i** (correlated failures).
  , SPG cÃ³ thá»ƒ á»Ÿ cÃ¡c az khÃ¡c nhau,You can have a maximum of seven running instances per Availability Zone per group. (nghÄ©a lÃ  7 instance trong 1 group á»Ÿ 1 az )
- PhÃ¹ há»£p cho workload **yÃªu cáº§u Ä‘á»™ sáºµn sÃ ng cao (HA)** , nhÆ°ng khÃ´ng yÃªu cáº§u truyá»n dá»¯ liá»‡u nhanh giá»¯a mÃ¡y.
- **KhÃ´ng tá»‘i Æ°u máº¡ng giá»¯a cÃ¡c mÃ¡y** â†’ **KhÃ´ng phÃ¹ há»£p HPC**

---

### 5. ğŸš« **Auto Scaling Group** :

- DÃ¹ng Ä‘á»ƒ tá»± Ä‘á»™ng **tÄƒng/giáº£m sá»‘ lÆ°á»£ng EC2** theo táº£i.
- Tá»‘t cho cÃ¡c á»©ng dá»¥ng **web / backend / microservices** , nÆ¡i cáº§n **má»Ÿ rá»™ng linh hoáº¡t** .
- NhÆ°ng HPC thÆ°á»ng **cá»‘ Ä‘á»‹nh sá»‘ lÆ°á»£ng node** , vÃ  yÃªu cáº§u **hiá»‡u nÄƒng máº¡ng cao** chá»© khÃ´ng pháº£i chá»‰ co giÃ£n â†’ **KhÃ´ng phÃ¹ há»£p HPC**

## ğŸ§© **1. Partition Placement Group (PPG)**

### âœ… Sá»± tháº­t:

- **Tá»‘i Ä‘a 7 partition / AZ** .
- **Má»—i partition** cÃ³ thá»ƒ chá»©a **nhiá»u EC2 instance** (khÃ´ng giá»›i háº¡n cá»¥ thá»ƒ).
- CÃ¡c EC2 trong **cÃ¹ng má»™t partition** cÃ³ thá»ƒ **dÃ¹ng chung pháº§n cá»©ng** .
- **CÃ¡c partition khÃ¡c nhau** thÃ¬ **khÃ´ng dÃ¹ng chung pháº§n cá»©ng** â†’ tÃ¡ch biá»‡t Ä‘á»ƒ trÃ¡nh "correlated failure".

### ğŸ“Œ TÃ³m láº¡i:

| ThÃ´ng sá»‘           | GiÃ¡ trá»‹                                 |
| ------------------ | --------------------------------------- |
| Sá»‘ partition / AZ  | Tá»‘i Ä‘a 7                                |
| Sá»‘ EC2 / partition | Gáº§n nhÆ°**khÃ´ng giá»›i háº¡n**               |
| Sá»‘ EC2 / AZ        | TÃ¹y sá»‘ EC2 báº¡n Ä‘áº·t trong tá»«ng partition |
| AZ khÃ¡c nhau?      | âœ… CÃ³ thá»ƒ triá»ƒn khai trÃªn nhiá»u AZ      |

---

## ğŸ§© **2. Spread Placement Group (SPG)**

### âœ… Sá»± tháº­t:

- **Má»—i EC2 instance** Ä‘Æ°á»£c Ä‘áº·t trÃªn **1 rack riÃªng biá»‡t** .
- **Tá»‘i Ä‘a 7 EC2 / AZ / má»—i Spread Placement Group** (trá»« khi xin tÄƒng quota).
- **Má»™t SPG cÃ³ thá»ƒ tráº£i rá»™ng nhiá»u AZ** , vÃ  má»—i AZ Ä‘Æ°á»£c **tá»‘i Ä‘a 7 EC2** .
- **Tá»•ng cá»™ng má»—i SPG cÃ³ thá»ƒ cÃ³: sá»‘ AZ Ã— 7 EC2 instance** (máº·c Ä‘á»‹nh).

### ğŸ“Œ TÃ³m láº¡i:

| ThÃ´ng sá»‘                            | GiÃ¡ trá»‹                               |
| ----------------------------------- | ------------------------------------- |
| Sá»‘ EC2 / AZ / SPG                   | **Tá»‘i Ä‘a 7**(má»—i cÃ¡i trÃªn rack riÃªng) |
| Tá»•ng EC2 / SPG                      | AZ Ã— 7                                |
| EC2 dÃ¹ng chung rack?                | âŒ KhÃ´ng                              |
| Triá»ƒn khai Ä‘a AZ?                   | âœ… CÃ³ thá»ƒ                             |
| Báº¡n cÃ³ thá»ƒ táº¡o bao nhiÃªu SPG tÃ¹y Ã½. |                                       |

---

### ğŸ§  **So sÃ¡nh : Cluster vs Partition vs Spread Placement Group**

| **TiÃªu chÃ­**                                    | **Cluster Placement Group**                                                                         | **Partition Placement Group**                                                                      | **Spread Placement Group**                                                                                  |
| ----------------------------------------------- | --------------------------------------------------------------------------------------------------- | -------------------------------------------------------------------------------------------------- | ----------------------------------------------------------------------------------------------------------- |
| ğŸ’¡**KhÃ¡i niá»‡m cá»‘t lÃµi**                         | NhÃ³m cÃ¡c EC2 gáº§n nhau vá» váº­t lÃ½ Ä‘á»ƒ Ä‘áº¡t**hiá»‡u suáº¥t máº¡ng tá»‘i Ä‘a**                                     | NhÃ³m EC2 thÃ nh**cÃ¡c partition Ä‘á»™c láº­p pháº§n cá»©ngÂ **nháº±m**giáº£m rá»§i ro lan truyá»n lá»—i pháº§n cá»©ng**     | Má»—i EC2 náº±m**trÃªn má»™t rack riÃªng biá»‡t** , tá»‘i Ä‘a hÃ³a kháº£ nÄƒngÂ **cÃ¡ch ly lá»—i pháº§n cá»©ng**                     |
| ğŸ“Œ**MÃ´ hÃ¬nh triá»ƒn khai pháº§n cá»©ng**              | CÃ¡c EC2 náº±m**ráº¥t gáº§n nhau**(cÃ³ thá»ƒ cÃ¹ng rack hoáº·c lÃ¢n cáº­n trong AZ)                                 | Má»—i partition dÃ¹ng pháº§n cá»©ng riÃªng; cÃ¡c partition**khÃ´ng chia sáº» thiáº¿t bá»‹**                        | Má»—i EC2 náº±m trÃªn**má»™t rack khÃ¡c nhau**â†’ má»—i rack cÃ³ nguá»“n Ä‘iá»‡n, máº¡ng riÃªng biá»‡t                             |
| âš™ï¸**Kiáº¿n trÃºc phÃ¹ há»£p**                         | **Tightly-coupled systems**â€“ há»‡ thá»‘ng cáº§n truyá»n thÃ´ng liÃªn tá»¥c, tá»‘c Ä‘á»™ cao (HPC, AI, ML, MPI, CFD) | **Distributed systems**â€“ há»‡ thá»‘ng phÃ¢n tÃ¡n, cáº§n song song hÃ³a, vÃ­ dá»¥ Hadoop, Cassandra, Kafka      | **Critical systems**â€“ há»‡ thá»‘ng lÃµi khÃ´ng Ä‘Æ°á»£c phÃ©p cÃ¹ng há»ng, nhÆ° DB, quorum-based clusters, control planes |
| ğŸ”Œ**Hiá»‡u suáº¥t máº¡ng**                            | âœ…**Cao nháº¥t**â€“ bandwidth lá»›n, latency tháº¥p                                                         | âŒ KhÃ´ng Ä‘áº£m báº£o cao vÃ¬ cÃ³ thá»ƒ tráº£i qua nhiá»u AZ                                                   | âŒ KhÃ´ng Ä‘áº£m báº£o cao, vÃ¬ cÃ¡c EC2 phÃ¢n tÃ¡n váº­t lÃ½                                                            |
| ğŸ”’**TÃ¡ch biá»‡t lá»—i pháº§n cá»©ng (fault isolation)** | âŒ KhÃ´ng (cÃ¡c EC2 cÃ³ thá»ƒ cÃ¹ng rack)                                                                 | âœ… Theo nhÃ³m (partition cÃ¡ch ly nhau, nhÆ°ng cÃ¹ng partition váº«n cÃ³ thá»ƒ bá»‹ lá»—i chung)                | âœ… Tá»‘i Ä‘a â€“ má»—i EC2 náº±m rack khÃ¡c, gáº§n nhÆ° lá»—i pháº§n cá»©ng khÃ´ng bao giá» áº£nh hÆ°á»Ÿng Ä‘á»“ng thá»i 2 instance       |
| ğŸ§±**Kháº£ nÄƒng chá»‹u lá»—i (resilience)**            | Tháº¥p â€“ náº¿u rack lá»—i cÃ³ thá»ƒ áº£nh hÆ°á»Ÿng cáº£ nhÃ³m                                                        | Trung bÃ¬nh â€“ lá»—i chá»‰ áº£nh hÆ°á»Ÿng 1 partition                                                         | Cao â€“ lá»—i chá»‰ áº£nh hÆ°á»Ÿng 1 EC2, cÃ¡c EC2 cÃ²n láº¡i váº«n hoáº¡t Ä‘á»™ng                                                |
| ğŸ“š**Kháº£ nÄƒng má»Ÿ rá»™ng (scalability)**            | Háº¡n cháº¿ â€“ cÃ ng nhiá»u EC2 cÃ ng khÃ³ giá»¯ gáº§n nhau                                                      | Ráº¥t tá»‘t â€“ cÃ³ thá»ƒ má»Ÿ rá»™ng dá»… dÃ ng báº±ng thÃªm partition hoáº·c AZ khÃ¡c                                  | KÃ©m â€“ bá»‹ giá»›i háº¡n 7 EC2 / AZ / SPG máº·c Ä‘á»‹nh                                                                 |
| ğŸ”**Auto Scaling phÃ¹ há»£p khÃ´ng?**               | KhÃ´ng phÃ¹ há»£p láº¯m vÃ¬ phá»¥ thuá»™c vÃ o kháº£ nÄƒng gÃ³i cá»¥m                                                 | âœ… PhÃ¹ há»£p vá»›i workload phÃ¢n tÃ¡n má»Ÿ rá»™ng tá»± nhiÃªn                                                  | âŒ KhÃ´ng khuyáº¿n khÃ­ch â€“ dá»… vÆ°á»£t giá»›i háº¡n instance                                                           |
| ğŸŒ**Multi-AZ há»— trá»£?**                          | âŒ KhÃ´ng â€“ chá»‰ Ä‘Æ°á»£c trong**1 AZ duy nháº¥t**                                                          | âœ… CÃ³ thá»ƒ tráº£i rá»™ng**nhiá»u AZ**                                                                    | âœ… CÃ³ thá»ƒ tráº£i rá»™ng**nhiá»u AZ**                                                                             |
| ğŸ§®**Sá»‘ lÆ°á»£ng pháº§n tá»­ / giá»›i háº¡n máº·c Ä‘á»‹nh**      | KhÃ´ng giá»›i háº¡n cá»¥ thá»ƒ, nhÆ°ng khÃ³ Ä‘áº¡t hiá»‡u quáº£ khi nhiá»u EC2                                         | Tá»‘i Ä‘a 7 partition / AZ, má»—i partition chá»©a**nhiá»u EC2**                                           | Tá»‘i Ä‘a 7 EC2 / AZ / SPG (máº·c Ä‘á»‹nh)                                                                          |
| ğŸ§­**CÃ¡ch Ä‘iá»u phá»‘i pháº§n cá»©ng cá»§a AWS**          | GÃ¡n EC2 vÃ o vÃ¹ng pháº§n cá»©ng cá»±c gáº§n (low-latency fabric)                                             | Má»—i partition Ä‘Æ°á»£c Ä‘áº·t trÃªn cá»¥m pháº§n cá»©ng riÃªng, khÃ´ng dÃ¹ng chung network/power vá»›i partition khÃ¡c | Má»—i EC2 Ã©p buá»™c vÃ o rack váº­t lÃ½ riÃªng â€“ má»—i rack cÃ³ power/network riÃªng                                     |

Giá»›i háº¡n máº·c Ä‘á»‹nh trÃªn má»—i Region 100 cho cáº£ 3 loáº¡i

### ğŸ§ª **Khi nÃ o dÃ¹ng loáº¡i nÃ o?**

| TÃ¬nh huá»‘ng                                                                         | Loáº¡i nÃªn dÃ¹ng       |
| ---------------------------------------------------------------------------------- | ------------------- |
| Cáº§n tÃ­nh toÃ¡n hiá»‡u nÄƒng cao (AI/ML/HPC) â€“ giao tiáº¿p nhanh giá»¯a EC2                 | Cluster Placement   |
| Xá»­ lÃ½ Big Data phÃ¢n tÃ¡n, nhiá»u node, tÃ­nh song song cao (Kafka, Hadoop, Cassandra) | Partition Placement |
| Há»‡ thá»‘ng quan trá»ng, khÃ´ng Ä‘Æ°á»£c lá»—i cÃ¹ng lÃºc (DB, master node, quorum, etcd...)    | Spread Placement    |

# 3.**Cost of test file storage on**

Amazon S3 Standard < Cost of test file storage on Amazon EFS < Cost of test file storage on Amazon EBS\*\*

With Amazon EBS Elastic Volumes, you pay only for the resources that you use. The Amazon EFS Standard Storage pricing is $0.30 per GB per month. Therefore the cost for storing the test file on EFS is $0.30 for the month.

For Amazon EBS General Purpose SSD (gp2) volumes, the charges are $0.10 per GB-month of provisioned storage. Therefore, for a provisioned storage of 100GB for this use-case, the monthly cost on EBS is $0.10\*100 = $10. This cost is irrespective of how much storage is actually consumed by the test file.

For S3 Standard storage, the pricing is $0.023 per GB per month. Therefore, the monthly storage cost on S3 for the test file is $0.023.

# 4.**Ká»‹ch báº£n:** CÃ´ng ty bÃ¡n láº» cÃ³ trang web Ä‘á»™ng cháº¡y trÃªn mÃ¡y chá»§ táº¡i trung tÃ¢m dá»¯ liá»‡u á»Ÿ Má»¹. Sáº¯p ra máº¯t á»Ÿ ChÃ¢u Ã, cáº§n **giáº£m Ä‘á»™ trá»…** cho ngÆ°á»i dÃ¹ng táº¡i Ä‘Ã¢y **ngay láº­p tá»©c** , trong khi **backend (mÃ¡y chá»§ xá»­ lÃ½ logic) VáºªN PHáº¢I á»Ÿ Má»¹** .

**Giáº£i phÃ¡p phÃ¹ há»£p nháº¥t:** **Sá»­ dá»¥ng Amazon CloudFront vá»›i Custom Origin trá» Ä‘áº¿n mÃ¡y chá»§ On-Premises cá»§a báº¡n.**

- **Giáº£i thÃ­ch:**
  - **Amazon CloudFront** lÃ  dá»‹ch vá»¥ Máº¡ng phÃ¢n phá»‘i ná»™i dung (CDN) toÃ n cáº§u cá»§a AWS. NÃ³ cÃ³ máº¡ng lÆ°á»›i cÃ¡c Ä‘iá»ƒm biÃªn (edge locations) vÃ  bá»™ nhá»› Ä‘á»‡m khu vá»±c (regional edge caches) Ä‘áº·t ráº£i rÃ¡c kháº¯p tháº¿ giá»›i (gáº§n ngÆ°á»i dÃ¹ng cuá»‘i).
  - **Custom Origin:** CloudFront cÃ³ thá»ƒ láº¥y ná»™i dung gá»‘c tá»« nhiá»u nguá»“n (origin). NgoÃ i S3 hoáº·c EC2, nÃ³ cÃ³ thá»ƒ láº¥y ná»™i dung tá»« báº¥t ká»³ mÃ¡y chá»§ HTTP nÃ o cÃ³ thá»ƒ truy cáº­p Ä‘Æ°á»£c qua Internet, bao gá»“m cáº£ mÃ¡y chá»§ On-Premises cá»§a báº¡n. MÃ¡y chá»§ On-Premises trong trÆ°á»ng há»£p nÃ y chÃ­nh lÃ  "Custom Origin" cá»§a CloudFront.
  - **Táº¡i sao giáº£i quyáº¿t váº¥n Ä‘á»:** Khi ngÆ°á»i dÃ¹ng á»Ÿ ChÃ¢u Ã truy cáº­p trang web, yÃªu cáº§u cá»§a há» sáº½ Ä‘Æ°á»£c chuyá»ƒn Ä‘áº¿n Ä‘iá»ƒm biÃªn CloudFront gáº§n nháº¥t. CloudFront sáº½ lÆ°u báº£n sao ná»™i dung (Ä‘áº·c biá»‡t lÃ  ná»™i dung tÄ©nh hoáº·c ná»™i dung Ä‘á»™ng cÃ³ thá»ƒ cache Ä‘Æ°á»£c) táº¡i Ä‘iá»ƒm biÃªn nÃ y. Láº§n truy cáº­p tiáº¿p theo hoáº·c bá»Ÿi ngÆ°á»i dÃ¹ng khÃ¡c trong cÃ¹ng khu vá»±c, CloudFront sáº½ phá»¥c vá»¥ ná»™i dung trá»±c tiáº¿p tá»« Ä‘iá»ƒm biÃªn gáº§n Ä‘Ã³. Äiá»u nÃ y giáº£m Ä‘Ã¡ng ká»ƒ quÃ£ng Ä‘Æ°á»ng váº­t lÃ½ mÃ  dá»¯ liá»‡u pháº£i di chuyá»ƒn, tá»« Ä‘Ã³ **giáº£m Ä‘á»™ trá»… vÃ  tá»‘i Æ°u thá»i gian táº£i trang** cho ngÆ°á»i dÃ¹ng á»Ÿ ChÃ¢u Ã, **mÃ  khÃ´ng cáº§n di chuyá»ƒn backend** (mÃ¡y chá»§ xá»­ lÃ½ chÃ­nh á»Ÿ Má»¹).

**Táº¡i sao cÃ¡c lá»±a chá»n khÃ¡c khÃ´ng phÃ¹ há»£p:**

- **CloudFront Custom Origin trá» Ä‘áº¿n Route 53 DNS record:** **Sai cáº¥u hÃ¬nh** . CloudFront Origin cáº§n trá» Ä‘áº¿n má»™t endpoint chá»©a ná»™i dung (nhÆ° mÃ¡y chá»§ HTTP hoáº·c S3 bucket), khÃ´ng pháº£i báº£n ghi DNS trong Route 53 (Route 53 chá»‰ giáº£i quyáº¿t tÃªn miá»n thÃ nh Ä‘á»‹a chá»‰ IP).
- **Di chuyá»ƒn website sang S3 + S3 CRR:** **Sai** . Trang web lÃ  **Ä‘á»™ng** . S3 chá»‰ phÃ¹ há»£p cho **website tÄ©nh** . S3 khÃ´ng cháº¡y code xá»­ lÃ½ phÃ­a mÃ¡y chá»§ (server-side scripting). S3 CRR (sao chÃ©p dá»¯ liá»‡u giá»¯a cÃ¡c bucket S3) khÃ´ng liÃªn quan Ä‘áº¿n viá»‡c cháº¡y website Ä‘á»™ng hoáº·c giáº£m Ä‘á»™ trá»… cho xá»­ lÃ½ backend.
- **Route 53 Geo-proximity routing trá» Ä‘áº¿n mÃ¡y chá»§ On-Premises:** **Sai** . Geo-proximity routing cá»§a Route 53 chá»‰ giÃºp Ä‘á»‹nh tuyáº¿n ngÆ°á»i dÃ¹ng Ä‘áº¿n endpoint _gáº§n nháº¥t_ báº¡n Ä‘Ã£ Ä‘á»‹nh nghÄ©a. Tuy nhiÃªn, vÃ¬ mÃ¡y chá»§ On-Premises duy nháº¥t váº«n á»Ÿ Má»¹, ngÆ°á»i dÃ¹ng á»Ÿ ChÃ¢u Ã váº«n sáº½ Ä‘Æ°á»£c Ä‘á»‹nh tuyáº¿n trá»±c tiáº¿p Ä‘áº¿n mÃ¡y chá»§ _xa_ Ä‘Ã³. NÃ³ khÃ´ng giáº£m quÃ£ng Ä‘Æ°á»ng thá»±c táº¿ vÃ  khÃ´ng giáº£i quyáº¿t Ä‘Æ°á»£c Ä‘á»™ trá»… do khoáº£ng cÃ¡ch Ä‘á»‹a lÃ½ Ä‘á»‘i vá»›i cÃ¡c tÆ°Æ¡ng tÃ¡c vá»›i backend á»Ÿ Má»¹.

**CloudFront** mang ná»™i dung (cache) láº¡i **gáº§n ngÆ°á»i dÃ¹ng** á»Ÿ ChÃ¢u Ã -> giáº£m quÃ£ng Ä‘Æ°á»ng -> **giáº£m Ä‘á»™ trá»…** -> táº£i nhanh hÆ¡n, **backend váº«n á»Ÿ chá»— cÅ©** .

# 35.**Äá»™i DevOps cá»§a má»™t cÃ´ng ty thÆ°Æ¡ng máº¡i Ä‘iá»‡n tá»­ cáº§n thá»±c hiá»‡n cÃ´ng viá»‡c báº£o trÃ¬ (cá»¥ thá»ƒ lÃ  triá»ƒn khai báº£n vÃ¡ - maintenance patch) trÃªn má»™t phiÃªn báº£n EC2 cá»¥ thá»ƒ thuá»™c vá» má»™t Auto Scaling Group Ä‘ang sá»­ dá»¥ng chÃ­nh sÃ¡ch Ä‘iá»u chá»‰nh quy mÃ´ theo bÆ°á»›c (step scaling policy).**^1^ Váº¥n Ä‘á» há» gáº·p pháº£i lÃ  khi Ã¡p dá»¥ng báº£n vÃ¡, tráº¡ng thÃ¡i kiá»ƒm tra sá»©c khá»e (health check status) cá»§a phiÃªn báº£n Ä‘Ã³ hiá»ƒn thá»‹ lÃ  "khÃ´ng hoáº¡t Ä‘á»™ng" (out of service) trong vÃ i phÃºt. Äiá»u nÃ y khiáº¿n Auto Scaling Group kÃ­ch hoáº¡t tÃ­nh nÄƒng tá»± Ä‘á»™ng vÃ  ngay láº­p tá»©c khá»Ÿi táº¡o má»™t phiÃªn báº£n thay tháº¿.

**Váº¥n Ä‘á» cáº§n giáº£i quyáº¿t:** LÃ m tháº¿ nÃ o Ä‘á»ƒ thá»±c hiá»‡n báº£o trÃ¬ mÃ  khÃ´ng bá»‹ Auto Scaling Group tá»± Ä‘á»™ng thay tháº¿ phiÃªn báº£n bá»‹ Ä‘Ã¡nh dáº¥u lÃ  khÃ´ng khá»e táº¡m thá»i? Cáº§n cÃ¡c bÆ°á»›c hiá»‡u quáº£ nháº¥t vá» thá»i gian vÃ  tÃ i nguyÃªn.

**Hai BÆ°á»›c Hiá»‡u quáº£ nháº¥t Ä‘Æ°á»£c Ä‘á» xuáº¥t (vÃ  lÃ½ do):**

1. **ÄÆ°a phiÃªn báº£n vÃ o tráº¡ng thÃ¡i Standby vÃ  sau Ä‘Ã³ cáº­p nháº­t phiÃªn báº£n báº±ng cÃ¡ch Ã¡p dá»¥ng báº£n vÃ¡ báº£o trÃ¬. Sau khi phiÃªn báº£n sáºµn sÃ ng, báº¡n cÃ³ thá»ƒ thoÃ¡t khá»i tráº¡ng thÃ¡i Standby vÃ  Ä‘Æ°a phiÃªn báº£n trá»Ÿ láº¡i hoáº¡t Ä‘á»™ng.**
   - **Giáº£i thÃ­ch:** Tráº¡ng thÃ¡i **Standby** cho phÃ©p má»™t phiÃªn báº£n EC2 váº«n lÃ  má»™t pháº§n cá»§a Auto Scaling Group nhÆ°ng **khÃ´ng chá»§ Ä‘á»™ng xá»­ lÃ½ lÆ°u lÆ°á»£ng truy cáº­p á»©ng dá»¥ng** vÃ  **khÃ´ng Ä‘Æ°á»£c tÃ­nh vÃ o sá»‘ lÆ°á»£ng phiÃªn báº£n "InService"** cá»§a nhÃ³m.
   - **Táº¡i sao hiá»‡u quáº£:** Khi phiÃªn báº£n á»Ÿ tráº¡ng thÃ¡i Standby, Auto Scaling Group sáº½ **khÃ´ng thá»±c hiá»‡n hÃ nh Ä‘á»™ng thay tháº¿** nÃ³ ngay cáº£ khi tráº¡ng thÃ¡i kiá»ƒm tra sá»©c khá»e cá»§a nÃ³ thay Ä‘á»•i táº¡m thá»i (vÃ­ dá»¥: hiá»ƒn thá»‹ lÃ  khÃ´ng khá»e trong lÃºc báº£o trÃ¬).
   - **CÃ¡c bÆ°á»›c thá»±c hiá»‡n:**
     - ÄÆ°a phiÃªn báº£n cáº§n báº£o trÃ¬ vÃ o tráº¡ng thÃ¡i Standby.
     - Ãp dá»¥ng báº£n vÃ¡ báº£o trÃ¬ lÃªn phiÃªn báº£n Ä‘Ã³.
     - Sau khi báº£o trÃ¬ xong vÃ  phiÃªn báº£n hoáº¡t Ä‘á»™ng bÃ¬nh thÆ°á»ng trá»Ÿ láº¡i, thoÃ¡t tráº¡ng thÃ¡i Standby.
     - PhiÃªn báº£n sáº½ Ä‘Æ°á»£c Ä‘Æ°a trá»Ÿ láº¡i tráº¡ng thÃ¡i "InService" vÃ  tiáº¿p tá»¥c xá»­ lÃ½ lÆ°u lÆ°á»£ng.
   - **Lá»£i Ã­ch:** QuÃ¡ trÃ¬nh nÃ y diá»…n ra trá»±c tiáº¿p trÃªn phiÃªn báº£n ban Ä‘áº§u, giá»¯ nÃ³ lÃ  má»™t pháº§n cá»§a ASG vÃ  trÃ¡nh viá»‡c khá»Ÿi táº¡o khÃ´ng cáº§n thiáº¿t má»™t phiÃªn báº£n má»›i.
2. **Táº¡m dá»«ng (Suspend) tiáº¿n trÃ¬nh ReplaceUnhealthy cho Auto Scaling Group vÃ  Ã¡p dá»¥ng báº£n vÃ¡ báº£o trÃ¬ cho phiÃªn báº£n. Khi phiÃªn báº£n sáºµn sÃ ng, báº¡n cÃ³ thá»ƒ báº­t láº¡i tiáº¿n trÃ¬nh ReplaceUnhealthy.**
   - **Giáº£i thÃ­ch:** **Tiáº¿n trÃ¬nh \*\***ReplaceUnhealthy** lÃ  má»™t trong cÃ¡c "process type" cá»§a Auto Scaling Group.^2^ Chá»©c nÄƒng cá»§a nÃ³ lÃ  **cháº¥m dá»©t (terminate) cÃ¡c phiÃªn báº£n bá»‹ Ä‘Ã¡nh dáº¥u lÃ  khÃ´ng khá»e** vÃ  **khá»Ÿi táº¡o phiÃªn báº£n má»›i Ä‘á»ƒ thay tháº¿\*\* .
   - **Táº¡i sao hiá»‡u quáº£:** Khi báº¡n **táº¡m dá»«ng** tiáº¿n trÃ¬nh `ReplaceUnhealthy`, báº¡n ra lá»‡nh cho Auto Scaling Group **dá»«ng ngay viá»‡c thay tháº¿ cÃ¡c phiÃªn báº£n bá»‹ Ä‘Ã¡nh dáº¥u lÃ  khÃ´ng khá»e** . CÃ¡c phiÃªn báº£n váº«n cÃ³ thá»ƒ bá»‹ Ä‘Ã¡nh dáº¥u lÃ  khÃ´ng khá»e (do kiá»ƒm tra sá»©c khá»e EC2 hoáº·c ELB tháº¥t báº¡i) trong thá»i gian nÃ y, nhÆ°ng ASG sáº½ khÃ´ng hÃ nh Ä‘á»™ng.
   - **CÃ¡c bÆ°á»›c thá»±c hiá»‡n:**
     - Táº¡m dá»«ng tiáº¿n trÃ¬nh `ReplaceUnhealthy` cho ASG.
     - Ãp dá»¥ng báº£n vÃ¡ báº£o trÃ¬ lÃªn phiÃªn báº£n (phiÃªn báº£n cÃ³ thá»ƒ bá»‹ Ä‘Ã¡nh dáº¥u lÃ  khÃ´ng khá»e).
     - Sau khi báº£o trÃ¬ xong vÃ  phiÃªn báº£n hoáº¡t Ä‘á»™ng bÃ¬nh thÆ°á»ng.
     - Báº­t láº¡i (Resume) tiáº¿n trÃ¬nh `ReplaceUnhealthy`. (LÆ°u Ã½: Náº¿u phiÃªn báº£n váº«n cÃ²n bá»‹ Ä‘Ã¡nh dáº¥u lÃ  khÃ´ng khá»e khi báº¡n Resume, ASG cÃ³ thá»ƒ sáº½ thay tháº¿ nÃ³ ngay lÃºc Ä‘Ã³. ÄÃ´i khi báº¡n cÃ³ thá»ƒ cáº§n cáº¥u hÃ¬nh hoáº·c chá» phiÃªn báº£n tá»± chuyá»ƒn sang tráº¡ng thÃ¡i khá»e máº¡nh trÆ°á»›c khi Resume náº¿u nÃ³ khÃ´ng tá»± Ä‘á»™ng).
   - **Lá»£i Ã­ch:** NgÄƒn cháº·n ASG tá»± Ä‘á»™ng thay tháº¿ phiÃªn báº£n chá»‰ vÃ¬ nÃ³ táº¡m thá»i khÃ´ng khá»e trong quÃ¡ trÃ¬nh báº£o trÃ¬.

**Táº¡i sao cÃ¡c lá»±a chá»n khÃ¡c khÃ´ng phÃ¹ há»£p (dá»±a trÃªn giáº£i thÃ­ch):**

- **Chá»¥p Snapshot, táº¡o AMI má»›i, khá»Ÿi cháº¡y phiÃªn báº£n má»›i dÃ¹ng AMI Ä‘Ã³, Ã¡p dá»¥ng báº£n vÃ¡ cho phiÃªn báº£n má»›i, thÃªm láº¡i vÃ o ASG, cháº¥m dá»©t phiÃªn báº£n cÅ©:** **KhÃ´ng hiá»‡u quáº£ vá» thá»i gian vÃ  tÃ i nguyÃªn** . QuÃ¡ trÃ¬nh nÃ y bao gá»“m nhiá»u bÆ°á»›c phá»©c táº¡p vÃ  tá»‘n thá»i gian (chá»¥p snapshot, táº¡o AMI lÃ  cÃ¡c thao tÃ¡c tá»‘n thá»i gian), chá»‰ Ä‘á»ƒ Ã¡p dá»¥ng báº£n vÃ¡ cho má»™t phiÃªn báº£n duy nháº¥t. CÃ³ nhá»¯ng cÃ¡ch Ä‘Æ¡n giáº£n hÆ¡n nhiá»u (Standby hoáº·c Suspend).
- **XÃ³a Auto Scaling Group, sá»­a lá»—i trÃªn phiÃªn báº£n, táº¡o ASG má»›i, thÃªm láº¡i cÃ¡c phiÃªn báº£n:** **KhÃ´ng Ä‘Æ°á»£c khuyáº¿n nghá»‹ vÃ  ráº¥t khÃ´ng hiá»‡u quáº£/gÃ¢y giÃ¡n Ä‘oáº¡n** . Viá»‡c xÃ³a vÃ  táº¡o láº¡i toÃ n bá»™ Auto Scaling Group lÃ  má»™t hoáº¡t Ä‘á»™ng lá»›n, gÃ¢y giÃ¡n Ä‘oáº¡n hoáº¡t Ä‘á»™ng vÃ  khÃ´ng cáº§n thiáº¿t chá»‰ Ä‘á»ƒ báº£o trÃ¬ má»™t phiÃªn báº£n.
- **Táº¡m dá»«ng tiáº¿n trÃ¬nh ScheduledActions:** **KhÃ´ng liÃªn quan** Ä‘áº¿n váº¥n Ä‘á» thay tháº¿ phiÃªn báº£n khÃ´ng khá»e. `ScheduledActions` (cÃ¡c hÃ nh Ä‘á»™ng theo lá»‹ch trÃ¬nh) Ä‘Æ°á»£c dÃ¹ng Ä‘á»ƒ Ä‘iá»u chá»‰nh quy mÃ´ ASG vÃ o cÃ¡c thá»i Ä‘iá»ƒm cá»¥ thá»ƒ theo lá»‹ch (vÃ­ dá»¥: tÄƒng sá»‘ lÆ°á»£ng phiÃªn báº£n vÃ o giá» cao Ä‘iá»ƒm), chá»© khÃ´ng pháº£i Ä‘á»ƒ pháº£n á»©ng vá»›i tráº¡ng thÃ¡i sá»©c khá»e cá»§a phiÃªn báº£n.

TÃ³m láº¡i, hai phÆ°Æ¡ng phÃ¡p Standby vÃ  Suspend ReplaceUnhealthy Ä‘á»u cho phÃ©p báº¡n "tÃ¡ch" phiÃªn báº£n ra khá»i sá»± giÃ¡m sÃ¡t tá»± Ä‘á»™ng thay tháº¿ cá»§a ASG trong quÃ¡ trÃ¬nh báº£o trÃ¬, nhÆ°ng giá»¯ nÃ³ váº«n lÃ  má»™t pháº§n cá»§a nhÃ³m (Standby) hoáº·c táº¡m dá»«ng quy trÃ¬nh thay tháº¿ cá»§a nhÃ³m (Suspend ReplaceUnhealthy), giÃºp báº£o trÃ¬ hiá»‡u quáº£ vÃ  Ã­t gÃ¢y giÃ¡n Ä‘oáº¡n nháº¥t.

As soon as you resume the `ReplaceUnhealthy` process, Amazon EC2 Auto Scaling replaces instances that were marked unhealthy while this process was suspended

VÃ­ dá»¥:

- Báº¡n táº¡m dá»«ng `ReplaceUnhealthy`.
- PhiÃªn báº£n A bá»‹ lá»—i vÃ  bá»‹ Ä‘Ã¡nh dáº¥u lÃ  khÃ´ng khá»e (nhÆ°ng ASG khÃ´ng lÃ m gÃ¬ cáº£ vÃ¬ báº¡n Ä‘Ã£ táº¡m dá»«ng).
- Báº¡n báº£o trÃ¬ PhiÃªn báº£n B, nÃ³ cÅ©ng bá»‹ Ä‘Ã¡nh dáº¥u lÃ  khÃ´ng khá»e trong 5 phÃºt (ASG váº«n khÃ´ng lÃ m gÃ¬). Sau 5 phÃºt, PhiÃªn báº£n B khá»e láº¡i.
- Báº¡n báº­t láº¡i `ReplaceUnhealthy`.
- Ngay láº­p tá»©c, ASG sáº½ nhÃ¬n vÃ o tráº¡ng thÃ¡i hiá»‡n táº¡i. Náº¿u PhiÃªn báº£n A váº«n Ä‘ang khÃ´ng khá»e, nÃ³ sáº½ bá»‹ thay tháº¿. Náº¿u PhiÃªn báº£n B Ä‘Ã£ khá»e láº¡i, nÃ³ sáº½ khÃ´ng bá»‹ thay tháº¿.

Äiá»u nÃ y nháº¥n máº¡nh ráº±ng báº¡n cáº§n Ä‘áº£m báº£o phiÃªn báº£n cá»§a mÃ¬nh **thá»±c sá»± khá»e máº¡nh trá»Ÿ láº¡i** trÆ°á»›c khi báº­t láº¡i tiáº¿n trÃ¬nh `ReplaceUnhealthy`, náº¿u khÃ´ng nÃ³ cÃ³ thá»ƒ bá»‹ thay tháº¿ ngay sau khi báº¡n Resume.

Trong Auto Scaling Group, **Desired Capacity** lÃ  sá»‘ lÆ°á»£ng phiÃªn báº£n mÃ  báº¡n muá»‘n nhÃ³m duy trÃ¬ á»Ÿ tráº¡ng thÃ¡i "InService" (Ä‘ang hoáº¡t Ä‘á»™ng vÃ  xá»­ lÃ½ lÆ°u lÆ°á»£ng).

Khi báº¡n Ä‘Æ°a má»™t phiÃªn báº£n tá»« tráº¡ng thÃ¡i "InService" sang tráº¡ng thÃ¡i **Standby** , cÃ³ hai cÃ¡ch xá»­ lÃ½ giÃ¡ trá»‹ Desired Capacity:

1. **HÃ nh vi Máº·c Ä‘á»‹nh:**
   - Theo máº·c Ä‘á»‹nh, giÃ¡ trá»‹ **Desired Capacity sáº½ bá»‹ GIáº¢M Ä‘i 1 Ä‘Æ¡n vá»‹** (hoáº·c báº±ng sá»‘ phiÃªn báº£n báº¡n Ä‘Æ°a vÃ o Standby).
   - **LÃ½ do:** Äiá»u nÃ y nháº±m **ngÄƒn cháº·n** Auto Scaling Group tá»± Ä‘á»™ng khá»Ÿi cháº¡y thÃªm má»™t phiÃªn báº£n khÃ¡c ngay láº­p tá»©c Ä‘á»ƒ bÃ¹ Ä‘áº¯p cho phiÃªn báº£n vá»«a chuyá»ƒn sang Standby. ASG hiá»ƒu ráº±ng báº¡n táº¡m thá»i chá»‰ cáº§n sá»‘ lÆ°á»£ng phiÃªn báº£n "InService" Ã­t hÆ¡n 1 (báº±ng Desired Capacity má»›i) trong khi phiÃªn báº£n kia Ä‘ang á»Ÿ tráº¡ng thÃ¡i Standby.
2. **HÃ nh vi TÃ¹y chá»n (KhÃ´ng giáº£m Desired Capacity):**
   - Thay vÃ¬ Ä‘á»ƒ giÃ¡ trá»‹ Desired Capacity bá»‹ giáº£m theo máº·c Ä‘á»‹nh, báº¡n cÃ³ thá»ƒ **chá»‰ Ä‘á»‹nh rÃµ rÃ ng ráº±ng Desired Capacity KHÃ”NG Bá»Š GIáº¢M** khi báº¡n Ä‘Æ°a phiÃªn báº£n vÃ o tráº¡ng thÃ¡i Standby.
   - **Káº¿t quáº£:** Náº¿u báº¡n chá»n tÃ¹y chá»n nÃ y, Auto Scaling Group sáº½ **khá»Ÿi cháº¡y thÃªm má»™t phiÃªn báº£n má»›i** ngay láº­p tá»©c Ä‘á»ƒ thay tháº¿ cho phiÃªn báº£n vá»«a Ä‘Æ°á»£c Ä‘Æ°a vÃ o tráº¡ng thÃ¡i Standby.
   - **Má»¥c Ä‘Ã­ch cá»§a tÃ¹y chá»n nÃ y:** Nháº±m giÃºp báº¡n **duy trÃ¬ Ä‘á»§ sá»‘ lÆ°á»£ng phiÃªn báº£n "InService"** báº±ng vá»›i giÃ¡ trá»‹ Desired Capacity ban Ä‘áº§u, **ngay cáº£ khi** má»™t hoáº·c nhiá»u phiÃªn báº£n Ä‘ang táº¡m thá»i á»Ÿ tráº¡ng thÃ¡i Standby (vÃ­ dá»¥: Ä‘á»ƒ báº£o trÃ¬). ASG Ä‘áº£m báº£o nÄƒng lá»±c á»©ng dá»¥ng cá»§a báº¡n khÃ´ng bá»‹ giáº£m sÃºt do cÃ³ phiÃªn báº£n Ä‘ang á»Ÿ Standby.

**TÃ³m láº¡i:**

- **Máº·c Ä‘á»‹nh:** ÄÆ°a 1 instance vÃ o Standby -> Desired Capacity giáº£m 1 -> ASG khÃ´ng launch thÃªm.
- **TÃ¹y chá»n:** ÄÆ°a 1 instance vÃ o Standby + **chá»‰ Ä‘á»‹nh KHÃ”NG giáº£m Desired Capacity** -> Desired Capacity giá»¯ nguyÃªn -> ASG launch thÃªm 1 instance Ä‘á»ƒ bÃ¹ vÃ o -> Duy trÃ¬ tá»•ng sá»‘ instance InService báº±ng Desired Capacity ban Ä‘áº§u.

# 1.Má»™t cÃ´ng ty IT gáº·p sá»± cá»‘ báº£o máº­t: má»™t nhÃ  phÃ¡t triá»ƒn má»›i Ä‘Æ°á»£c cáº¥p **quyá»n truy cáº­p Ä‘áº§y Ä‘á»§ vÃ o Amazon DynamoDB** trong mÃ´i trÆ°á»ng production. Trong khi lÃ m viá»‡c trÃªn má»™t tÃ­nh nÄƒng má»›i, nhÃ  phÃ¡t triá»ƒn nÃ y Ä‘Ã£ vÃ´ tÃ¬nh **xÃ³a máº¥t má»™t vÃ i báº£ng quan trá»ng** trong mÃ´i trÆ°á»ng production. CÃ´ng ty muá»‘n tÃ¬m cÃ¡ch **hiá»‡u quáº£ nháº¥t** Ä‘á»ƒ ngÄƒn cháº·n sá»± cá»‘ tÆ°Æ¡ng tá»± tÃ¡i diá»…n.

**Váº¥n Ä‘á» cáº§n giáº£i quyáº¿t:** LÃ m tháº¿ nÃ o Ä‘á»ƒ kiá»ƒm soÃ¡t cháº·t cháº½ quyá»n háº¡n Ä‘Æ°á»£c cáº¥p cho cÃ¡c nhÃ¢n viÃªn má»›i (vÃ  nÃ³i chung lÃ  cÃ¡c nhÃ¢n viÃªn khÃ¡c) Ä‘á»ƒ há» khÃ´ng thá»ƒ vÃ´ tÃ¬nh (hoáº·c cá»‘ Ã½) gÃ¢y ra thiá»‡t háº¡i nghiÃªm trá»ng nhÆ° xÃ³a dá»¯ liá»‡u production, ngay cáº£ khi ngÆ°á»i quáº£n lÃ½ cáº¥p quyá»n cho há» vÃ´ tÃ¬nh cáº¥p quÃ¡ tay?

**Giáº£i phÃ¡p Hiá»‡u quáº£ nháº¥t Ä‘Æ°á»£c Ä‘á» xuáº¥t (vÃ  lÃ½ do):**

Giáº£i phÃ¡p hiá»‡u quáº£ nháº¥t Ä‘á»ƒ giáº£i quyáº¿t váº¥n Ä‘á» nÃ y lÃ : **Sá»­ dá»¥ng Permissions Boundary (Ranh giá»›i quyá»n) Ä‘á»ƒ kiá»ƒm soÃ¡t quyá»n tá»‘i Ä‘a mÃ  nhÃ¢n viÃªn cÃ³ thá»ƒ cáº¥p cho cÃ¡c thá»±c thá»ƒ IAM (ngÆ°á»i dÃ¹ng vÃ  vai trÃ²).**

- **Permissions Boundary lÃ m gÃ¬ trong trÆ°á»ng há»£p nÃ y?**
  - NgÆ°á»i quáº£n trá»‹ IAM cá»§a cÃ´ng ty (hoáº·c ngÆ°á»i cÃ³ quyá»n phÃ¹ há»£p) sáº½ táº¡o ra má»™t **chÃ­nh sÃ¡ch ranh giá»›i quyá»n (permissions boundary policy)** . ChÃ­nh sÃ¡ch nÃ y sáº½ Ä‘á»‹nh nghÄ©a cÃ¡c quyá»n **tá»‘i Ä‘a** mÃ  báº¥t ká»³ ngÆ°á»i dÃ¹ng hoáº·c vai trÃ² IAM nÃ o Ä‘Æ°á»£c táº¡o vÃ  quáº£n lÃ½ bá»Ÿi cÃ¡c nhÃ  phÃ¡t triá»ƒn (hoáº·c má»™t nhÃ³m nhÃ¢n viÃªn cá»¥ thá»ƒ) **cÃ³ thá»ƒ cÃ³** .
  - Quan trá»ng lÃ , chÃ­nh sÃ¡ch ranh giá»›i quyá»n nÃ y sáº½ Ä‘Æ°á»£c thiáº¿t káº¿ Ä‘á»ƒ **KHÃ”NG BAO Gá»’M** cÃ¡c quyá»n nguy hiá»ƒm nhÆ° `dynamodb:DeleteTable` hoáº·c cÃ¡c quyá»n truy cáº­p Ä‘áº§y Ä‘á»§ (`dynamodb:*`) vÃ o cÃ¡c báº£ng production.
  - Khi má»™t nhÃ  phÃ¡t triá»ƒn táº¡o má»™t ngÆ°á»i dÃ¹ng hoáº·c vai trÃ² IAM má»›i, há» sáº½ Ä‘Æ°á»£c yÃªu cáº§u (hoáº·c cáº¥u hÃ¬nh báº¯t buá»™c) pháº£i Ä‘Ã­nh kÃ¨m chÃ­nh sÃ¡ch ranh giá»›i quyá»n nÃ y vÃ o thá»±c thá»ƒ má»›i Ä‘Ã³.
  - Sau Ä‘Ã³, nhÃ  phÃ¡t triá»ƒn cÃ³ thá»ƒ Ä‘Ã­nh kÃ¨m cÃ¡c chÃ­nh sÃ¡ch quyá»n thÃ´ng thÆ°á»ng (identity-based policies) cho phÃ©p thá»±c thá»ƒ má»›i truy cáº­p cÃ¡c tÃ i nguyÃªn cáº§n thiáº¿t cho cÃ´ng viá»‡c (vÃ­ dá»¥: quyá»n `dynamodb:PutItem`, `dynamodb:GetItem` trÃªn cÃ¡c báº£ng dev/test, hoáº·c tháº­m chÃ­ trÃªn báº£ng production náº¿u cáº§n Ä‘á»c).
- **Quyá»n Háº¡n Thá»±c Táº¿ ngÄƒn cháº·n sá»± cá»‘:**
  - NhÆ° Ä‘Ã£ giáº£i thÃ­ch trÆ°á»›c Ä‘Ã³, quyá»n háº¡n thá»±c táº¿ cá»§a ngÆ°á»i dÃ¹ng/vai trÃ² IAM sáº½ lÃ  **giao Ä‘iá»ƒm** cá»§a chÃ­nh sÃ¡ch quyá»n thÃ´ng thÆ°á»ng VÃ€ chÃ­nh sÃ¡ch ranh giá»›i quyá»n.
  - Trong trÆ°á»ng há»£p nÃ y, dÃ¹ nhÃ  phÃ¡t triá»ƒn cÃ³ vÃ´ tÃ¬nh Ä‘Ã­nh kÃ¨m má»™t chÃ­nh sÃ¡ch quyá»n rá»™ng rÃ£i (vÃ­ dá»¥: cho phÃ©p `dynamodb:*`), thÃ¬ chÃ­nh sÃ¡ch **ranh giá»›i quyá»n (khÃ´ng cho phÃ©p `dynamodb:DeleteTable`)** sáº½ ghi Ä‘Ã¨ vÃ  giá»›i háº¡n láº¡i.
  - Káº¿t quáº£ lÃ , ngÆ°á»i dÃ¹ng IAM má»›i Ä‘Æ°á»£c táº¡o sáº½ **khÃ´ng cÃ³ quyá»n thá»±c táº¿** Ä‘á»ƒ xÃ³a cÃ¡c báº£ng DynamoDB production, ngay cáº£ khi Ã½ Ä‘á»‹nh cáº¥p quyá»n ban Ä‘áº§u cá»§a ngÆ°á»i táº¡o lÃ  rá»™ng rÃ£i hÆ¡n.
- **Táº¡i sao Ä‘Ã¢y lÃ  cÃ¡ch hiá»‡u quáº£ nháº¥t Ä‘á»ƒ ngÄƒn sá»± cá»‘ tÃ¡i diá»…n:**
  - NÃ³ thiáº¿t láº­p má»™t **hÃ ng rÃ o báº£o vá»‡ á»Ÿ cáº¥p Ä‘á»™ chÃ­nh sÃ¡ch** , Ä‘Æ°á»£c kiá»ƒm soÃ¡t bá»Ÿi ngÆ°á»i quáº£n trá»‹ an ninh.
  - NÃ³ cho phÃ©p á»§y quyá»n viá»‡c táº¡o tÃ i khoáº£n/vai trÃ² cho cÃ¡c nhÃ³m khÃ¡c (nhÆ° Ä‘á»™i phÃ¡t triá»ƒn) mÃ  váº«n Ä‘áº£m báº£o an toÃ n, khÃ´ng cáº§n ngÆ°á»i quáº£n trá»‹ trung tÃ¢m pháº£i duyá»‡t tá»«ng yÃªu cáº§u quyá»n chi tiáº¿t.
  - NÃ³ ngÄƒn cháº·n cÃ¡c sá»± cá»‘ do vÃ´ tÃ¬nh cáº¥p quÃ¡ nhiá»u quyá»n ngay tá»« Ä‘áº§u bá»Ÿi nhá»¯ng ngÆ°á»i khÃ´ng chuyÃªn vá» quáº£n lÃ½ quyá»n IAM sÃ¢u.

**Táº¡i sao cÃ¡c lá»±a chá»n khÃ¡c khÃ´ng phÃ¹ há»£p (theo giáº£i thÃ­ch):**

- **CTO xem xÃ©t quyá»n háº¡n cá»§a tá»«ng ngÆ°á»i dÃ¹ng IAM má»›i:** **KhÃ´ng hiá»‡u quáº£ vÃ  khÃ´ng má»Ÿ rá»™ng Ä‘Æ°á»£c** . á» quy mÃ´ cÃ´ng ty lá»›n vá»›i nhiá»u nhÃ  phÃ¡t triá»ƒn má»›i thÆ°á»ng xuyÃªn, viá»‡c CTO pháº£i duyá»‡t thá»§ cÃ´ng tá»«ng bá»™ quyá»n háº¡n lÃ  khÃ´ng kháº£ thi, tá»‘n thá»i gian vÃ  dá»… xáº£y ra sai sÃ³t.
- **Loáº¡i bá» quyá»n truy cáº­p Ä‘áº§y Ä‘á»§ CSDL cho táº¥t cáº£ ngÆ°á»i dÃ¹ng trong tá»• chá»©c:** **KhÃ´ng thá»±c táº¿** . Sáº½ cÃ³ nhá»¯ng ngÆ°á»i dÃ¹ng há»£p lá»‡ (vÃ­ dá»¥: quáº£n trá»‹ viÃªn cÆ¡ sá»Ÿ dá»¯ liá»‡u, há»‡ thá»‘ng backup tá»± Ä‘á»™ng) cáº§n cÃ³ quyá»n truy cáº­p Ä‘áº§y Ä‘á»§ hoáº·c cÃ¡c quyá»n quáº£n trá»‹ máº¡nh máº½ Ä‘á»‘i vá»›i cÆ¡ sá»Ÿ dá»¯ liá»‡u Ä‘á»ƒ lÃ m cÃ´ng viá»‡c cá»§a há».
- **Chá»‰ ngÆ°á»i dÃ¹ng Root cÃ³ quyá»n truy cáº­p Ä‘áº§y Ä‘á»§ CSDL:** **Thá»±c hÃ nh khÃ´ng tá»‘t (bad practice)** . TÃ i khoáº£n Root cÃ³ quyá»n háº¡n cao nháº¥t vÃ  khÃ´ng bá»‹ giá»›i háº¡n bá»Ÿi chÃ­nh sÃ¡ch IAM. Sá»­ dá»¥ng tÃ i khoáº£n Root cho cÃ¡c tÃ¡c vá»¥ hÃ ng ngÃ y lÃ m tÄƒng rá»§i ro bá»‹ lá»™ thÃ´ng tin xÃ¡c thá»±c Root vÃ  gÃ¢y ra thiá»‡t háº¡i khÃ´ng thá»ƒ phá»¥c há»“i. CÃ¡c tÃ¡c vá»¥ quáº£n trá»‹ nÃªn Ä‘Æ°á»£c thá»±c hiá»‡n bá»Ÿi cÃ¡c ngÆ°á»i dÃ¹ng/vai trÃ² IAM vá»›i quyá»n háº¡n Ä‘Æ°á»£c giá»›i háº¡n á»Ÿ má»©c cáº§n thiáº¿t (least privilege).

**TÃ³m láº¡i:** Permissions Boundary lÃ  giáº£i phÃ¡p cÃ³ há»‡ thá»‘ng vÃ  hiá»‡u quáº£ nháº¥t Ä‘á»ƒ giáº£i quyáº¿t váº¥n Ä‘á» nÃ y báº±ng cÃ¡ch giá»›i háº¡n quyá»n tá»‘i Ä‘a cÃ³ thá»ƒ Ä‘Æ°á»£c cáº¥p, ngÄƒn cháº·n viá»‡c cáº¥p nháº§m quyá»n nguy hiá»ƒm cho cÃ¡c thá»±c thá»ƒ IAM vÃ  tá»« Ä‘Ã³ phÃ²ng ngá»«a cÃ¡c sá»± cá»‘ nhÆ° xÃ³a báº£ng production má»™t cÃ¡ch vÃ´ tÃ¬nh.

# 2.**Ká»‹ch báº£n:** NhÃ  khoa há»c táº£i áº£nh 3GB lÃªn Amazon S3 dÃ¹ng S3 Transfer Acceleration (S3TA), nhÆ°ng quÃ¡ trÃ¬nh **khÃ´ng Ä‘Æ°á»£c tÄƒng tá»‘c** .

**CÃ¢u tráº£ lá»i Ä‘Ãºng:** **NhÃ  khoa há»c khÃ´ng pháº£i tráº£ báº¥t ká»³ khoáº£n phÃ­ truyá»n dá»¯ liá»‡u nÃ o cho viá»‡c táº£i áº£nh lÃªn.**

**Giáº£i thÃ­ch (gá»n gÃ ng):**

CÃ³ hai quy táº¯c tÃ­nh phÃ­ Ã¡p dá»¥ng á»Ÿ Ä‘Ã¢y:

1. **Táº£i dá»¯ liá»‡u vÃ o S3 tá»« Internet:** Amazon S3 **khÃ´ng tÃ­nh phÃ­ truyá»n dá»¯ liá»‡u** khi dá»¯ liá»‡u Ä‘Æ°á»£c táº£i **vÃ o** tá»« Internet.
2. **S3 Transfer Acceleration (S3TA):** Báº¡n **chá»‰ tráº£ phÃ­** cho S3TA khi quÃ¡ trÃ¬nh truyá»n dá»¯ liá»‡u **thá»±c sá»± Ä‘Æ°á»£c tÄƒng tá»‘c** .

Trong ká»‹ch báº£n nÃ y, dá»¯ liá»‡u Ä‘Æ°á»£c táº£i **vÃ o** S3 tá»« Internet (nghÄ©a lÃ  khÃ´ng máº¥t phÃ­ S3 truyá»n dá»¯ liá»‡u) VÃ€ quÃ¡ trÃ¬nh S3TA **khÃ´ng mang láº¡i hiá»‡u quáº£ tÄƒng tá»‘c** (nghÄ©a lÃ  khÃ´ng máº¥t phÃ­ S3TA). Do Ä‘Ã³, tá»•ng cá»™ng **khÃ´ng cÃ³ khoáº£n phÃ­ truyá»n dá»¯ liá»‡u nÃ o** pháº£i tráº£.

CÃ¡c lá»±a chá»n khÃ¡c sai vÃ¬:

- Tráº£ phÃ­ S3TA: Sai, vÃ¬ quÃ¡ trÃ¬nh khÃ´ng Ä‘Æ°á»£c tÄƒng tá»‘c.
- Tráº£ phÃ­ S3 truyá»n dá»¯ liá»‡u: Sai, vÃ¬ táº£i dá»¯ liá»‡u vÃ o S3 tá»« Internet lÃ  miá»…n phÃ­.
- Tráº£ cáº£ hai: Sai, vÃ¬ cáº£ hai Ä‘á»u khÃ´ng phÃ¡t sinh phÃ­ trong trÆ°á»ng há»£p nÃ y.

1. Viá»‡c táº£i dá»¯ liá»‡u **vÃ o (IN)** S3 tá»« Internet thÃ´ng thÆ°á»ng **khÃ´ng máº¥t phÃ­ truyá»n dá»¯ liá»‡u** (Data Transfer IN).
2. Viá»‡c táº£i dá»¯ liá»‡u **ra (OUT)** khá»i S3 Ä‘á»ƒ Ä‘i ra Internet thÃ´ng thÆ°á»ng **cÃ³ máº¥t phÃ­ truyá»n dá»¯ liá»‡u** (Data Transfer OUT).

**CÃ²n S3 Transfer Acceleration (S3TA) thÃ¬ sao?** S3TA cÃ³ biá»ƒu phÃ­ riÃªng, Ã¡p dá»¥ng **THÃŠM VÃ€O** phÃ­ truyá»n dá»¯ liá»‡u cÆ¡ báº£n (náº¿u cÃ³) **náº¿u quÃ¡ trÃ¬nh truyá»n thá»±c sá»± Ä‘Æ°á»£c tÄƒng tá»‘c** .

- **Táº£i LÃŠN S3 (IN) dÃ¹ng S3TA:** PhÃ­ truyá»n dá»¯ liá»‡u cÆ¡ báº£n lÃ  0 Ä‘á»“ng. Náº¿u S3TA tÄƒng tá»‘c, báº¡n tráº£ **chá»‰ phÃ­ S3TA** . Náº¿u S3TA khÃ´ng tÄƒng tá»‘c, báº¡n tráº£ **0 Ä‘á»“ng** (khÃ´ng S3 phÃ­, khÃ´ng S3TA phÃ­).
- **Táº£i XUá»NG tá»« S3 (OUT) dÃ¹ng S3TA:** PhÃ­ truyá»n dá»¯ liá»‡u cÆ¡ báº£n (ra Internet) **cÃ³ thá»ƒ cÃ³** . Náº¿u S3TA tÄƒng tá»‘c, báº¡n tráº£ **phÃ­ truyá»n dá»¯ liá»‡u cÆ¡ báº£n (náº¿u cÃ³) + phÃ­ S3TA** . Náº¿u S3TA khÃ´ng tÄƒng tá»‘c, báº¡n chá»‰ tráº£ **phÃ­ truyá»n dá»¯ liá»‡u cÆ¡ báº£n (náº¿u cÃ³)** .

Váº­y, viá»‡c "ra" (táº£i xuá»‘ng thá»© tá»« s3) khá»i S3 thÆ°á»ng máº¥t phÃ­, báº¥t ká»ƒ cÃ³ dÃ¹ng S3TA hay khÃ´ng (trá»« cÃ¡c trÆ°á»ng há»£p ngoáº¡i lá»‡ nhÆ° táº£i xuá»‘ng ná»™i dung tÄ©nh tá»« CloudFront origin). S3TA lÃ  má»™t khoáº£n phÃ­ bá»• sung náº¿u nÃ³ hiá»‡u quáº£.
